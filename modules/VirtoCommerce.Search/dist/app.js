!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){n(1),n(2),n(3),n(4),n(5),n(6),n(7),n(8),e.exports=n(9)},function(e,t){void 0!==AppDependencies&&AppDependencies.push("virtoCommerce.searchModule"),angular.module("virtoCommerce.searchModule",[]).config(["$stateProvider",function(e){e.state("workspace.searchIndexModule",{url:"/searchIndex",controller:["$scope","platformWebApp.bladeNavigationService",function(e,t){t.showBlade({id:"searchIndex",title:"search.blades.document-type-list.title",headIcon:"fa fa-search",controller:"virtoCommerce.searchModule.indexesListController",template:"Modules/$(VirtoCommerce.Search)/Scripts/blades/indexes-list.tpl.html",isClosingDisabled:!0}),e.moduleName="vc-core vc-search-index"}],templateUrl:"$(Platform)/Scripts/common/templates/home.tpl.html"})}]).run(["platformWebApp.mainMenuService","$state","platformWebApp.pushNotificationTemplateResolver","platformWebApp.bladeNavigationService",function(e,t,n,o){n.register({priority:900,satisfy:function(e,t){return"history"===t&&"IndexProgressPushNotification"===e.notifyType},template:"Modules/$(VirtoCommerce.Search)/Scripts/notifications/historyIndex.tpl.html",action:function(e){var t={id:"indexProgress",notification:e,controller:"virtoCommerce.searchModule.indexProgressController",template:"Modules/$(VirtoCommerce.Search)/Scripts/blades/index-progress.tpl.html"};o.showBlade(t)}}),n.register({priority:900,satisfy:function(e,t){return"header-notification"===t&&"IndexProgressPushNotification"===e.notifyType},template:"Modules/$(VirtoCommerce.Search)/Scripts/notifications/headerNotification.tpl.html",action:function(e){t.go("workspace.pushNotificationsHistory",e)}}),e.addMenuItem({path:"browse/searchIndex",icon:"fa fa-search",title:"search.main-menu-title.search-index",priority:25,action:function(){t.go("workspace.searchIndexModule")},permission:"search:index:access"})}])},function(e,t){angular.module("virtoCommerce.searchModule").controller("virtoCommerce.searchModule.indexDetailController",["$scope","platformWebApp.bladeNavigationService","virtoCommerce.searchModule.searchIndexation",function(e,t,n){var o=e.blade;o.initialize=function(e){o.currentEntity=e,o.isLoading=!1},o.headIcon="fa fa-search",o.toolbarCommands=[{name:"search.commands.rebuild-index",icon:"fa fa-recycle",index:2,executeMethod:function(e){n.index([{documentType:e.documentType,documentIds:[e.currentEntityId]}],(function(n){var o={id:"indexProgress",notification:n,parentRefresh:e.parentRefresh,controller:"virtoCommerce.searchModule.indexProgressController",template:"Modules/$(VirtoCommerce.Search)/Scripts/blades/index-progress.tpl.html"};t.showBlade(o,e.parentBlade||e)}))},canExecuteMethod:function(){return!0},permission:"search:index:rebuild"},{name:"search.commands.copy-to-clipboard",icon:"fa fa-clipboard",executeMethod:function(){var e=document.getElementById("indexData"),t=document.createRange();t.selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),document.execCommand("copy"),window.getSelection().removeAllRanges()},canExecuteMethod:function(){return!0}}],o.title=o.currentEntity.name,o.subtitle="search.blades.index-detail.subtitle",o.data||(o.title="search.blades.index-detail.title-new",o.subtitle=void 0),o.initialize(o.data)}])},function(e,t){angular.module("virtoCommerce.searchModule").controller("virtoCommerce.searchModule.indexProgressController",["$scope","virtoCommerce.searchModule.searchIndexation",function(e,t){var n=e.blade;e.$on("new-notification-event",(function(e,t){n.notification&&t.id==n.notification.id&&(n.progressPercentage=t.processedCount/t.totalCount*100,angular.copy(t,n.notification),t.finished&&n.parentRefresh&&n.parentRefresh())})),n.toolbarCommands=[{name:"platform.commands.cancel",icon:"fa fa-times",canExecuteMethod:function(){return n.notification&&!n.notification.finished},executeMethod:function(){t.cancel({taskId:n.notification.id})}}],n.title=n.notification.title,n.headIcon="fa fa-search",n.isLoading=!1}])},function(e,t){angular.module("virtoCommerce.searchModule").controller("virtoCommerce.searchModule.indexesListController",["$scope","platformWebApp.bladeNavigationService","platformWebApp.dialogService","virtoCommerce.searchModule.searchIndexation","platformWebApp.ui-grid.extension",function(e,t,n,o,r){var i=e.blade;i.isLoading=!1,i.manageIndexMode=!1,i.showBackupIndicesCommand={name:"Show backup indices",icon:"fas fa-eye",canExecuteMethod:function(){return!0},executeMethod:function(){i.manageIndexMode=!i.manageIndexMode,i.refresh(),i.manageIndexMode?(i.showBackupIndicesCommand.name="search.commands.hide-backup-indices",i.showBackupIndicesCommand.icon="fas fa-eye-slash"):(i.showBackupIndicesCommand.name="search.commands.show-backup-indices",i.showBackupIndicesCommand.icon="fas fa-eye")}},o.swapIndexSupported({},(function(t){i.toolbarCommands=[{name:"platform.commands.refresh",icon:"fa fa-refresh",canExecuteMethod:function(){return!0},executeMethod:function(){i.refresh()}},{name:"search.commands.rebuild-index",icon:"fa fa-recycle",canExecuteMethod:function(){return e.gridApi&&_.any(e.gridApi.selection.getSelectedRows())},executeMethod:function(){e.rebuildIndex(e.gridApi.selection.getSelectedRows())},permission:"search:index:rebuild"}],t.result&&i.toolbarCommands.push(i.showBackupIndicesCommand)})),i.refresh=function(){i.isLoading=!0,(i.manageIndexMode?o.getAll:o.get)({},(function(e){i.currentEntities=e,i.isLoading=!1}))},e.rebuildIndex=function(e){var r=_.groupBy(e,(function(e){return e.documentType})),a={id:"confirmRebuildIndex",callback:function(e){var n=_.map(r,(function(t){return{documentType:_.first(t).documentType,deleteExistingIndex:e}}));o.index(n,(function(e){var n={id:"indexProgress",notification:e,parentRefresh:i.parentRefresh,controller:"virtoCommerce.searchModule.indexProgressController",template:"Modules/$(VirtoCommerce.Search)/Scripts/blades/index-progress.tpl.html"};t.showBlade(n,i.parentBlade||i)}))}};n.showDialog(a,"Modules/$(VirtoCommerce.Search)/Scripts/dialogs/reindex-dialog.tpl.html","platformWebApp.confirmDialogController")},e.swapIndex=function(t){e.loading=!0,o.swapIndex({documentType:t},(function(e){i.refresh()}))},e.setGridOptions=function(t,n){return e.gridOptions=n,r.tryExtendGridOptions(t,n),n},i.refresh()}])},function(e,t){angular.module("virtoCommerce.searchModule").factory("virtoCommerce.searchModule.searchIndexation",["$resource",function(e){return e("api/search/indexes",{},{get:{method:"GET",isArray:!0},getAll:{method:"GET",url:"api/search/indexes/all",isArray:!0},getDocIndex:{method:"GET",url:"api/search/indexes/index/:documentType/:documentId",isArray:!0},index:{method:"POST",url:"api/search/indexes/index"},cancel:{method:"GET",url:"api/search/indexes/tasks/{taskId}/cancel",params:{taskId:"@taskId"}},swapIndexSupported:{method:"GET",url:"api/search/indexes/swapIndexSupported"},swapIndex:{method:"POST",url:"api/search/indexes/swapIndex"}})}])},function(e,t){angular.module("virtoCommerce.searchModule").controller("virtoCommerce.searchModule.indexWidgetController",["$scope","platformWebApp.bladeNavigationService","virtoCommerce.searchModule.searchIndexation","moment",function(e,t,n,o){var r=e.blade,i="YYYYMMDDHHmmss";function a(){n.getDocIndex({documentType:e.widget.documentType,documentId:r.currentEntityId},(function(t){_.any(t)&&(e.index=t[0],e.indexDate=o.utc(e.index.indexationdate,i)),e.loading=!1,c()}))}function c(){!e.loading&&r.currentEntity&&(e.widget.UIclass=!e.index||e.indexDate.isBefore(o.utc(r.currentEntity.modifiedDate,i))?"error":"")}e.loading=!0,e.openBlade=function(){var n={id:"detailChild",currentEntityId:r.currentEntityId,currentEntity:r.currentEntity,data:e.index,indexDate:e.indexDate,documentType:e.widget.documentType,parentRefresh:a,controller:"virtoCommerce.searchModule.indexDetailController",template:"Modules/$(VirtoCommerce.Search)/Scripts/blades/index-detail.tpl.html"};t.showBlade(n,r)},e.$watch("blade.currentEntity",c),a()}])},function(e,t,n){},function(e,t,n){},function(e,t,n){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLlNlYXJjaC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9WaXJ0b0NvbW1lcmNlLlNlYXJjaC8uL1NjcmlwdHMvc2VhcmNoLWluZGV4LmpzIiwid2VicGFjazovL1ZpcnRvQ29tbWVyY2UuU2VhcmNoLy4vU2NyaXB0cy9ibGFkZXMvaW5kZXgtZGV0YWlsLmpzIiwid2VicGFjazovL1ZpcnRvQ29tbWVyY2UuU2VhcmNoLy4vU2NyaXB0cy9ibGFkZXMvaW5kZXgtcHJvZ3Jlc3MuanMiLCJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5TZWFyY2gvLi9TY3JpcHRzL2JsYWRlcy9pbmRleGVzLWxpc3QuanMiLCJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5TZWFyY2gvLi9TY3JpcHRzL3Jlc291cmNlcy9zZWFyY2gtaW5kZXguanMiLCJ3ZWJwYWNrOi8vVmlydG9Db21tZXJjZS5TZWFyY2gvLi9TY3JpcHRzL3dpZGdldHMvaW5kZXgtd2lkZ2V0LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidW5kZWZpbmVkIiwiQXBwRGVwZW5kZW5jaWVzIiwicHVzaCIsImFuZ3VsYXIiLCJjb25maWciLCIkc3RhdGVQcm92aWRlciIsInN0YXRlIiwidXJsIiwiY29udHJvbGxlciIsIiRzY29wZSIsImJsYWRlTmF2aWdhdGlvblNlcnZpY2UiLCJzaG93QmxhZGUiLCJpZCIsInRpdGxlIiwiaGVhZEljb24iLCJ0ZW1wbGF0ZSIsImlzQ2xvc2luZ0Rpc2FibGVkIiwibW9kdWxlTmFtZSIsInRlbXBsYXRlVXJsIiwicnVuIiwibWFpbk1lbnVTZXJ2aWNlIiwiJHN0YXRlIiwicHVzaE5vdGlmaWNhdGlvblRlbXBsYXRlUmVzb2x2ZXIiLCJyZWdpc3RlciIsInByaW9yaXR5Iiwic2F0aXNmeSIsIm5vdGlmeSIsInBsYWNlIiwibm90aWZ5VHlwZSIsImFjdGlvbiIsImJsYWRlIiwibm90aWZpY2F0aW9uIiwiZ28iLCJhZGRNZW51SXRlbSIsInBhdGgiLCJpY29uIiwicGVybWlzc2lvbiIsInNlYXJjaEluZGV4YXRpb25BcGkiLCJpbml0aWFsaXplIiwiZGF0YSIsImN1cnJlbnRFbnRpdHkiLCJpc0xvYWRpbmciLCJ0b29sYmFyQ29tbWFuZHMiLCJpbmRleCIsImV4ZWN1dGVNZXRob2QiLCJkb2N1bWVudFR5cGUiLCJkb2N1bWVudElkcyIsImN1cnJlbnRFbnRpdHlJZCIsIm5ld0JsYWRlIiwicGFyZW50UmVmcmVzaCIsInBhcmVudEJsYWRlIiwiY2FuRXhlY3V0ZU1ldGhvZCIsImNvcHlFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInJhbmdlIiwiY3JlYXRlUmFuZ2UiLCJzZWxlY3ROb2RlIiwid2luZG93IiwiZ2V0U2VsZWN0aW9uIiwicmVtb3ZlQWxsUmFuZ2VzIiwiYWRkUmFuZ2UiLCJleGVjQ29tbWFuZCIsInN1YnRpdGxlIiwiJG9uIiwiZXZlbnQiLCJwcm9ncmVzc1BlcmNlbnRhZ2UiLCJwcm9jZXNzZWRDb3VudCIsInRvdGFsQ291bnQiLCJjb3B5IiwiZmluaXNoZWQiLCJjYW5jZWwiLCJ0YXNrSWQiLCJkaWFsb2dTZXJ2aWNlIiwiZ3JpZE9wdGlvbkV4dGVuc2lvbiIsIm1hbmFnZUluZGV4TW9kZSIsInNob3dCYWNrdXBJbmRpY2VzQ29tbWFuZCIsInJlZnJlc2giLCJzd2FwSW5kZXhTdXBwb3J0ZWQiLCJyZXNwb25zZSIsImdyaWRBcGkiLCJfIiwiYW55Iiwic2VsZWN0aW9uIiwiZ2V0U2VsZWN0ZWRSb3dzIiwicmVidWlsZEluZGV4IiwicmVzdWx0IiwiZ2V0QWxsIiwiY3VycmVudEVudGl0aWVzIiwiZG9jdW1lbnRUeXBlcyIsImRvY3VtZW50VHlwZXNHcm91cCIsImdyb3VwQnkiLCJ4IiwiZGlhbG9nIiwiY2FsbGJhY2siLCJkb1JlaW5kZXgiLCJvcHRpb25zIiwibWFwIiwiZmlyc3QiLCJkZWxldGVFeGlzdGluZ0luZGV4Iiwic2hvd0RpYWxvZyIsInN3YXBJbmRleCIsImxvYWRpbmciLCJzZXRHcmlkT3B0aW9ucyIsImdyaWRJZCIsImdyaWRPcHRpb25zIiwidHJ5RXh0ZW5kR3JpZE9wdGlvbnMiLCJmYWN0b3J5IiwiJHJlc291cmNlIiwibWV0aG9kIiwiaXNBcnJheSIsImdldERvY0luZGV4IiwicGFyYW1zIiwic2VhcmNoQXBpIiwibW9tZW50IiwibW9tZW50Rm9ybWF0Iiwid2lkZ2V0IiwiZG9jdW1lbnRJZCIsImluZGV4RGF0ZSIsInV0YyIsImluZGV4YXRpb25kYXRlIiwidXBkYXRlU3RhdHVzIiwiVUljbGFzcyIsImlzQmVmb3JlIiwibW9kaWZpZWREYXRlIiwib3BlbkJsYWRlIiwiJHdhdGNoIl0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVQyxRQUduQyxJQUFJQyxFQUFTSixFQUFpQkUsR0FBWSxDQUN6Q0csRUFBR0gsRUFDSEksR0FBRyxFQUNISCxRQUFTLElBVVYsT0FOQUksRUFBUUwsR0FBVU0sS0FBS0osRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0YsR0FHL0RHLEVBQU9FLEdBQUksRUFHSkYsRUFBT0QsUUFLZkYsRUFBb0JRLEVBQUlGLEVBR3hCTixFQUFvQlMsRUFBSVYsRUFHeEJDLEVBQW9CVSxFQUFJLFNB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TjlCLEVBQU9rQyxNQUFRSixFQUFLLEdBQ3BCOUIsRUFBTzZHLFVBQVlKLEVBQU9LLElBQUk5RyxFQUFPa0MsTUFBTTZFLGVBQWdCTCxJQUcvRDFHLEVBQU82RixTQUFVLEVBQ2pCbUIsT0FJUixTQUFTQSxLQUNBaEgsRUFBTzZGLFNBQVd4RSxFQUFNVSxnQkFDekIvQixFQUFPMkcsT0FBT00sU0FBV2pILEVBQU9rQyxPQUFVbEMsRUFBTzZHLFVBQVVLLFNBQVNULEVBQU9LLElBQUl6RixFQUFNVSxjQUFjb0YsYUFBY1QsSUFBa0IsUUFBVSxJQWZySjFHLEVBQU82RixTQUFVLEVBbUJqQjdGLEVBQU9vSCxVQUFZLFdBQ2YsSUFBSTdFLEVBQVcsQ0FDWHBDLEdBQUksY0FDSm1DLGdCQUFpQmpCLEVBQU1pQixnQkFDdkJQLGNBQWVWLEVBQU1VLGNBQ3JCRCxLQUFNOUIsRUFBT2tDLE1BQ2IyRSxVQUFXN0csRUFBTzZHLFVBQ2xCekUsYUFBY3BDLEVBQU8yRyxPQUFPdkUsYUFDNUJJLGNBQWU0QixFQUNmckUsV0FBWSxtREFDWk8sU0FBVSx3RUFFZEwsRUFBdUJDLFVBQVVxQyxFQUFVbEIsSUFHL0NyQixFQUFPcUgsT0FBTyxzQkFBdUJMLEdBRXJDNUMsUSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJ2YXIgbW9kdWxlVGVtcGxhdGVOYW1lID0gXCJ2aXJ0b0NvbW1lcmNlLnNlYXJjaE1vZHVsZVwiO1xuXG5pZiAoQXBwRGVwZW5kZW5jaWVzICE9PSB1bmRlZmluZWQpIHtcbiAgICBBcHBEZXBlbmRlbmNpZXMucHVzaChtb2R1bGVUZW1wbGF0ZU5hbWUpO1xufVxuXG5hbmd1bGFyLm1vZHVsZShtb2R1bGVUZW1wbGF0ZU5hbWUsIFtdKVxuICAgIC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnd29ya3NwYWNlLnNlYXJjaEluZGV4TW9kdWxlJywge1xuICAgICAgICAgICAgdXJsOiAnL3NlYXJjaEluZGV4JyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJHNjb3BlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJsYWRlID0ge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3NlYXJjaEluZGV4JyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdzZWFyY2guYmxhZGVzLmRvY3VtZW50LXR5cGUtbGlzdC50aXRsZScsXG4gICAgICAgICAgICAgICAgICAgIGhlYWRJY29uOiAnZmEgZmEtc2VhcmNoJyxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4ZXNMaXN0Q29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuU2VhcmNoKS9TY3JpcHRzL2JsYWRlcy9pbmRleGVzLWxpc3QudHBsLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBpc0Nsb3NpbmdEaXNhYmxlZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUoYmxhZGUpO1xuICAgICAgICAgICAgICAgICRzY29wZS5tb2R1bGVOYW1lID0gJ3ZjLWNvcmUgdmMtc2VhcmNoLWluZGV4JztcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICckKFBsYXRmb3JtKS9TY3JpcHRzL2NvbW1vbi90ZW1wbGF0ZXMvaG9tZS50cGwuaHRtbCdcbiAgICAgICAgfSk7XG4gICAgfV0pXG4gICAgLnJ1bihbJ3BsYXRmb3JtV2ViQXBwLm1haW5NZW51U2VydmljZScsICckc3RhdGUnLCAncGxhdGZvcm1XZWJBcHAucHVzaE5vdGlmaWNhdGlvblRlbXBsYXRlUmVzb2x2ZXInLCAncGxhdGZvcm1XZWJBcHAuYmxhZGVOYXZpZ2F0aW9uU2VydmljZScsXHJcbiAgICAgICAgZnVuY3Rpb24gKG1haW5NZW51U2VydmljZSwgJHN0YXRlLCBwdXNoTm90aWZpY2F0aW9uVGVtcGxhdGVSZXNvbHZlciwgYmxhZGVOYXZpZ2F0aW9uU2VydmljZSkge1xuXG4gICAgICAgICAgICAvLyByZWdpc3RlciBub3RpZmljYXRpb24gdGVtcGxhdGVcbiAgICAgICAgICAgIHB1c2hOb3RpZmljYXRpb25UZW1wbGF0ZVJlc29sdmVyLnJlZ2lzdGVyKHtcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogOTAwLFxuICAgICAgICAgICAgICAgIHNhdGlzZnk6IGZ1bmN0aW9uIChub3RpZnksIHBsYWNlKSB7IHJldHVybiBwbGFjZSA9PT0gJ2hpc3RvcnknICYmIG5vdGlmeS5ub3RpZnlUeXBlID09PSAnSW5kZXhQcm9ncmVzc1B1c2hOb3RpZmljYXRpb24nOyB9LFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuU2VhcmNoKS9TY3JpcHRzL25vdGlmaWNhdGlvbnMvaGlzdG9yeUluZGV4LnRwbC5odG1sJyxcbiAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChub3RpZnkpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsYWRlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdpbmRleFByb2dyZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbjogbm90aWZ5LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4UHJvZ3Jlc3NDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuU2VhcmNoKS9TY3JpcHRzL2JsYWRlcy9pbmRleC1wcm9ncmVzcy50cGwuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUoYmxhZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwdXNoTm90aWZpY2F0aW9uVGVtcGxhdGVSZXNvbHZlci5yZWdpc3Rlcih7XG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IDkwMCxcbiAgICAgICAgICAgICAgICBzYXRpc2Z5OiBmdW5jdGlvbiAobm90aWZ5LCBwbGFjZSkgeyByZXR1cm4gcGxhY2UgPT09ICdoZWFkZXItbm90aWZpY2F0aW9uJyAmJiBub3RpZnkubm90aWZ5VHlwZSA9PT0gJ0luZGV4UHJvZ3Jlc3NQdXNoTm90aWZpY2F0aW9uJzsgfSxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ01vZHVsZXMvJChWaXJ0b0NvbW1lcmNlLlNlYXJjaCkvU2NyaXB0cy9ub3RpZmljYXRpb25zL2hlYWRlck5vdGlmaWNhdGlvbi50cGwuaHRtbCcsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAobm90aWZ5KSB7ICRzdGF0ZS5nbygnd29ya3NwYWNlLnB1c2hOb3RpZmljYXRpb25zSGlzdG9yeScsIG5vdGlmeSkgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1haW5NZW51U2VydmljZS5hZGRNZW51SXRlbSh7XG4gICAgICAgICAgICAgICAgcGF0aDogJ2Jyb3dzZS9zZWFyY2hJbmRleCcsXG4gICAgICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLXNlYXJjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdzZWFyY2gubWFpbi1tZW51LXRpdGxlLnNlYXJjaC1pbmRleCcsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IDI1LFxuICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3dvcmtzcGFjZS5zZWFyY2hJbmRleE1vZHVsZScpO1xuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uOiAnc2VhcmNoOmluZGV4OmFjY2VzcydcclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd2aXJ0b0NvbW1lcmNlLnNlYXJjaE1vZHVsZScpXG4gICAgLmNvbnRyb2xsZXIoJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4RGV0YWlsQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLCAndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUuc2VhcmNoSW5kZXhhdGlvbicsIGZ1bmN0aW9uICgkc2NvcGUsIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UsIHNlYXJjaEluZGV4YXRpb25BcGkpIHtcbiAgICAgICAgdmFyIGJsYWRlID0gJHNjb3BlLmJsYWRlO1xuXG4gICAgICAgIGJsYWRlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgYmxhZGUuY3VycmVudEVudGl0eSA9IGRhdGE7XG4gICAgICAgICAgICBibGFkZS5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICBibGFkZS5oZWFkSWNvbiA9ICdmYSBmYS1zZWFyY2gnO1xuXG4gICAgICAgIGJsYWRlLnRvb2xiYXJDb21tYW5kcyA9IFt7XG4gICAgICAgICAgICBuYW1lOiBcInNlYXJjaC5jb21tYW5kcy5yZWJ1aWxkLWluZGV4XCIsXG4gICAgICAgICAgICBpY29uOiAnZmEgZmEtcmVjeWNsZScsXG4gICAgICAgICAgICBpbmRleDogMixcbiAgICAgICAgICAgIGV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uIChibGFkZSkge1xuICAgICAgICAgICAgICAgIHNlYXJjaEluZGV4YXRpb25BcGkuaW5kZXgoW3sgZG9jdW1lbnRUeXBlOiBibGFkZS5kb2N1bWVudFR5cGUsIGRvY3VtZW50SWRzOiBbYmxhZGUuY3VycmVudEVudGl0eUlkXSB9XSwgZnVuY3Rpb24gb3BlblByb2dyZXNzQmxhZGUoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBzaG93IGluZGV4aW5nIHByb2dyZXNzXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdCbGFkZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnaW5kZXhQcm9ncmVzcycsXG4gICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb246IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRSZWZyZXNoOiBibGFkZS5wYXJlbnRSZWZyZXNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4UHJvZ3Jlc3NDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuU2VhcmNoKS9TY3JpcHRzL2JsYWRlcy9pbmRleC1wcm9ncmVzcy50cGwuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGVOYXZpZ2F0aW9uU2VydmljZS5zaG93QmxhZGUobmV3QmxhZGUsIGJsYWRlLnBhcmVudEJsYWRlIHx8IGJsYWRlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9LFxuICAgICAgICAgICAgcGVybWlzc2lvbjogJ3NlYXJjaDppbmRleDpyZWJ1aWxkJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICBuYW1lOiBcInNlYXJjaC5jb21tYW5kcy5jb3B5LXRvLWNsaXBib2FyZFwiLFxuICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLWNsaXBib2FyZCcsXG4gICAgICAgICAgICBleGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvcHlFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbmRleERhdGFcIik7XG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3ROb2RlKGNvcHlFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgICAgICAgd2luZG93LmdldFNlbGVjdGlvbigpLmFkZFJhbmdlKHJhbmdlKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnY29weScpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9XG4gICAgICAgIH1dO1xuXG4gICAgICAgIGJsYWRlLnRpdGxlID0gYmxhZGUuY3VycmVudEVudGl0eS5uYW1lO1xuICAgICAgICBibGFkZS5zdWJ0aXRsZSA9ICdzZWFyY2guYmxhZGVzLmluZGV4LWRldGFpbC5zdWJ0aXRsZSc7XG4gICAgICAgIGlmICghYmxhZGUuZGF0YSkge1xuICAgICAgICAgICAgYmxhZGUudGl0bGUgPSAnc2VhcmNoLmJsYWRlcy5pbmRleC1kZXRhaWwudGl0bGUtbmV3JztcbiAgICAgICAgICAgIGJsYWRlLnN1YnRpdGxlID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgYmxhZGUuaW5pdGlhbGl6ZShibGFkZS5kYXRhKTtcbiAgICB9XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUnKVxuLmNvbnRyb2xsZXIoJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4UHJvZ3Jlc3NDb250cm9sbGVyJywgWyckc2NvcGUnLCAndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUuc2VhcmNoSW5kZXhhdGlvbicsIGZ1bmN0aW9uICgkc2NvcGUsIHNlYXJjaEluZGV4YXRpb25BcGkpIHtcbiAgICB2YXIgYmxhZGUgPSAkc2NvcGUuYmxhZGU7XG5cbiAgICAkc2NvcGUuJG9uKFwibmV3LW5vdGlmaWNhdGlvbi1ldmVudFwiLCBmdW5jdGlvbiAoZXZlbnQsIG5vdGlmaWNhdGlvbikge1xuICAgICAgICBpZiAoYmxhZGUubm90aWZpY2F0aW9uICYmIG5vdGlmaWNhdGlvbi5pZCA9PSBibGFkZS5ub3RpZmljYXRpb24uaWQpIHtcbiAgICAgICAgICAgIGJsYWRlLnByb2dyZXNzUGVyY2VudGFnZSA9IG5vdGlmaWNhdGlvbi5wcm9jZXNzZWRDb3VudCAvIG5vdGlmaWNhdGlvbi50b3RhbENvdW50ICogMTAwO1xuICAgICAgICAgICAgYW5ndWxhci5jb3B5KG5vdGlmaWNhdGlvbiwgYmxhZGUubm90aWZpY2F0aW9uKTtcbiAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24uZmluaXNoZWQgJiYgYmxhZGUucGFyZW50UmVmcmVzaCkge1xuICAgICAgICAgICAgICAgIGJsYWRlLnBhcmVudFJlZnJlc2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYmxhZGUudG9vbGJhckNvbW1hbmRzID0gW3tcbiAgICAgICAgbmFtZTogJ3BsYXRmb3JtLmNvbW1hbmRzLmNhbmNlbCcsXG4gICAgICAgIGljb246ICdmYSBmYS10aW1lcycsXG4gICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGJsYWRlLm5vdGlmaWNhdGlvbiAmJiAhYmxhZGUubm90aWZpY2F0aW9uLmZpbmlzaGVkO1xuICAgICAgICB9LFxuICAgICAgICBleGVjdXRlTWV0aG9kOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlYXJjaEluZGV4YXRpb25BcGkuY2FuY2VsKHsgdGFza0lkOiBibGFkZS5ub3RpZmljYXRpb24uaWQgfSk7XG4gICAgICAgIH1cbiAgICB9XTtcblxuICAgIGJsYWRlLnRpdGxlID0gYmxhZGUubm90aWZpY2F0aW9uLnRpdGxlO1xuICAgIGJsYWRlLmhlYWRJY29uID0gJ2ZhIGZhLXNlYXJjaCc7XG4gICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XG59XSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUnKVxuICAgIC5jb250cm9sbGVyKCd2aXJ0b0NvbW1lcmNlLnNlYXJjaE1vZHVsZS5pbmRleGVzTGlzdENvbnRyb2xsZXInLCBbJyRzY29wZScsICdwbGF0Zm9ybVdlYkFwcC5ibGFkZU5hdmlnYXRpb25TZXJ2aWNlJywgJ3BsYXRmb3JtV2ViQXBwLmRpYWxvZ1NlcnZpY2UnLCAndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUuc2VhcmNoSW5kZXhhdGlvbicsICdwbGF0Zm9ybVdlYkFwcC51aS1ncmlkLmV4dGVuc2lvbicsXG4gICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsIGJsYWRlTmF2aWdhdGlvblNlcnZpY2UsIGRpYWxvZ1NlcnZpY2UsIHNlYXJjaEluZGV4YXRpb25BcGksIGdyaWRPcHRpb25FeHRlbnNpb24pIHtcbiAgICAgICAgICAgIHZhciBibGFkZSA9ICRzY29wZS5ibGFkZTtcbiAgICAgICAgICAgIGJsYWRlLmlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICBibGFkZS5tYW5hZ2VJbmRleE1vZGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgYmxhZGUuc2hvd0JhY2t1cEluZGljZXNDb21tYW5kID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdTaG93IGJhY2t1cCBpbmRpY2VzJywgaWNvbjogJ2ZhcyBmYS1leWUnLFxuICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLm1hbmFnZUluZGV4TW9kZSA9ICFibGFkZS5tYW5hZ2VJbmRleE1vZGU7XG4gICAgICAgICAgICAgICAgICAgIGJsYWRlLnJlZnJlc2goKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoYmxhZGUubWFuYWdlSW5kZXhNb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBibGFkZS5zaG93QmFja3VwSW5kaWNlc0NvbW1hbmQubmFtZSA9ICdzZWFyY2guY29tbWFuZHMuaGlkZS1iYWNrdXAtaW5kaWNlcyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBibGFkZS5zaG93QmFja3VwSW5kaWNlc0NvbW1hbmQuaWNvbiA9ICdmYXMgZmEtZXllLXNsYXNoJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLnNob3dCYWNrdXBJbmRpY2VzQ29tbWFuZC5uYW1lID0gJ3NlYXJjaC5jb21tYW5kcy5zaG93LWJhY2t1cC1pbmRpY2VzJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlLnNob3dCYWNrdXBJbmRpY2VzQ29tbWFuZC5pY29uID0gJ2ZhcyBmYS1leWUnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2VhcmNoSW5kZXhhdGlvbkFwaS5zd2FwSW5kZXhTdXBwb3J0ZWQoe30sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGJsYWRlLnRvb2xiYXJDb21tYW5kcyA9IFt7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdwbGF0Zm9ybS5jb21tYW5kcy5yZWZyZXNoJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ2ZhIGZhLXJlZnJlc2gnLFxuICAgICAgICAgICAgICAgICAgICBjYW5FeGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZU1ldGhvZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYmxhZGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnc2VhcmNoLmNvbW1hbmRzLnJlYnVpbGQtaW5kZXgnLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnZmEgZmEtcmVjeWNsZScsXG4gICAgICAgICAgICAgICAgICAgIGNhbkV4ZWN1dGVNZXRob2Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZ3JpZEFwaSAmJiBfLmFueSgkc2NvcGUuZ3JpZEFwaS5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWRSb3dzKCkpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBleGVjdXRlTWV0aG9kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVidWlsZEluZGV4KCRzY29wZS5ncmlkQXBpLnNlbGVjdGlvbi5nZXRTZWxlY3RlZFJvd3MoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb246ICdzZWFyY2g6aW5kZXg6cmVidWlsZCdcbiAgICAgICAgICAgICAgICB9XTtcblxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUudG9vbGJhckNvbW1hbmRzLnB1c2goYmxhZGUuc2hvd0JhY2t1cEluZGljZXNDb21tYW5kKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBibGFkZS5pc0xvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgdmFyIGdldEluZGljZXNUYXNrO1xuICAgICAgICAgICAgICAgIGlmIChibGFkZS5tYW5hZ2VJbmRleE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0SW5kaWNlc1Rhc2sgPSBzZWFyY2hJbmRleGF0aW9uQXBpLmdldEFsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGdldEluZGljZXNUYXNrID0gc2VhcmNoSW5kZXhhdGlvbkFwaS5nZXQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZ2V0SW5kaWNlc1Rhc2soe30sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBibGFkZS5jdXJyZW50RW50aXRpZXMgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgYmxhZGUuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzY29wZS5yZWJ1aWxkSW5kZXggPSBmdW5jdGlvbiAoZG9jdW1lbnRUeXBlcykge1xuICAgICAgICAgICAgICAgIC8vIGluZGV4IG9ubHkgb25lIGRvY3VtZW50VHlwZSBpbiBjb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50VHlwZXNHcm91cCA9IF8uZ3JvdXBCeShkb2N1bWVudFR5cGVzLCBmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5kb2N1bWVudFR5cGU7IH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRpYWxvZyA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFwiY29uZmlybVJlYnVpbGRJbmRleFwiLFxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKGRvUmVpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBfLm1hcChkb2N1bWVudFR5cGVzR3JvdXAsIGZ1bmN0aW9uICh4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50VHlwZSA9IF8uZmlyc3QoeCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudFR5cGUuZG9jdW1lbnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVFeGlzdGluZ0luZGV4OiBkb1JlaW5kZXhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hJbmRleGF0aW9uQXBpLmluZGV4KG9wdGlvbnMsIGZ1bmN0aW9uIG9wZW5Qcm9ncmVzc0JsYWRlKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IGluZGV4aW5nIHByb2dyZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0JsYWRlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2luZGV4UHJvZ3Jlc3MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb246IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudFJlZnJlc2g6IGJsYWRlLnBhcmVudFJlZnJlc2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICd2aXJ0b0NvbW1lcmNlLnNlYXJjaE1vZHVsZS5pbmRleFByb2dyZXNzQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuU2VhcmNoKS9TY3JpcHRzL2JsYWRlcy9pbmRleC1wcm9ncmVzcy50cGwuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYWRlTmF2aWdhdGlvblNlcnZpY2Uuc2hvd0JsYWRlKG5ld0JsYWRlLCBibGFkZS5wYXJlbnRCbGFkZSB8fCBibGFkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkaWFsb2dTZXJ2aWNlLnNob3dEaWFsb2coZGlhbG9nLCAnTW9kdWxlcy8kKFZpcnRvQ29tbWVyY2UuU2VhcmNoKS9TY3JpcHRzL2RpYWxvZ3MvcmVpbmRleC1kaWFsb2cudHBsLmh0bWwnLCAncGxhdGZvcm1XZWJBcHAuY29uZmlybURpYWxvZ0NvbnRyb2xsZXInKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJHNjb3BlLnN3YXBJbmRleCA9IGZ1bmN0aW9uIChkb2N1bWVudFR5cGUpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICBzZWFyY2hJbmRleGF0aW9uQXBpLnN3YXBJbmRleCh7IGRvY3VtZW50VHlwZTogZG9jdW1lbnRUeXBlIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBibGFkZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHVpLWdyaWRcbiAgICAgICAgICAgICRzY29wZS5zZXRHcmlkT3B0aW9ucyA9IGZ1bmN0aW9uIChncmlkSWQsIGdyaWRPcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdyaWRPcHRpb25zID0gZ3JpZE9wdGlvbnM7XG4gICAgICAgICAgICAgICAgZ3JpZE9wdGlvbkV4dGVuc2lvbi50cnlFeHRlbmRHcmlkT3B0aW9ucyhncmlkSWQsIGdyaWRPcHRpb25zKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ3JpZE9wdGlvbnM7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYmxhZGUucmVmcmVzaCgpO1xuICAgICAgICB9XG4gICAgXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUnKVxuLmZhY3RvcnkoJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLnNlYXJjaEluZGV4YXRpb24nLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uICgkcmVzb3VyY2UpIHtcbiAgICByZXR1cm4gJHJlc291cmNlKCdhcGkvc2VhcmNoL2luZGV4ZXMnLCB7fSwge1xuICAgICAgICBnZXQ6IHsgbWV0aG9kOiAnR0VUJywgaXNBcnJheTogdHJ1ZSB9LFxuICAgICAgICBnZXRBbGw6IHsgbWV0aG9kOiAnR0VUJywgdXJsOiAnYXBpL3NlYXJjaC9pbmRleGVzL2FsbCcsIGlzQXJyYXk6IHRydWUgfSxcbiAgICAgICAgZ2V0RG9jSW5kZXg6IHsgbWV0aG9kOiAnR0VUJywgdXJsOiAnYXBpL3NlYXJjaC9pbmRleGVzL2luZGV4Lzpkb2N1bWVudFR5cGUvOmRvY3VtZW50SWQnLCBpc0FycmF5OiB0cnVlIH0sXG4gICAgICAgIGluZGV4OiB7IG1ldGhvZDogJ1BPU1QnLCB1cmw6ICdhcGkvc2VhcmNoL2luZGV4ZXMvaW5kZXgnIH0sICAgICAgIFxuICAgICAgICBjYW5jZWw6IHsgbWV0aG9kOiAnR0VUJywgdXJsOiAnYXBpL3NlYXJjaC9pbmRleGVzL3Rhc2tzL3t0YXNrSWR9L2NhbmNlbCcsIHBhcmFtczogeyB0YXNrSWQ6ICdAdGFza0lkJyB9IH0sXG4gICAgICAgIHN3YXBJbmRleFN1cHBvcnRlZDogeyBtZXRob2Q6ICdHRVQnLCB1cmw6ICdhcGkvc2VhcmNoL2luZGV4ZXMvc3dhcEluZGV4U3VwcG9ydGVkJyB9LFxuICAgICAgICBzd2FwSW5kZXg6IHsgbWV0aG9kOiAnUE9TVCcsIHVybDogJ2FwaS9zZWFyY2gvaW5kZXhlcy9zd2FwSW5kZXgnIH1cbiAgICB9KTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCd2aXJ0b0NvbW1lcmNlLnNlYXJjaE1vZHVsZScpXG4gICAgLmNvbnRyb2xsZXIoJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4V2lkZ2V0Q29udHJvbGxlcicsIFsnJHNjb3BlJywgJ3BsYXRmb3JtV2ViQXBwLmJsYWRlTmF2aWdhdGlvblNlcnZpY2UnLCAndmlydG9Db21tZXJjZS5zZWFyY2hNb2R1bGUuc2VhcmNoSW5kZXhhdGlvbicsICdtb21lbnQnLCBmdW5jdGlvbiAoJHNjb3BlLCBibGFkZU5hdmlnYXRpb25TZXJ2aWNlLCBzZWFyY2hBcGksIG1vbWVudCkge1xuICAgICAgICB2YXIgYmxhZGUgPSAkc2NvcGUuYmxhZGU7XG4gICAgICAgIHZhciBtb21lbnRGb3JtYXQgPSBcIllZWVlNTURESEhtbXNzXCI7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaCgpIHtcbiAgICAgICAgICAgIHNlYXJjaEFwaS5nZXREb2NJbmRleCh7IGRvY3VtZW50VHlwZTogJHNjb3BlLndpZGdldC5kb2N1bWVudFR5cGUsIGRvY3VtZW50SWQ6IGJsYWRlLmN1cnJlbnRFbnRpdHlJZCB9LCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChfLmFueShkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5kZXggPSBkYXRhWzBdO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5kZXhEYXRlID0gbW9tZW50LnV0Yygkc2NvcGUuaW5kZXguaW5kZXhhdGlvbmRhdGUsIG1vbWVudEZvcm1hdCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB1cGRhdGVTdGF0dXMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlU3RhdHVzKCkge1xuICAgICAgICAgICAgaWYgKCEkc2NvcGUubG9hZGluZyAmJiBibGFkZS5jdXJyZW50RW50aXR5KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLndpZGdldC5VSWNsYXNzID0gISRzY29wZS5pbmRleCB8fCAoJHNjb3BlLmluZGV4RGF0ZS5pc0JlZm9yZShtb21lbnQudXRjKGJsYWRlLmN1cnJlbnRFbnRpdHkubW9kaWZpZWREYXRlLCBtb21lbnRGb3JtYXQpKSkgPyAnZXJyb3InIDogJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUub3BlbkJsYWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG5ld0JsYWRlID0ge1xuICAgICAgICAgICAgICAgIGlkOiAnZGV0YWlsQ2hpbGQnLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRFbnRpdHlJZDogYmxhZGUuY3VycmVudEVudGl0eUlkLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRFbnRpdHk6IGJsYWRlLmN1cnJlbnRFbnRpdHksXG4gICAgICAgICAgICAgICAgZGF0YTogJHNjb3BlLmluZGV4LFxuICAgICAgICAgICAgICAgIGluZGV4RGF0ZTogJHNjb3BlLmluZGV4RGF0ZSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudFR5cGU6ICRzY29wZS53aWRnZXQuZG9jdW1lbnRUeXBlLFxuICAgICAgICAgICAgICAgIHBhcmVudFJlZnJlc2g6IHJlZnJlc2gsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3ZpcnRvQ29tbWVyY2Uuc2VhcmNoTW9kdWxlLmluZGV4RGV0YWlsQ29udHJvbGxlcicsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdNb2R1bGVzLyQoVmlydG9Db21tZXJjZS5TZWFyY2gpL1NjcmlwdHMvYmxhZGVzL2luZGV4LWRldGFpbC50cGwuaHRtbCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBibGFkZU5hdmlnYXRpb25TZXJ2aWNlLnNob3dCbGFkZShuZXdCbGFkZSwgYmxhZGUpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ2JsYWRlLmN1cnJlbnRFbnRpdHknLCB1cGRhdGVTdGF0dXMpO1xuXG4gICAgICAgIHJlZnJlc2goKTtcbiAgICB9XSk7XG4iXSwic291cmNlUm9vdCI6IiJ9