{"version":3,"sources":["../../../assets/js/app/app.js","../../../assets/js/account/account.js","../../../assets/js/account/account-addresses.js","../../../assets/js/account/account-checkout-defaults.js","../../../assets/js/account/account-company-info.js","../../../assets/js/account/account-company-member-detail.js","../../../assets/js/account/account-company-members.js","../../../assets/js/account/account-lists.js","../../../assets/js/account/account-orders.js","../../../assets/js/account/account-password-change.js","../../../assets/js/account/account-profile-update.js","../../../assets/js/account/account-quotes.js","../../../assets/js/account/account-register.js","../../../assets/js/account/account-subscriptions.js","../../../assets/js/account/accountApi.js","../../../assets/js/common-components/address.js","../../../assets/js/common-components/creditCard.js","../../../assets/js/common-components/errors.js","../../../assets/js/common-components/item-availability.js","../../../assets/js/common-components/labeled-input.js","../../../assets/js/common-components/labeled-select.js","../../../assets/js/common-components/labeled-textarea.js","../../../assets/js/common-components/lineItems.js","../../../assets/js/common-components/member.js","../../../assets/js/common-components/memberDetail.js","../../../assets/js/common-components/paymentMethods.js","../../../assets/js/common-components/paymentPlan.js","../../../assets/js/common-components/searchBar.js","../../../assets/js/common-components/totals.js","../../../assets/js/checkout/checkout-coupon.js","../../../assets/js/checkout/checkout-delivery-method.js","../../../assets/js/checkout/checkout-email.js","../../../assets/js/checkout/checkout-line-item.js","../../../assets/js/checkout/checkout-shippingMethods.js","../../../assets/js/checkout/checkout-wizard-step.js","../../../assets/js/checkout/checkout-wizard.js","../../../assets/js/checkout/checkout.js","../../../assets/js/lists/add-to-list-button.js","../../../assets/js/lists/lists-added-list-item-dialog.js","../../../assets/js/lists/lists-creation.js","../../../assets/js/lists/listsApi.js","../../../assets/js/controllers/price.js","../../../assets/js/controllers/purchase.js","../../../assets/js/directives/compareTo.js","../../../assets/js/directives/directives.js","../../../assets/js/directives/dropdown.js","../../../assets/js/directives/dropdownClose.js","../../../assets/js/directives/dropdownTrigger.js","../../../assets/js/directives/flying-placeholder.js","../../../assets/js/directives/includeRaw.js","../../../assets/js/directives/permission.js","../../../assets/js/directives/query-source.js","../../../assets/js/directives/query-target.js","../../../assets/js/directives/scope.js","../../../assets/js/inventory/filter-by-fulfillment-center-widget.js","../../../assets/js/inventory/inventory.js","../../../assets/js/inventory/inventoryApi.js","../../../assets/js/product-compare/add-to-compare-checkbox.js","../../../assets/js/product-compare/product-compare-list-bar.js","../../../assets/js/product-compare/product-compare.js","../../../assets/js/services/availability.js","../../../assets/js/services/loadingIndicator.js","../../../assets/js/services/searchQuery.js","../../../assets/js/components/purchase/shipmentType.js","../../../assets/js/controllers/dialogs/universal.js","../../../assets/js/cart.js","../../../assets/js/collection.js","../../../assets/js/filtres.js","../../../assets/js/main.js","../../../assets/js/order.js","../../../assets/js/prism.js","../../../assets/js/product.js","../../../assets/js/quote-request.js","../../../assets/js/recommendations.js","../../../assets/js/services.js","../../../assets/js/toc.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scripts.js","sourcesContent":["var storefrontAppDependencies = [\r\n    'ngStorage',\r\n    'pascalprecht.translate',\r\n    'ngSanitize',\r\n    'ngAnimate',\r\n    'ui.bootstrap',\r\n    'vcRecaptcha',\r\n    'storefrontApp.consts',\r\n    'mgo-angular-wizard'\r\n];\r\nvar storefrontApp = angular.module('storefrontApp', storefrontAppDependencies);\r\n\r\nstorefrontApp.factory('httpErrorInterceptor', [\r\n    '$q', '$rootScope', function ($q, $rootScope) {\r\n        var httpErrorInterceptor = {};\r\n\r\n        httpErrorInterceptor.responseError = function (rejection) {\r\n            if (rejection.data && rejection.data.message) {\r\n                $rootScope.$broadcast('storefrontError', {\r\n                    type: 'error',\r\n                    title: [rejection.config.method, rejection.config.url, rejection.status, rejection.statusText, rejection.data.message].join(' '),\r\n                    message: rejection.data.stackTrace\r\n                });\r\n            }\r\n            return $q.reject(rejection);\r\n        };\r\n        httpErrorInterceptor.requestError = function (rejection) {\r\n            if (rejection.data && rejection.data.message) {\r\n                $rootScope.$broadcast('storefrontError', {\r\n                    type: 'error',\r\n                    title: [rejection.config.method, rejection.config.url, rejection.status, rejection.statusText, rejection.data.message].join(' '),\r\n                    message: rejection.data.stackTrace\r\n                });\r\n            }\r\n            return $q.reject(rejection);\r\n        };\r\n\r\n        return httpErrorInterceptor;\r\n    }\r\n]);\r\n\r\nstorefrontApp.factory('themeInterceptor', ['$q', 'baseUrl', function ($q, baseUrl) {\r\n    var themeInterceptor = {};\r\n\r\n    themeInterceptor.request = function (config) {\r\n        if (config.url.startsWith('storefrontapi') || config.url.startsWith('themes')) {\r\n            config.url = baseUrl + config.url;\r\n        }\r\n        return config || $q.when(config);\r\n    };\r\n\r\n    return themeInterceptor;\r\n}\r\n]);\r\n\r\nstorefrontApp.config(['$locationProvider', '$httpProvider', 'baseUrl', '$translateProvider', 'vcRecaptchaServiceProvider', 'reCaptchaKey', function ($locationProvider, $httpProvider, baseUrl, $translateProvider, vcRecaptchaServiceProvider, reCaptchaKey) {\r\n    //$locationProvider.html5Mode({ enabled: true, requireBase: false, rewriteLinks: false });\r\n    $httpProvider.interceptors.push('httpErrorInterceptor');\r\n    $httpProvider.interceptors.push('themeInterceptor');\r\n\r\n    $translateProvider.useSanitizeValueStrategy('sanitizeParameters');\r\n    $translateProvider.useUrlLoader(baseUrl + 'themes/localization.json');\r\n    $translateProvider.preferredLanguage('en');\r\n\r\n    // wizardConfigProvider.prevString = 'Back';\r\n    // wizardConfigProvider.nextString = 'Continue';\r\n    // wizardConfigProvider.submitString = 'Complete';\r\n\r\n    vcRecaptchaServiceProvider.setSiteKey(reCaptchaKey);\r\n}]);\r\n\r\nstorefrontApp.run(['$rootScope', '$window', function ($rootScope, $window) {\r\n    $rootScope.print = function () {\r\n        $window.print();\r\n    };\r\n}]);\r\n","//Call this to register our module to main application\r\nvar moduleName = \"storefront.account\";\r\n\r\nif (storefrontAppDependencies !== undefined) {\r\n    storefrontAppDependencies.push(moduleName);\r\n}\r\nangular.module(moduleName, ['ngResource', 'ngComponentRouter', /*'credit-cards', */'pascalprecht.translate', 'ngSanitize', 'storefrontApp', 'storefrontApp.consts'])\r\n\r\n    .config(['$translateProvider', 'baseUrl', function ($translateProvider, baseUrl) {\r\n        $translateProvider.useSanitizeValueStrategy('sanitizeParameters');\r\n        $translateProvider.useUrlLoader(baseUrl + 'themes/localization.json');\r\n        $translateProvider.preferredLanguage('en');\r\n    }])\r\n\r\n    .run(['$templateCache', function ($templateCache) {\r\n        // cache application level templates\r\n        $templateCache.put('pagerTemplate.html', '<ul uib-pagination boundary-links=\"true\" max-size=\"$ctrl.pageSettings.numPages\" items-per-page=\"$ctrl.pageSettings.itemsPerPageCount\" total-items=\"$ctrl.pageSettings.totalItems\" ng-model=\"$ctrl.pageSettings.currentPage\" ng-change=\"$ctrl.pageSettings.pageChanged()\" class=\"pagination-sm\" style=\"padding-bottom: 20px;\" previous-text=\"&lsaquo;\" next-text=\"&rsaquo;\" first-text=\"&laquo;\" last-text=\"&raquo;\"></ul uib-pagination>');\r\n    }])\r\n\r\n    .value('$routerRootComponent', 'vcAccountManager')\r\n    .service('accountDialogService', ['$uibModal', function ($uibModal) {\r\n        return {\r\n            showDialog: function (dialogData, controller, templateUrl) {\r\n                var modalInstance = $uibModal.open({\r\n                    controller: controller,\r\n                    templateUrl: templateUrl,\r\n                    resolve: {\r\n                        dialogData: function () {\r\n                            return dialogData;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }])\r\n\r\n    .component('vcAccountManager', {\r\n        templateUrl: \"account-manager.tpl\",\r\n        bindings: {\r\n            baseUrl: '<',\r\n            customer: '<'\r\n        },\r\n        $routeConfig: [\r\n            { path: '/orders/...', name: 'Orders', component: 'vcAccountOrders' },\r\n            { path: '/subscriptions/...', name: 'Subscriptions', component: 'vcAccountSubscriptions' },\r\n            { path: '/quotes', name: 'Quotes', component: 'vcAccountQuotes' },\r\n            { path: '/profile', name: 'Profile', component: 'vcAccountProfileUpdate', useAsDefault: true },\r\n            { path: '/addresses', name: 'Addresses', component: 'vcAccountAddresses' },\r\n            { path: '/changePassword', name: 'PasswordChange', component: 'vcAccountPasswordChange' },\r\n            { path: '/companyInfo', name: 'CompanyInfo', component: 'vcAccountCompanyInfo' },\r\n            { path: '/companyMembers/...', name: 'CompanyMembers', component: 'vcAccountCompanyMembers' },\r\n            { path: '/lists/...', name: 'Lists', component: 'vcAccountLists' },\r\n            //{ path: '/checkoutDefaults', name: 'CheckoutDefaults', component: 'vcAccountCheckoutDefaults' },\r\n        ],\r\n        controller: ['$scope', '$timeout', 'storefrontApp.mainContext', 'loadingIndicatorService', 'commonService', function ($scope, $timeout, mainContext, loader, commonService) {\r\n            var $ctrl = this;\r\n            $ctrl.loader = loader;\r\n            $ctrl.availCountries = [];\r\n            loader.wrapLoading(function() {\r\n                return commonService.getCountries().then(function (response) {\r\n                    $ctrl.availCountries = response.data;\r\n                });\r\n            });\r\n\r\n            $ctrl.getCountryRegions = function (country) {\r\n                return loader.wrapLoading(function() {\r\n                    return commonService.getCountryRegions(country.code3).then(function (response) { return response.data; });\r\n                });\r\n            };\r\n        }]\r\n    })\r\n\r\n    .service('confirmService', ['$q', function ($q) {\r\n        this.confirm = function (message) {\r\n            return $q.when(window.confirm(message || 'Is it OK?'));\r\n        };\r\n    }])\r\n\r\n    .service('checkoutDefaultService', ['$localStorage', function ($localStorage) {\r\n        return {\r\n            paymentMethod: undefined,\r\n            shippingMethod: undefined,\r\n            deliveryMethod: undefined,\r\n            address: undefined\r\n        };       \r\n    }])\r\n\r\n","angular.module('storefront.account')\r\n.component('vcAccountAddresses', {\r\n    templateUrl: \"themes/assets/account-addresses.tpl.liquid\",\r\n    require: {\r\n        accountManager: '^vcAccountManager'\r\n    },\r\n    controller: ['storefrontApp.mainContext', 'confirmService', '$translate', '$scope', 'accountApi', 'loadingIndicatorService', function (mainContext, confirmService, $translate, $scope, accountApi, loader) {\r\n        var $ctrl = this;\r\n        $ctrl.loader = loader;\r\n\r\n        $ctrl.currentMember = mainContext.customer;\r\n        $scope.$watch(\r\n            function () { return mainContext.customer; },\r\n            function (customer) {\r\n                $ctrl.currentMember = customer;\r\n            });\r\n      \r\n        $ctrl.addNewAddress = function () {\r\n            if (_.last(components).validate()) {\r\n                $ctrl.currentMember.addresses.push($ctrl.newAddress);\r\n                $ctrl.newAddress = null;\r\n                $ctrl.updateCompanyMember($ctrl.currentMember);              \r\n            }\r\n        };\r\n\r\n        $ctrl.submit = function () {\r\n            if (components[$ctrl.editIdx].validate()) {\r\n                angular.copy($ctrl.editItem, $ctrl.currentMember.addresses[$ctrl.editIdx]);\r\n                $ctrl.updateCompanyMember($ctrl.currentMember, $ctrl.cancel);\r\n            }\r\n        };\r\n\r\n        $ctrl.cancel = function () {\r\n            $ctrl.editIdx = -1;\r\n            $ctrl.editItem = null;\r\n        };\r\n\r\n        $ctrl.edit = function ($index) {\r\n            $ctrl.editIdx = $index;\r\n            $ctrl.editItem = angular.copy($ctrl.currentMember.addresses[$ctrl.editIdx]);\r\n        };\r\n\r\n        $ctrl.delete = function ($index) {\r\n            var showDialog = function (text) {\r\n                confirmService.confirm(text).then(function (confirmed) {\r\n                    if (confirmed) {\r\n                        $ctrl.currentMember.addresses.splice($index, 1);\r\n                        $ctrl.updateCompanyMember($ctrl.currentMember);\r\n                    }\r\n                });\r\n            };\r\n\r\n            $translate('customer.addresses.delete_confirm').then(showDialog, showDialog);\r\n        };\r\n\r\n        $ctrl.updateCompanyMember = function (companyMember, handler) {\r\n            return loader.wrapLoading(function () {\r\n                return accountApi.updateUserAddresses(companyMember.addresses).then(function (response) {\r\n                    return mainContext.loadCustomer().then(function (customer) {\r\n                        $ctrl.currentMember = customer;\r\n                        if (handler) {\r\n                            handler();\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        };\r\n\r\n        var components = [];\r\n        $ctrl.addComponent = function (component) {\r\n            components.push(component);\r\n        };\r\n        $ctrl.removeComponent = function (component) {\r\n            components = _.without(components, component);\r\n        };\r\n    }]\r\n});\r\n","angular.module('storefront.account')\r\n    .component('vcAccountCheckoutDefaults', {\r\n        templateUrl: \"themes/assets/account-checkout-defaults.tpl.liquid\",\r\n        require: {\r\n            accountManager: '^vcAccountManager'\r\n        },\r\n        controller: ['storefrontApp.mainContext', '$scope', 'cartService', 'loadingIndicatorService', 'checkoutDefaultService', 'customerService', function (mainContext, $scope, cartService, loader, checkoutDefaultService, customerService) {\r\n            var $ctrl = this;\r\n            $ctrl.loader = loader;\r\n            $ctrl.defaults = checkoutDefaultService;\r\n            $ctrl.deliveryMethods = [{ type: 'shipping' }, { type: 'pickup' }];\r\n            $ctrl.customer = {};\r\n\r\n            $ctrl.getAvailPaymentMethods = function () {\r\n                return cartService.getAvailablePaymentMethods().then(function (response) {\r\n                    return response.data;\r\n                });\r\n            };\r\n\r\n            $ctrl.getAvailShippingMethods = function () {\r\n                return cartService.getAvailableShippingMethods().then(function (response) {\r\n                    return response.data;\r\n                });\r\n            }\r\n\r\n            $ctrl.getAvailPaymentMethods().then(function (paymentMethods) {\r\n                $ctrl.paymentMethods = paymentMethods;             \r\n            });\r\n\r\n            $ctrl.getAvailShippingMethods().then(function (shippingMethods) {\r\n                $ctrl.shippingMethods = shippingMethods;          \r\n            });\r\n\r\n    \r\n            customerService.getCurrentCustomer().then(function (response) {\r\n                $ctrl.customer = response.data;             \r\n            });\r\n\r\n        \r\n        }]\r\n    });\r\n","angular.module('storefront.account')\r\n.component('vcAccountCompanyInfo', {\r\n    templateUrl: \"themes/assets/account-company-info.tpl.liquid\",\r\n    require: {\r\n        accountManager: '^vcAccountManager'\r\n    },\r\n    controller: ['storefrontApp.mainContext', '$scope', '$translate', 'accountApi', 'loadingIndicatorService', 'confirmService', function (mainContext, $scope, $translate, accountApi, loader, confirmService) {\r\n        var $ctrl = this;\r\n        $ctrl.loader = loader;\r\n\r\n        function refresh() {\r\n            loader.wrapLoading(function () {\r\n                return accountApi.getUserOrganization().then(function (response) {\r\n                    $ctrl.company = response.data;\r\n                });\r\n            });\r\n        };\r\n\r\n        $ctrl.updateCompanyInfo = function (company) {\r\n            return loader.wrapLoading(function () {\r\n                return accountApi.updateUserOrganization(company).then(function () { refresh(); });\r\n            });\r\n        };\r\n\r\n        $ctrl.addNewAddress = function () {\r\n            if (_.last(components).validate()) {\r\n                $ctrl.company.addresses.push($ctrl.newAddress);\r\n                $ctrl.newAddress = null;\r\n                $ctrl.updateCompanyInfo($ctrl.company);\r\n            }\r\n        };\r\n\r\n        $ctrl.submitCompanyAddress = function () {\r\n            if (components[$ctrl.editIdx].validate()) {\r\n                angular.copy($ctrl.editItem, $ctrl.company.addresses[$ctrl.editIdx]);\r\n                $ctrl.updateCompanyInfo($ctrl.company).then($ctrl.cancel);\r\n            }\r\n        };\r\n\r\n        $ctrl.cancel = function () {\r\n            $ctrl.editIdx = -1;\r\n            $ctrl.editItem = null;\r\n        };\r\n\r\n        $ctrl.edit = function ($index) {\r\n            $ctrl.editIdx = $index;\r\n            $ctrl.editItem = angular.copy($ctrl.company.addresses[$ctrl.editIdx]);\r\n        };\r\n\r\n        $ctrl.delete = function ($index) {\r\n            var showDialog = function (text) {\r\n                confirmService.confirm(text).then(function (confirmed) {\r\n                    if (confirmed) {\r\n                        $ctrl.company.addresses.splice($index, 1);\r\n                        $ctrl.updateCompanyInfo($ctrl.company);\r\n                    }\r\n                });\r\n            };\r\n\r\n            $translate('customer.addresses.delete_confirm').then(showDialog, showDialog);\r\n        };\r\n\r\n        var components = [];\r\n        $ctrl.addComponent = function (component) {\r\n            components.push(component);\r\n        };\r\n        $ctrl.removeComponent = function (component) {\r\n            components = _.without(components, component);\r\n        };\r\n\r\n        refresh();\r\n    }]\r\n});\r\n","angular.module('storefront.account')\r\n    .component('vcAccountCompanyMemberDetail', {\r\n        templateUrl: \"account-company-member-detail.tpl\",\r\n        require: {\r\n            accountManager: '^vcAccountManager'\r\n        },\r\n        controller: ['$q', '$rootScope', '$scope', '$window', 'accountApi', 'loadingIndicatorService', function ($q, $rootScope, $scope, $window, accountApi, loader) {\r\n            var $ctrl = this;\r\n            $ctrl.loader = loader;\r\n            $ctrl.fieldsConfig = [\r\n                {\r\n                    field: 'CompanyName',\r\n                    disabled: true,\r\n                    visible: false,\r\n                    required: false\r\n                },\r\n                {\r\n                    field: 'Email',\r\n                    disabled: false,\r\n                    visible: true,\r\n                    required: true\r\n                },\r\n                {\r\n                    field: 'UserName',\r\n                    disabled: true,\r\n                    visible: false\r\n                },\r\n                {\r\n                    field: 'Password',\r\n                    disabled: true,\r\n                    visible: false\r\n                },\r\n                {\r\n                    field: 'Roles',\r\n                    disabled: false,\r\n                    visible: true\r\n                }\r\n            ];\r\n\r\n            $ctrl.memberComponent = null;\r\n\r\n            $scope.init = function (storeId) {\r\n                $ctrl.storeId = storeId;\r\n            };\r\n\r\n            function refresh() {\r\n                loader.wrapLoading(function () {\r\n                    return accountApi.getUserById($ctrl.memberNumber).then(function (response) {\r\n                        $ctrl.member = response.data;\r\n                    });\r\n                });\r\n            }\r\n\r\n            this.$routerOnActivate = function (next) {\r\n                $ctrl.pageNumber = next.params.pageNumber || 1;\r\n                $ctrl.memberNumber = next.params.member;\r\n                refresh();\r\n            };\r\n\r\n            $ctrl.submitMember = function () {\r\n                if ($ctrl.memberComponent.validate()) {\r\n                    loader.wrapLoading(function () {\r\n                        $ctrl.member.fullName = $ctrl.member.firstName + ' ' + $ctrl.member.lastName;\r\n                        $ctrl.member.emails = [$ctrl.member.email];\r\n                        $ctrl.member.roles = [$ctrl.member.role.id];\r\n                        return accountApi.updateUser($ctrl.member).then(function (response) {\r\n                            refresh();\r\n                        });\r\n                    });\r\n                };\r\n            };\r\n        }]\r\n    });\r\n\r\n","angular.module('storefront.account')\r\n    .component('vcAccountCompanyMembers', {\r\n        templateUrl: \"themes/assets/account-company-members.tpl.liquid\",\r\n        $routeConfig: [\r\n            { path: '/', name: 'MemberList', component: 'vcAccountCompanyMembersList', useAsDefault: true },\r\n            { path: '/:member', name: 'MemberDetail', component: 'vcAccountCompanyMemberDetail' }\r\n        ],\r\n        controller: ['storefrontApp.mainContext', function (mainContext) {\r\n            var $ctrl = this;\r\n        }]\r\n    })\r\n\r\n    .component('vcAccountCompanyMembersList', {\r\n        templateUrl: \"account-company-members-list.tpl\",\r\n        bindings: { $router: '<' },\r\n        controller: ['storefrontApp.mainContext', '$scope', 'accountApi', 'loadingIndicatorService', 'confirmService', '$location', '$translate', function (mainContext, $scope, accountApi, loader, confirmService, $location, $translate) {\r\n            var $ctrl = this;\r\n            $ctrl.currentMemberId = mainContext.customer.id;\r\n            $ctrl.newMemberComponent = null;\r\n            $ctrl.loader = loader;\r\n            $ctrl.pageSettings = { currentPage: 1, itemsPerPageCount: 5, numPages: 10 };\r\n            $ctrl.pageSettings.pageChanged = function () { refresh(); };\r\n\r\n            function refresh() {\r\n                $ctrl.errors = undefined;\r\n                loader.wrapLoading(function () {\r\n                    return accountApi.searchOrganizationUsers({\r\n                        skip: ($ctrl.pageSettings.currentPage - 1) * $ctrl.pageSettings.itemsPerPageCount,\r\n                        take: $ctrl.pageSettings.itemsPerPageCount,\r\n                        sortInfos: $ctrl.sortInfos\r\n                    }).then(function (response) {\r\n                        $ctrl.entries = response.data.results;                       \r\n                        $ctrl.pageSettings.totalItems = response.data.totalCount;\r\n                    });\r\n                });\r\n            };\r\n\r\n            $ctrl.addNewMemberFieldsConfig = [\r\n                {\r\n                    field: 'CompanyName',\r\n                    disabled: true,\r\n                    visible: false,\r\n                    required: false\r\n                },\r\n                {\r\n                    field: 'Email',\r\n                    disabled: false,\r\n                    visible: true,\r\n                    required: true\r\n                },\r\n                {\r\n                    field: 'UserName',\r\n                    disabled: false,\r\n                    visible: true\r\n                },\r\n                {\r\n                    field: 'Password',\r\n                    disabled: false,\r\n                    visible: true\r\n                },\r\n                {\r\n                    field: 'Roles',\r\n                    disabled: false,\r\n                    visible: true,\r\n                    required: true\r\n                }\r\n            ];\r\n\r\n            $scope.init = function (storeId, cultureName, registrationUrl) {\r\n                $ctrl.storeId = storeId;\r\n                $ctrl.cultureName = cultureName;\r\n                $ctrl.registrationUrl = registrationUrl;\r\n            };\r\n\r\n            this.$routerOnActivate = function (next) {\r\n                $ctrl.pageSettings.currentPage = next.params.pageNumber || $ctrl.pageSettings.currentPage;\r\n                refresh();\r\n            };\r\n\r\n            $ctrl.inviteEmailsValidationPattern = new RegExp(/((^|((?!^)([,;]|\\r|\\r\\n|\\n)))([a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*))+$/);\r\n            $ctrl.invite = function () {\r\n                $ctrl.inviteInfo.emails = $ctrl.inviteInfo.rawEmails.split(/[,;]|\\r|\\r\\n|\\n/g);\r\n                loader.wrapLoading(function () {\r\n                    return accountApi.createInvitation({\r\n                        emails: $ctrl.inviteInfo.emails,\r\n                        message: $ctrl.inviteInfo.message\r\n                    }).then(function(response) {\r\n                        if (response.data.succeeded) {\r\n                            $ctrl.cancel();\r\n                            refresh();\r\n                        }\r\n                        else {\r\n                            $ctrl.errors = _.pluck(response.data.errors, 'description');\r\n                        }\r\n                       \r\n                    });\r\n                });\r\n            };\r\n\r\n            $ctrl.addNewMember = function () {\r\n                if ($ctrl.newMemberComponent.validate()) {\r\n                    $ctrl.newMember.organizationId = mainContext.customer.organizationId;\r\n                    $ctrl.newMember.role = $ctrl.newMember.role ? $ctrl.newMember.role.id : undefined;\r\n                    $ctrl.newMember.storeId = $ctrl.storeId;\r\n\r\n                    loader.wrapLoading(function () {\r\n                        return accountApi.registerNewUser($ctrl.newMember).then(function(response) {\r\n                            if (response.data.succeeded) {\r\n                                $ctrl.cancel();\r\n                                $ctrl.pageSettings.currentPage = 1;\r\n                                $ctrl.pageSettings.pageChanged();\r\n                            }\r\n                            else {\r\n                                $ctrl.errors = _.pluck(response.data.errors, 'description');\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n\r\n            $ctrl.cancel = function () {\r\n                $ctrl.inviteInfo = null;\r\n                $ctrl.newMember = null;\r\n            };\r\n\r\n            $ctrl.changeStatus = function (member) {\r\n                loader.wrapLoading(function () {\r\n                    var action = member.isLockedOut ? accountApi.unlockUser : accountApi.lockUser;\r\n                    member.isLockedOut = !member.isLockedOut;\r\n                    return action(member.id).then(function (response) {\r\n                        if (response.data.succeeded) {\r\n                            refresh();\r\n                        }\r\n                        else {\r\n                            $ctrl.errors = _.pluck(response.data.errors, 'description');\r\n                        }\r\n                    });\r\n                });\r\n            };\r\n\r\n            $ctrl.edit = function (memberId) {\r\n                this.$router.navigate(['MemberDetail', { member: memberId, pageNumber: $ctrl.pageSettings.currentPage }]);\r\n            }\r\n\r\n            $ctrl.delete = function (member) {\r\n                var showDialog = function (text) {\r\n                    confirmService.confirm(text).then(function (confirmed) {\r\n                        if (confirmed) {\r\n                            loader.wrapLoading(function () {\r\n                                return accountApi.deleteUser(member.id).then(function(response) {\r\n                                    if (response.data.succeeded) {\r\n                                        refresh();\r\n                                    }\r\n                                    else {\r\n                                        $ctrl.errors = _.pluck(response.data.errors, 'description');\r\n                                    }\r\n                                });\r\n                            });\r\n                        }\r\n                    });\r\n                };\r\n\r\n                $translate('customer.edit_company_members.delete_confirm').then(showDialog, showDialog);\r\n            };\r\n\r\n            $ctrl.validate = function () {\r\n                $ctrl.inviteForm.$setSubmitted();\r\n                return $ctrl.inviteForm.valid;\r\n            };\r\n\r\n            $ctrl.showActions = function (member) {\r\n                return member.id != mainContext.customer.id;\r\n            }\r\n        }]\r\n    });\r\n","angular.module('storefront.account')\r\n    .component('vcAccountLists',\r\n        {\r\n            templateUrl: \"lists-manager.tpl\",\r\n            $routeConfig: [\r\n                { path: '/', name: 'Lists', component: 'vcAccountLists' },\r\n                { path: '/myLists', name: 'MyLists', component: 'vcAccountMyLists', useAsDefault: true }\r\n            ],\r\n            controller: [\r\n                'listsApi', '$rootScope', 'cartService', '$translate', 'loadingIndicatorService', '$timeout',\r\n                function (listsApi, $rootScope, cartService, $translate, loader, $timeout) {\r\n                    var $ctrl = this;\r\n\r\n                    $ctrl.loader = loader;\r\n                    $ctrl.selectedList = {};\r\n                    $ctrl.errors = null;\r\n\r\n                    $ctrl.selectTab = function (tabName) {\r\n                        $ctrl.selectedList = {};\r\n                        $ctrl.selectedTab = tabName;\r\n                    };\r\n\r\n                    $ctrl.selectList = function (list) {\r\n                        $ctrl.errors = null;\r\n                        $ctrl.selectedList = list;\r\n                        loader.wrapLoading(function () {\r\n                            return listsApi.getWishlist(list.name, list.type).then(function (response) {\r\n                                $ctrl.selectedList.items = response.data.items;\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    $ctrl.removeLineItem = function (lineItem, list) {\r\n                        loader.wrapLoading(function () {\r\n                            return listsApi.removeLineItem(lineItem.id, list.name, list.type).then(function (response) {\r\n                                $ctrl.selectList(list);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    $ctrl.addToCart = function (lineItem) {\r\n                        loader.wrapLoading(function () {\r\n                            return cartService.addLineItem(lineItem.productId, 1).then(function (response) {\r\n                                lineItem.productAdded = true;\r\n                                $timeout(function () { lineItem.productAdded = false; }, 10000);\r\n                                $rootScope.$broadcast('cartItemsChanged');\r\n                            });\r\n                        });\r\n                    }\r\n\r\n\r\n                }]\r\n        })\r\n    .component('vcAccountMyLists',\r\n        {\r\n            templateUrl: 'themes/assets/js/account/account-lists.tpl.liquid',\r\n            require: {\r\n                accountLists: '^^vcAccountLists'\r\n            },\r\n            controller: [\r\n                '$rootScope', 'listsApi', 'customerService', 'loadingIndicatorService', '$q', 'dialogService', function ($rootScope, listsApi, customerService, loader, $q, dialogService) {\r\n\r\n                    var $ctrl = this;\r\n\r\n                    $ctrl.type = null;\r\n                    $ctrl.predefinedLists = [];\r\n\r\n                    $ctrl.pageSettings = { currentPage: 1, itemsPerPageCount: 5, numPages: 4 };\r\n\r\n                    $ctrl.pageSettings.pageChanged = function () {\r\n                        $ctrl._searchLists();\r\n                    };\r\n\r\n                    $ctrl._searchLists = function () {\r\n                        $ctrl.accountLists.errors = null;\r\n                        loader.wrapLoading(function () {\r\n                            return listsApi.searchLists({\r\n                                pageNumber: $ctrl.pageSettings.currentPage,\r\n                                pageSize: $ctrl.pageSettings.itemsPerPageCount,\r\n                                type: $ctrl.type\r\n                            }).then(function (response) {\r\n                                $ctrl.accountLists.lists = response.data.results;\r\n                                $ctrl.pageSettings.totalItems = response.data.totalCount;\r\n\r\n                                $ctrl.accountLists.selectedList = _.first(response.data.results);\r\n                            });\r\n                        });\r\n                    };\r\n\r\n                    $ctrl.initialize = function (lists) {\r\n                        $ctrl.predefinedLists = lists.default_lists;\r\n                        $ctrl.type = lists.default_list_type;\r\n\r\n                        var promises = [];\r\n                        _.each($ctrl.predefinedLists, function (list) {\r\n                            promises.push(createList(list.name, list.type));\r\n                        });\r\n\r\n                        $q.all(promises).then(function () {\r\n                            $ctrl._searchLists();\r\n                        });\r\n                    };\r\n\r\n                    $ctrl.$onInit = function () {\r\n                        $ctrl.accountLists.selectTab('myLists');\r\n                    }\r\n\r\n                    $ctrl.createList = function () {\r\n                        var dialogData = {\r\n                            lists: $ctrl.lists,\r\n                            type: $ctrl.type\r\n                        }\r\n                        var dialogInstance = dialogService.showDialog(dialogData, 'recentlyCreateNewListDialogController', 'storefront.lists-create-new-list-dialog.tpl');\r\n\r\n                        dialogInstance.result.then(function (result) {\r\n                            if (!result)\r\n                                return;\r\n\r\n                            if (result.error) {\r\n                                $ctrl.accountLists.errors = [result.error];\r\n                            } else {\r\n                                $ctrl.pageSettings.currentPage = 1;\r\n                                $ctrl._searchLists();\r\n                            }\r\n                        });\r\n                    };\r\n\r\n                    $ctrl.addToCartAllProducts = function (listName) {\r\n                        loader.wrapLoading(function () {\r\n                            return listsApi.mergeWithCurrentCart(listName, $ctrl.type).then(function (response) {\r\n                                $rootScope.$broadcast('cartItemsChanged');\r\n                            });\r\n                        });\r\n                    }\r\n\r\n                    $ctrl.listSettings = function () {\r\n                        loader.wrapLoading(function () {\r\n                            return listsApi.searchLists({\r\n                                pageSize: 10000,\r\n                                type: $ctrl.type\r\n                            }).then(function (response) {\r\n                                var dialogData = {\r\n                                    lists: response.data.results,\r\n                                    predefinedLists: $ctrl.predefinedLists,\r\n                                    type: $ctrl.type\r\n                                }\r\n                                var dialogInstance = dialogService.showDialog(dialogData, 'recentlyCreateNewListDialogController', 'storefront.lists-settings-dialog.tpl');\r\n\r\n                                dialogInstance.result.then(function (result) {\r\n                                    $ctrl.pageSettings.currentPage = 1;\r\n                                    $ctrl._searchLists();\r\n                                });\r\n                            });\r\n                        });\r\n\r\n\r\n                    };\r\n\r\n                    function createList(listName, type) {\r\n                        return listsApi.createList(listName, type);\r\n                    }\r\n                }\r\n            ]\r\n        });\r\n","angular.module('storefront.account')\r\n    .component('vcAccountOrders', {\r\n        templateUrl: \"themes/assets/js/account/account-orders.tpl.liquid\",\r\n        $routeConfig: [\r\n            { path: '/', name: 'OrderList', component: 'vcAccountOrdersList', useAsDefault: true },\r\n            { path: '/:number', name: 'OrderDetail', component: 'vcAccountOrderDetail' }\r\n        ],\r\n        controller: [function () {\r\n            var $ctrl = this;           \r\n        }]\r\n    })\r\n    .component('vcAccountOrdersList', {\r\n        templateUrl: \"account-orders-list.tpl\",\r\n        controller: ['accountApi', 'loadingIndicatorService', function (accountApi, loader) {\r\n            var $ctrl = this;\r\n            $ctrl.loader = loader;\r\n            $ctrl.pageSettings = { currentPage: 1, itemsPerPageCount: 10, numPages: 10 };\r\n            $ctrl.pageSettings.pageChanged = function () {\r\n                return loader.wrapLoading(function () {\r\n                    return accountApi.searchUserOrders({\r\n                        pageNumber: $ctrl.pageSettings.currentPage,\r\n                        pageSize: $ctrl.pageSettings.itemsPerPageCount,\r\n                        sortInfos: $ctrl.sortInfos\r\n                    }).then(function (response) {\r\n                        $ctrl.entries = response.data.results;\r\n                        $ctrl.pageSettings.totalItems = response.data.totalCount;\r\n                    });\r\n                });\r\n            };\r\n\r\n            this.$routerOnActivate = function (next) {\r\n                $ctrl.pageSettings.currentPage = next.params.pageNumber || $ctrl.pageSettings.currentPage;\r\n                $ctrl.pageSettings.pageChanged();\r\n            };\r\n        }]\r\n    })\r\n    .component('vcAccountOrderDetail', {\r\n        templateUrl: \"account-order-detail.tpl\",\r\n        require: {\r\n            accountManager: '^vcAccountManager'\r\n        },\r\n        controller: ['$rootScope', '$window', 'loadingIndicatorService', 'confirmService', 'accountApi', 'inventoryApi', function($rootScope, $window, loader, confirmService, accountApi, inventoryApi) {\r\n            var $ctrl = this;\r\n            $ctrl.loader = loader;\r\n            $ctrl.hasPhysicalProducts = true;\r\n            var loadPromise;\r\n\r\n            function refresh() {\r\n                loader.wrapLoading(function () {\r\n                    return accountApi.getUserOrder($ctrl.orderNumber).then(function (result) {\r\n                        $ctrl.order = result.data;\r\n                        return $ctrl.order;\r\n                    }).then(function (order) {\r\n                        var lastPayment = _.last(_.sortBy(order.inPayments, 'createdDate'));\r\n                        $ctrl.billingAddress = (lastPayment && lastPayment.billingAddress) ||\r\n                            _.findWhere(order.addresses, { type: 'billing' }) ||\r\n                            _.first(order.addresses);                     \r\n\r\n                        accountApi.getUserOrderNewPaymentData(order.number).then(function (response) {\r\n                            _.each($ctrl.order.inPayments, function (x) {\r\n                                var paymentMethod = _.find(response.data.paymentMethods, function (pm) { return pm.code == x.gatewayCode; });\r\n                                if (paymentMethod) {\r\n                                    x.paymentMethod = paymentMethod;\r\n                                }\r\n                            });\r\n                        });\r\n\r\n                        //Workaround because order doesn't have any properties for pickup delivery method\r\n                        $ctrl.deliveryMethod = { type: 'shipping' };\r\n                        inventoryApi.searchFulfillmentCenters({}).then(function(response) {\r\n                            $ctrl.deliveryMethod.fulfillmentCenter = _.find(response.data.results, function(x) { return x.address.line1 == order.shipments[0].deliveryAddress.line1; });\r\n                            if ($ctrl.deliveryMethod.fulfillmentCenter) {\r\n                                $ctrl.deliveryMethod.type ='pickup';\r\n                            }\r\n                        });                        \r\n                    });\r\n                });\r\n            }\r\n\r\n            this.$routerOnActivate = function (next) {\r\n                $ctrl.pageNumber = next.params.pageNumber || 1;\r\n                $ctrl.orderNumber = next.params.number;\r\n\r\n                refresh();\r\n            };\r\n\r\n            $ctrl.getInvoicePdf = function () {\r\n                var url = $window.BASE_URL + 'storefrontapi/orders/' + $ctrl.orderNumber + '/invoice';\r\n                $window.open(url, '_blank');\r\n            }\r\n\r\n            var components = [];\r\n            $ctrl.addComponent = function (component) {\r\n                components.push(component);\r\n            };\r\n            $ctrl.removeComponent = function (component) {\r\n                components = _.without(components, component);\r\n            };\r\n\r\n            function outerRedirect(absUrl) {\r\n                $window.location.href = absUrl;\r\n            };\r\n        }]\r\n    })\r\n    .filter('orderToSummarizedStatusLabel', [function () {\r\n        return function (order) {\r\n            if (!order)\r\n                return false;\r\n\r\n            var retVal = order.status || 'New';        \r\n\r\n            return retVal;\r\n        };\r\n    }]);\r\n","angular.module('storefront.account')\r\n.component('vcAccountPasswordChange', {\r\n    templateUrl: \"themes/assets/js/account/account-password-change.tpl.liquid\",\r\n    require: {\r\n        accountManager: '^vcAccountManager'\r\n    },\r\n    controller: ['loadingIndicatorService', 'accountApi', function (loader, accountApi) {\r\n        var ctrl = this;\r\n        ctrl.loader = loader;\r\n        ctrl.passwordChangeData = {};\r\n\r\n        ctrl.submit = function () {\r\n            // validation\r\n            ctrl.errors = null;\r\n            ctrl.error = {};\r\n            var hasError = false;\r\n            var errorMsg;\r\n\r\n            errorMsg = ctrl.passwordChangeData.oldPassword === ctrl.passwordChangeData.newPassword;\r\n            ctrl.error.newPassword = errorMsg\r\n            hasError = hasError || errorMsg;\r\n\r\n            if (!hasError) {\r\n                errorMsg = ctrl.passwordChangeData.newPassword !== ctrl.passwordChangeData.newPassword2;\r\n                ctrl.error.newPassword2 = errorMsg;\r\n                hasError = hasError || errorMsg;\r\n            }\r\n\r\n            if (!hasError) {\r\n                loader.wrapLoading(function () {\r\n                    accountApi.changeUserPassword(ctrl.passwordChangeData).then(function (result) {\r\n                        angular.extend(ctrl, result);\r\n                        ctrl.passwordChangeData = {};\r\n                        ctrl.form.$setPristine();\r\n                        return result;\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        ctrl.setForm = function (frm) { ctrl.form = frm; };\r\n    }]\r\n});\r\n","angular.module('storefront.account')\r\n.component('vcAccountProfileUpdate', {\r\n    templateUrl: \"themes/assets/account-profile-update.tpl.liquid\",\r\n    require: {\r\n        accountManager: '^vcAccountManager'\r\n    },\r\n    controller: ['$q', '$scope', 'storefrontApp.mainContext', 'accountApi', 'loadingIndicatorService', 'availableRoles', function ($q, $scope, mainContext, accountApi, loader, availableRoles) {\r\n        var $ctrl = this;\r\n        $ctrl.loader = loader;\r\n        $ctrl.availableRoles = availableRoles;\r\n        $ctrl.member = mainContext.customer;\r\n  \r\n        $scope.$watch(\r\n            function () { return mainContext.customer; },\r\n            function (customer) {\r\n                $ctrl.member = customer;\r\n                if ($ctrl.member.roles) {\r\n                    $ctrl.member.role = _.find($ctrl.availableRoles, function (x) { return x.id == $ctrl.member.roles[0].id });\r\n                }\r\n            });\r\n\r\n\r\n        $ctrl.submit = function () {\r\n            $ctrl.member.fullName = $ctrl.member.firstName + ' ' + $ctrl.member.lastName;\r\n            $ctrl.member.emails = [$ctrl.member.email];\r\n            if ($ctrl.member.role) {\r\n                $ctrl.member.roles = [$ctrl.member.role.id];\r\n            }\r\n\r\n            return loader.wrapLoading(function () {\r\n                return accountApi.updateUser($ctrl.member).then(function (response) {\r\n                    return mainContext.loadCustomer().then(function (customer) {\r\n                        $ctrl.member = customer;                      \r\n                    });\r\n                });\r\n            });\r\n        };\r\n    }]\r\n});\r\n","angular.module('storefront.account')\r\n.component('vcAccountQuotes', {\r\n    templateUrl: \"themes/assets/js/account/account-quotes.tpl.liquid\",\r\n    require: {\r\n        accountManager: '^vcAccountManager'\r\n    },\r\n    controller: [function () {\r\n        var ctrl = this;\r\n        ctrl.pageSettings = { currentPage: 1, itemsPerPageCount: 5, numPages: 10 };\r\n        ctrl.pageSettings.pageChanged = function () {\r\n            ctrl.accountManager.getQuotes(ctrl.pageSettings.currentPage, ctrl.pageSettings.itemsPerPageCount, ctrl.sortInfos, function (data) {\r\n                ctrl.entries = data.results;\r\n                ctrl.pageSettings.totalItems = data.totalCount;\r\n            });\r\n        };\r\n        \r\n        this.$routerOnActivate = function (next) {\r\n            ctrl.pageSettings.currentPage = next.params.pageNumber || ctrl.pageSettings.currentPage;\r\n            ctrl.pageSettings.pageChanged();\r\n        };\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('accountRegisterController', ['$q', '$scope', 'storefrontApp.mainContext', 'loadingIndicatorService', 'vcRecaptchaService', 'commonService', 'WizardHandler', 'accountApi', \r\n    function ($q, $scope, mainContext, loader, vcRecaptchaService, commonService, WizardHandler, accountApi) {\r\n        $scope.loader = loader;\r\n        $scope.finished = false;\r\n        commonService.getCountries().then(function (response) {\r\n            $scope.countries = response.data;\r\n        });\r\n\r\n            \r\n        function populateRegionalDataForAddress(address) {\r\n            if (address) {\r\n                //Set country object for address\r\n                address.country = _.findWhere($scope.countries, { code3: address.countryCode });\r\n                if (address.country) {\r\n                    address.countryName = address.country.name;\r\n                    address.countryCode = address.country.code3;\r\n\r\n                    if (address.country.regions) {\r\n                        setAddressRegion(address, address.country.regions);\r\n                    }\r\n                    else {\r\n                        commonService.getCountryRegions(address.country.code3).then(function (response) {\r\n                            address.country.regions = response.data;\r\n                            setAddressRegion(address, response.data);\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function setAddressRegion(address, regions) {\r\n            address.region = _.findWhere(regions, { code: address.regionId });\r\n            if (address.region) {\r\n                address.regionId = address.region.code;\r\n                address.regionName = address.region.name;\r\n            }\r\n            else {\r\n                address.regionId = undefined;\r\n                address.regionName = undefined;\r\n            }\r\n        }\r\n        //Watch any address changes to repopulate address properties for user selection \r\n        $scope.$watch('registration.address', function (address) {\r\n            if (address) {\r\n                populateRegionalDataForAddress(address);\r\n            }\r\n        }, true);\r\n\r\n        $scope.init = function (storeId) {\r\n            $scope.registration = { storeId: storeId, type: 'Business', address: {}, email: null };\r\n            $scope.switchTemplate($scope.registration.type);\r\n        };\r\n   \r\n        $scope.finishedWizard = function() {\r\n            return loader.wrapLoading(function () {\r\n                return accountApi.registerOrganization($scope.registration).then(function (response) {\r\n                    if (response.data.succeeded) {\r\n                        $scope.outerRedirect($scope.baseUrl);\r\n                    } else {\r\n                        if (response.data.errors) {\r\n                            $scope.errors = _.map(response.data.errors, function(err){ return err.description; });\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        };\r\n\r\n        $scope.switchTemplate = function (type) {\r\n            if (type === 'Business') {\r\n                $scope.step1TemplateUrl = 'step1-business';\r\n                $scope.step2TemplateUrl = 'step2-business';\r\n            }\r\n            else if (type === 'Personal') {\r\n                $scope.step1TemplateUrl = 'step1-personal';\r\n                $scope.step2TemplateUrl = 'step2-personal';\r\n            }\r\n                \r\n        }\r\n    }]);\r\n","angular.module('storefront.account')\r\n.component('vcAccountSubscriptions', {\r\n    templateUrl: \"themes/assets/js/account/account-subscriptions.tpl.liquid\",\r\n    $routeConfig: [\r\n     { path: '/', name: 'SubscriptionList', component: 'vcAccountSubscriptionsList', useAsDefault: true },\r\n     { path: '/:number', name: 'SubscriptionDetail', component: 'vcAccountSubscriptionDetail' }\r\n    ]\r\n})\r\n\r\n.component('vcAccountSubscriptionsList', {\r\n    templateUrl: \"account-subscriptions-list.tpl\",\r\n    controller: ['accountApi', 'confirmService', 'loadingIndicatorService', '$translate', function (accountApi, confirmService, loader, $translate) {\r\n        var $ctrl = this;\r\n        $ctrl.loader = loader;\r\n        $ctrl.pageSettings = { currentPage: 1, itemsPerPageCount: 5, numPages: 10 };\r\n        $ctrl.pageSettings.pageChanged = function () {\r\n            loader.wrapLoading(function () {\r\n                return accountApi.searchUserSubscriptions({\r\n                    pageNumber: $ctrl.pageSettings.currentPage,\r\n                    pageSize: $ctrl.pageSettings.itemsPerPageCount,\r\n                    sortInfos: $ctrl.sortInfos\r\n                }).then(function (response) {\r\n                    $ctrl.entries = response.data.results;\r\n                    $ctrl.pageSettings.totalItems = response.data.totalCount;\r\n                });\r\n            });\r\n        };\r\n\r\n        this.$routerOnActivate = function (next) {\r\n            $ctrl.pageSettings.currentPage = next.params.pageNumber || $ctrl.pageSettings.currentPage;\r\n            $ctrl.pageSettings.pageChanged();\r\n        };\r\n    }]\r\n})\r\n\r\n.component('vcAccountSubscriptionDetail', {\r\n    templateUrl: \"account-subscription-detail.tpl\",\r\n    controller: ['accountApi', 'confirmService', 'loadingIndicatorService', '$translate', function (accountApi, confirmService, loader, $translate) {\r\n        var $ctrl = this;\r\n        $ctrl.loader = loader;\r\n\r\n        function refresh() {\r\n            loader.wrapLoading(function () {\r\n                return accountApi.getUserSubscription({ number: $ctrl.entryNumber }).then(function (response) {\r\n                    $ctrl.subscription = angular.copy(response.data);\r\n                });\r\n            });\r\n        }\r\n\r\n        this.$routerOnActivate = function (next) {\r\n            $ctrl.pageNumber = next.params.pageNumber || 1;\r\n            $ctrl.entryNumber = next.params.number;\r\n\r\n            refresh();\r\n        };\r\n\r\n        $ctrl.cancel = function () {\r\n           \r\n            loader.wrapLoading(function () {\r\n                return accountApi.cancelUserSubscription({ number: $ctrl.entryNumber, cancelReason: $ctrl.cancelReason }).then(function (result) {\r\n                    $ctrl.subscription = angular.copy(result.data);\r\n                    $ctrl.isCancelFormVisible = false;\r\n                    refresh();\r\n                });\r\n            });               \r\n        };\r\n    }]\r\n})\r\n\r\n.filter('toIntervalKey', function () {\r\n    return function (data, data_intervalCount) {\r\n        var retVal = 'customer.subscriptions.intervals.' + data.interval.toLowerCase() + '_' + (data_intervalCount === 1 ? 1 : 'plural');\r\n        //var everyKey = 'customer.subscriptions.intervals.every';\r\n\r\n        //$translate([intervalKey, everyKey]).then(function (translations) {\r\n        //var intervalVal = translations[intervalKey];\r\n        //  var everyVal = translations[everyKey];\r\n\r\n        //if (data_intervalCount === 1) {\r\n        //    retVal = intervalKey;\r\n        //} else {\r\n        //    retVal = data_intervalCount + intervalVal;\r\n        //}\r\n        //});\r\n\r\n        return retVal;\r\n    };\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.service('accountApi', ['$http', function ($http) {\r\n    return {\r\n        getCurrentUser: function () {\r\n            return $http.get('storefrontapi/account?t=' + new Date().getTime());\r\n        },\r\n        getUserById: function (userId) {\r\n            return $http.get('storefrontapi/account/' + userId + '?t=' + new Date().getTime());\r\n        },\r\n        updateUser: function (user) {\r\n            return $http.post('storefrontapi/account', user);\r\n        },\r\n        updateUserAddresses: function (addresses) {\r\n            return $http.post('storefrontapi/account/addresses', addresses);\r\n        },\r\n        getUserOrganization: function () {\r\n            return $http.get('storefrontapi/account/organization/current?t=' + new Date().getTime());\r\n        },\r\n        updateUserOrganization: function (organization) {\r\n            return $http.put('storefrontapi/account/organization', organization);\r\n        },\r\n        registerOrganization: function (registration) {\r\n            var XSRF_token = angular.element('input[name=\"__RequestVerificationToken\"]').attr('value');\r\n            return $http.post('storefrontapi/account/organization', registration, { headers: { RequestVerificationToken: XSRF_token } });\r\n        },\r\n        searchOrganizationUsers: function (criteria) {\r\n            return $http.post('storefrontapi/account/organization/users/search', criteria);\r\n        },\r\n        createInvitation: function (invitation) {\r\n            return $http.post('storefrontapi/account/invitation', invitation);\r\n        },\r\n        registerNewUser: function (user) {\r\n            return $http.post('storefrontapi/account/user', user);\r\n        },\r\n        lockUser: function (userId) {\r\n            return $http.post('storefrontapi/account/' + userId + '/lock');\r\n        },\r\n        unlockUser: function (userId) {\r\n            return $http.post('storefrontapi/account/' + userId + '/unlock');\r\n        },\r\n        deleteUser: function (userName) {\r\n            return $http.delete('storefrontapi/account/' + userName);\r\n        },\r\n        searchUserOrders: function (searchCriteria) {\r\n            return $http.post('storefrontapi/orders/search', searchCriteria);\r\n        },\r\n        getUserOrder: function (orderNumber) {            \r\n            return $http.get('storefrontapi/orders/' + orderNumber + '?t=' + new Date().getTime());\r\n        },\r\n        getUserOrderNewPaymentData: function (orderNumber) {\r\n            return $http.get('storefrontapi/orders/' + orderNumber + '/newpaymentdata?t=' + new Date().getTime());\r\n        },\r\n        searchUserSubscriptions: function (searchCriteria) {\r\n            return $http.post('storefrontapi/subscriptions/search', searchCriteria);\r\n        },\r\n        getUserSubscription: function (number) {\r\n            return $http.get('storefrontapi/subscriptions/{number}', searchCriteria);\r\n        },\r\n        cancelUserSubscription: function (cancelRequest) {\r\n            return $http.post('storefrontapi/subscriptions/cancel', cancelRequest);\r\n        },\r\n        changeUserPassword: function (passwordChangeData) {\r\n            return $http.post('storefrontapi/account/password', passwordChangeData);\r\n        },\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcAddress', {\r\n    templateUrl: \"themes/assets/address.tpl.html\",\r\n    bindings: {\r\n        address: '=',\r\n        addresses: '<',\r\n        countries: '=',\r\n        validationContainer: '=',\r\n        getCountryRegions: '&',\r\n        editMode: '<',\r\n        onUpdate: '&'\r\n    },\r\n    require: {\r\n        checkoutStep: '?^vcCheckoutWizardStep'\r\n    },\r\n    transclude: {\r\n        header: '?addressHeader', footer: '?addressFooter'\r\n    },\r\n    controller: ['$scope', function ($scope) {\r\n        var ctrl = this;\r\n        ctrl.types = [{ id: 'Billing', name: 'Billing' }, { id: 'Shipping', name: 'Shipping' }, { id: 'BillingAndShipping', name: 'Billing and Shipping' }];\r\n        \r\n        this.$onInit = function () {\r\n            if (ctrl.validationContainer)\r\n                ctrl.validationContainer.addComponent(this);\r\n            if (ctrl.checkoutStep)\r\n                ctrl.checkoutStep.addComponent(this);\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            if (ctrl.validationContainer)\r\n                ctrl.validationContainer.removeComponent(this);\r\n            if (ctrl.checkoutStep)\r\n                ctrl.checkoutStep.removeComponent(this);\r\n        };\r\n\r\n        function populateRegionalDataForAddress(address) {\r\n            if (address) {\r\n                //Set country object for address\r\n                address.country = _.findWhere(ctrl.countries, { code3: address.countryCode });\r\n                if (address.country != null) {\r\n                    ctrl.address.countryName = ctrl.address.country.name;\r\n                    ctrl.address.countryCode = ctrl.address.country.code3;\r\n                }\r\n\r\n                if (address.country) {\r\n                    if (address.country.regions) {\r\n                        setAddressRegion(address, address.country.regions);\r\n                    }\r\n                    else {\r\n                        ctrl.getCountryRegions({ country: address.country }).then(function (regions) {\r\n                            address.country.regions = regions;\r\n                            setAddressRegion(address, regions);\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function setAddressRegion(address, regions) {\r\n            address.region = _.findWhere(regions, { code: address.regionId });\r\n            if (address.region) {\r\n                ctrl.address.regionId = ctrl.address.region.code;\r\n                ctrl.address.regionName = ctrl.address.region.name;\r\n            }\r\n            else {\r\n                ctrl.address.regionId = undefined;\r\n                ctrl.address.regionName = undefined;\r\n            }\r\n        }\r\n\r\n        ctrl.setForm = function (frm) { ctrl.form = frm; };\r\n\r\n        ctrl.validate = function () {\r\n            if (ctrl.form) {\r\n                ctrl.form.$setSubmitted();\r\n                return ctrl.form.$valid;\r\n            }\r\n            return true;\r\n        };\r\n\r\n        function stringifyAddress(address) {\r\n            var addressType = '';\r\n\r\n            var type = _.find(ctrl.types, function (i) { return i.id == ctrl.address.addressType });\r\n            if (type)\r\n                addressType = '[' + type.name + '] ';\r\n\r\n            var stringifiedAddress = addressType;\r\n            stringifiedAddress += address.firstName + ' ' + address.lastName + ', ';\r\n            stringifiedAddress += address.organization ? address.organization + ', ' : '';\r\n            stringifiedAddress += address.countryName + ', ';\r\n            stringifiedAddress += address.regionName ? address.regionName + ', ' : '';\r\n            stringifiedAddress += address.city + ' ';\r\n            stringifiedAddress += address.line1 + ', ';\r\n            stringifiedAddress += address.line2 ? address.line2 : '';\r\n            stringifiedAddress += address.postalCode;\r\n            return stringifiedAddress;\r\n        }\r\n\r\n        $scope.$watch('$ctrl.address', function () {\r\n            if (ctrl.address) {\r\n                populateRegionalDataForAddress(ctrl.address);\r\n                ctrl.address.name = stringifyAddress(ctrl.address);\r\n            }\r\n            ctrl.onUpdate({ address: ctrl.address });\r\n        }, true);\r\n\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcCreditCard', {\r\n    templateUrl: \"themes/assets/js/common-components/creditCard.tpl.html\",\r\n    require: {\r\n        checkoutStep: '?^vcCheckoutWizardStep'\r\n    },\r\n    bindings: {\r\n        card: '=',\r\n        validationContainer: '='\r\n    },\r\n    controller: ['$scope', '$filter', function ($scope, $filter) {\r\n        var ctrl = this;\r\n\r\n        this.$onInit = function () {\r\n            if(ctrl.validationContainer)\r\n                ctrl.validationContainer.addComponent(this);\r\n            if (ctrl.checkoutStep)\r\n                ctrl.checkoutStep.addComponent(this);\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            if (ctrl.validationContainer)\r\n                ctrl.validationContainer.removeComponent(this);\r\n            if (ctrl.checkoutStep)\r\n                ctrl.checkoutStep.removeComponent(this);\r\n        };\r\n\r\n        $scope.$watch('$ctrl.card.bankCardHolderName', function (val) {\r\n            if (ctrl.card) {\r\n                ctrl.card.bankCardHolderName = $filter('uppercase')(val);\r\n            }\r\n        }, true);\r\n\r\n        ctrl.validate = function () {\r\n            ctrl.form.$setSubmitted();\r\n            return !ctrl.form.$invalid;\r\n        }\r\n\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcErrors', {\r\n    templateUrl: \"themes/assets/errors.tpl.html\",\r\n    bindings: {\r\n        level: '<',\r\n        message: '<',\r\n        errors: '<'\r\n    },\r\n    controller: [function () {\r\n        var $ctrl = this;\r\n        $ctrl.level = $ctrl.level || 'danger';\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcItemAvailability', {\r\n    templateUrl: \"themes/assets/js/common-components/item-availability.tpl.html\",\r\n    bindings: {\r\n        availability: \"<\"\r\n    },\r\n    controller: [function() {\r\n        var $ctrl = this;       \r\n    }]\r\n});\r\n","angular.module('storefrontApp')\r\n\r\n.component('vcLabeledInput', {\r\n    templateUrl: \"themes/assets/labeled-input.tpl.html\",\r\n    bindings: {\r\n        value: '=',\r\n        form: '=',\r\n        name: '@',\r\n        inputClass: '<',\r\n        placeholder: '@',\r\n        type: '@?',\r\n        required: '<',\r\n        requiredError: '@?',\r\n        autofocus: '<',\r\n        pattern: '@',\r\n        disabled: '<'\r\n    },\r\n    controller: [function () {\r\n        var $ctrl = this;\r\n        \r\n        $ctrl.validate = function () {\r\n            $ctrl.form.$setSubmitted();\r\n            return $ctrl.form.$valid;\r\n        };\r\n\r\n    }]\r\n});\r\n","angular.module('storefrontApp')\r\n\r\n    .component('vcLabeledSelect', {\r\n        templateUrl: \"themes/assets/labeled-select.tpl.html\",\r\n        require: {\r\n            ngModel: \"?ngModel\"\r\n        },\r\n        bindings: {\r\n            options: '<',\r\n            select: '&',\r\n            form: '<',\r\n            name: '@',\r\n            placeholder: '<',\r\n            required: '<',\r\n            requiredError: '@?',\r\n            autofocus: '<',\r\n            isOpen: '=?',\r\n            disabled: '<'\r\n        },\r\n        controller: ['$scope', function ($scope) {\r\n            var $ctrl = this;\r\n\r\n            $ctrl.$onInit = function () {\r\n                if ($ctrl.required)\r\n                    $ctrl.ngModel.$setValidity('required', false);\r\n                $ctrl.ngModel.$render = function () {\r\n                    $ctrl.value = $ctrl.ngModel.$viewValue;\r\n                };\r\n            };\r\n\r\n            $ctrl.validate = function () {\r\n                $ctrl.form.$setSubmitted();\r\n                return $ctrl.form.$valid;\r\n            };\r\n\r\n            var select = $ctrl.select;\r\n            $ctrl.select = function (option) {\r\n                $ctrl.value = option;\r\n                if ($ctrl.required)\r\n                    $ctrl.ngModel.$setValidity('required', false);\r\n                $ctrl.ngModel.$setViewValue($ctrl.value);\r\n                select(option);\r\n            };\r\n        }]\r\n    });\r\n","angular.module('storefrontApp')\r\n\r\n.component('vcLabeledTextArea', {\r\n    templateUrl: \"themes/assets/labeled-textarea.tpl.html\",\r\n    bindings: {\r\n        value: '=',\r\n        form: '=',\r\n        name: '@',\r\n        label: '@',\r\n        required: '<',\r\n        requiredError: '@?',\r\n        pattern: '<?',\r\n        autofocus: '<'\r\n    },\r\n    controller: [function () {\r\n        var $ctrl = this;\r\n\r\n        $ctrl.validate = function () {\r\n            $ctrl.form.$setSubmitted();\r\n            return $ctrl.form.$valid;\r\n        };\r\n\r\n    }]\r\n});","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcLineItems', {\r\n    templateUrl: \"themes/assets/js/common-components/lineItems.tpl.liquid\",\r\n    bindings: {\r\n        items: '='\r\n    }\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcMember', {\r\n    templateUrl: \"themes/assets/member.tpl.html\",\r\n    bindings: {\r\n        member: '=',\r\n        memberComponent: '='\r\n    },\r\n    controller: ['$scope', function ($scope) {\r\n        var $ctrl = this;\r\n\r\n        this.$onInit = function () {\r\n            $ctrl.memberComponent = this;\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            $ctrl.memberComponent = null;\r\n        };\r\n\r\n        $ctrl.setForm = function (frm) { $ctrl.form = frm; };\r\n\r\n\r\n        $ctrl.validate = function () {\r\n            if ($ctrl.form) {\r\n                $ctrl.form.$setSubmitted();\r\n                return $ctrl.form.$valid;\r\n            }\r\n            return true;\r\n        };\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcMemberDetail', {\r\n    templateUrl: \"themes/assets/memberDetail.tpl.html\",\r\n    bindings: {\r\n        member: '=',\r\n        memberComponent: '=',\r\n        fieldsConfig: '<'\r\n    },\r\n    controller: ['$scope', 'availableRoles', function ($scope, availableRoles) {\r\n        var $ctrl = this;\r\n        \r\n        $ctrl.config = [\r\n            {\r\n                field: 'CompanyName',\r\n                disabled: false,\r\n                visible: true,\r\n                required: true\r\n            },\r\n            {\r\n                field: 'Email',\r\n                disabled: false,\r\n                visible: true,\r\n                required: true\r\n            },\r\n            {\r\n                field: 'UserName',\r\n                disabled: false,\r\n                visible: true\r\n            },\r\n            {\r\n                field: 'Password',\r\n                disabled: false,\r\n                visible: true\r\n            },\r\n            {\r\n                field: 'Roles',\r\n                disabled: false,\r\n                visible:  false\r\n            }\r\n        ];\r\n\r\n        if ($ctrl.fieldsConfig)\r\n            angular.extend($ctrl.config, $ctrl.fieldsConfig);\r\n\r\n\r\n        $ctrl.availableRoles = availableRoles;\r\n\r\n        $scope.$watch('$ctrl.member', function (member) {\r\n            //Need to replace member.role to the same object from roles list for correct ui-select works\r\n            if (member && member.roles) {\r\n                member.role = _.find($ctrl.availableRoles, function (x) { return x.id == member.roles[0].id });\r\n            }\r\n        });     \r\n\r\n        $ctrl.rolesComponent = null;\r\n\r\n        this.$onInit = function () {\r\n            $ctrl.memberComponent = this;\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            $ctrl.memberComponent = null;\r\n        };\r\n\r\n        $ctrl.setForm = function (frm) {\r\n            $ctrl.form = frm;\r\n        };\r\n\r\n        $ctrl.validate = function () {\r\n            if ($ctrl.form) {\r\n                $ctrl.form.$setSubmitted();\r\n                return $ctrl.form.$valid;\r\n            }\r\n            return true;\r\n        };\r\n\r\n        $ctrl.showField = function (field) {\r\n            return getFieldConfig(field).visible == true;\r\n        }\r\n\r\n        $ctrl.disableField = function (field) {\r\n            return getFieldConfig(field).disabled == true;\r\n        }\r\n\r\n        $ctrl.requiredField = function (field) {\r\n            return getFieldConfig(field).required == true;\r\n        }\r\n\r\n        function getFieldConfig(field) {\r\n            var configItem = _.first(_.filter($ctrl.config, function (configItem) { return configItem.field === field; }));\r\n            return configItem;\r\n        }\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcPaymentMethods', {\r\n    templateUrl: \"themes/assets/js/common-components/paymentMethods.tpl.html\",\r\n    require: {\r\n        checkoutStep: '?^vcCheckoutWizardStep'\r\n    },\r\n    bindings: {\r\n        getAvailPaymentMethods: '&',\r\n        onSelectMethod: '&',\r\n        paymentMethod: '=',\r\n        validationContainer: '='\r\n    },\r\n    controller: ['$scope', function ($scope) {\r\n        var ctrl = this;\r\n\r\n        this.$onInit = function () {\r\n            ctrl.getAvailPaymentMethods().then(function (methods) {\r\n                ctrl.availPaymentMethods = _.sortBy(methods, function (x) { return x.priority; });\r\n                if (ctrl.paymentMethod) {\r\n                    ctrl.paymentMethod = _.findWhere(ctrl.availPaymentMethods, { code: ctrl.paymentMethod.code });\r\n                }\r\n                if (!ctrl.paymentMethod && ctrl.availPaymentMethods.length > 0) {\r\n                    ctrl.selectMethod(ctrl.availPaymentMethods[0]);\r\n                }\r\n            })\r\n            if (ctrl.validationContainer)\r\n                ctrl.validationContainer.addComponent(this);\r\n            if (ctrl.checkoutStep)\r\n                ctrl.checkoutStep.addComponent(this);\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            if (ctrl.validationContainer)\r\n                ctrl.validationContainer.removeComponent(this);\r\n            if (ctrl.checkoutStep)\r\n                ctrl.checkoutStep.removeComponent(this);\r\n        };\r\n\r\n        ctrl.validate = function () {\r\n            return ctrl.paymentMethod;\r\n        }\r\n\r\n        ctrl.selectMethod = function (method) {\r\n            ctrl.paymentMethod = method;\r\n            ctrl.onSelectMethod({ paymentMethod: method });\r\n        };\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcPaymentPlan', {\r\n    templateUrl: \"themes/assets/js/common-components/paymentPlan.tpl.html\",\r\n    bindings: {\r\n        availablePaymentPlans: '<',\r\n    },\r\n    controller: [function() {\r\n        var $ctrl = this;\r\n        $ctrl.type = 'once';\r\n        $ctrl.paymentPlan = $ctrl.availablePaymentPlans[0];\r\n \r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcSearchBar', {\r\n    templateUrl: \"themes/assets/js/common-components/searchBar.tpl.html\",\r\n    bindings: {\r\n        formClass: '<',\r\n        placeholder: '<',\r\n        searching: '<',\r\n        noResults: '<',\r\n        query: '@',\r\n        categoriesLabel: '<',\r\n        productsLabel: '<',\r\n        submitLabel: '<',\r\n        categoryLimit: '@',\r\n        productLimit: '@'\r\n    },\r\n    controller: ['$scope', '$q', 'catalogService', function ($scope, $q, catalogService) {\r\n        var $ctrl = this;\r\n        $ctrl.hasHint = false;\r\n\r\n        $scope.$watch('$ctrl.isOpen', function (isOpen) {\r\n            $ctrl.hasHint = !!$ctrl.query && !isOpen;\r\n        });\r\n\r\n        $scope.$watch('$ctrl.query', function (query) {\r\n            $ctrl.hasHint = !!query && !$ctrl.isOpen;\r\n        });\r\n\r\n        $ctrl.getSuggestions = function () {\r\n            var searchCriteria = { keyword: $ctrl.query, start: 0, isFuzzySearch: true };\r\n            return $q.all([\r\n                catalogService.searchCategories(angular.extend({}, searchCriteria, { pageSize: $ctrl.categoryLimit })),\r\n                catalogService.search(angular.extend({}, searchCriteria, { pageSize: $ctrl.productLimit }))\r\n            ]).then(function (results) {\r\n                var process = function (within) {\r\n                    return (results[0].data[within] || results[1].data[within]).map(function (suggestion) {\r\n                        suggestion['within'] = within;\r\n                        return suggestion;\r\n                    });\r\n                }\r\n                return process('categories').concat(process('products')).map(function (suggestion, index) {\r\n                    suggestion['index'] = index;\r\n                    return suggestion;\r\n                });\r\n            });\r\n        };\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.constant('vcTotalsDefaults', {\r\n    show: {\r\n        subtotal: true,\r\n        taxes: true,\r\n        shipping: true,\r\n        payment: true,\r\n        discount: true\r\n    },\r\n    complete: false\r\n});\r\n\r\nstorefrontApp.component('vcTotals', {\r\n    templateUrl: \"themes/assets/js/common-components/totals.tpl.liquid\",\r\n\tbindings: {\r\n        order: '<',\r\n        options: '<'\r\n    },\r\n    controller: ['vcTotalsDefaults', function(defaults) {\r\n        var $ctrl = this;\r\n\r\n        $ctrl.options = angular.merge({ }, defaults, $ctrl.options);\r\n\r\n        var fieldSuffix = $ctrl.showWithTaxes ? 'WithTax' : '';\r\n        $ctrl.fieldNames = {\r\n            subTotal: 'subTotal' + fieldSuffix,\r\n            shippingPrice: 'shippingPrice' + fieldSuffix,\r\n            shippingTotal: 'shippingTotal' + fieldSuffix,\r\n            payment: 'paymentPrice' + fieldSuffix,\r\n            discount: 'discountTotal' + fieldSuffix\r\n        };\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcCheckoutCoupon', {\r\n    templateUrl: \"themes/assets/js/checkout/checkout-coupon.tpl.html\",\r\n\tbindings: {\r\n        coupon: '=',\r\n        loader: '=',\r\n\t\tonApplyCoupon: '&',\r\n\t\tonRemoveCoupon: '&'\r\n\t},\r\n\tcontroller: [function (loader) {\r\n        var $ctrl = this;\r\n\t}]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcCheckoutDeliveryMethod', {\r\n    templateUrl: \"themes/assets/js/checkout/checkout-delivery-method.tpl.html\",\r\n    require: {\r\n        checkoutStep: '^vcCheckoutWizardStep'\r\n    },\r\n    bindings: {\r\n        deliveryMethod: '=',\r\n        onEvalAvailability: '&',\r\n        defaultMethodType: '<'\r\n    },\r\n    controller: ['$scope', 'dialogService', function ($scope, dialogService) {\r\n        var ctrl = this;\r\n\r\n        if (!ctrl.defaultMethodType) {\r\n            ctrl.defaultMethodType = 'shipping';\r\n        };\r\n\r\n        this.$onInit = function () {\r\n            ctrl.checkoutStep.addComponent(this);\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            ctrl.checkoutStep.removeComponent(this);\r\n        };\r\n        this.evalAvailability = function () {\r\n            ctrl.onEvalAvailability({ deliveryMethod: ctrl.deliveryMethod });\r\n        }\r\n\r\n        ctrl.validate = function () {\r\n            return true;\r\n        }\r\n\r\n        ctrl.selectFulfillmentCenter = function () {\r\n            var dialogInstance = dialogService.showDialog({ isFilter: true }, 'universalDialogController', 'storefront.select-fulfillment-center-dialog.tpl');\r\n            dialogInstance.result.then(function (result) {\r\n                ctrl.deliveryMethod.fulfillmentCenter = result;\r\n                ctrl.evalAvailability();\r\n            });\r\n        };\r\n\r\n        $scope.$watch('$ctrl.deliveryMethod', function () {\r\n            if (ctrl.deliveryMethod) {\r\n                ctrl.deliveryMethod.type = ctrl.deliveryMethod.type ? ctrl.deliveryMethod.type : ctrl.defaultMethodType;\r\n            }\r\n        }, true);\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcCheckoutEmail', {\r\n\ttemplateUrl: \"themes/assets/js/checkout/checkout-email.tpl.html\",\r\n\trequire: {\r\n\t\tcheckoutStep: '^vcCheckoutWizardStep'\r\n\t},\r\n\tbindings: {\r\n\t\temail: '='\r\n\t},\r\n\tcontroller: [function () {\r\n\t\tvar ctrl = this;\r\n\r\n\t\tthis.$onInit = function () {\r\n\t\t\tctrl.checkoutStep.addComponent(this);\r\n\t\t};\r\n\r\n\t\tthis.$onDestroy = function () {\r\n\t\t\tctrl.checkoutStep.removeComponent(this);\r\n\t\t};\r\n\t\r\n\t\tctrl.validate = function () {\r\n\t\t\tctrl.form.$setSubmitted();\r\n\t\t\treturn !ctrl.form.$invalid;\r\n\t\t}\r\n\r\n\t}]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcCheckoutLineItem', {\r\n    templateUrl: \"themes/assets/js/checkout/checkout-line-item.tpl.html\",\r\n    require: {\r\n        checkoutStep: '^vcCheckoutWizardStep'\r\n    },\r\n    bindings: {\r\n        lineItem: '=',\r\n        onChangeQty: '&',\r\n        onRemove: '&',\r\n        readOnly: '<'\r\n    },\r\n    controller: ['$scope', 'availablePaymentPlans', function ($scope, availablePaymentPlans) {\r\n        var ctrl = this;\r\n        ctrl.availablePaymentPlans = availablePaymentPlans;\r\n        this.$onInit = function () {\r\n            ctrl.checkoutStep.addComponent(this);\r\n        };\r\n\r\n        this.$onDestroy = function () {\r\n            ctrl.checkoutStep.removeComponent(this);\r\n        };\r\n\r\n        this.changeQty = function () {\r\n            if (ctrl.onChangeQty) {\r\n                ctrl.onChangeQty({ lineItem: ctrl.lineItem });\r\n            }\r\n        };\r\n        this.remove = function () {\r\n            ctrl.onRemove({ lineItem: ctrl.lineItem });\r\n        }\r\n\r\n        this.validate = function () {\r\n            return true;\r\n        };\r\n\r\n        $scope.$watch('$ctrl.lineItem', function (value) {           \r\n        }, true);\r\n   \r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcCheckoutShippingMethods', {\r\n\ttemplateUrl: \"themes/assets/js/checkout/checkout-shippingMethods.tpl.liquid\",\r\n\trequire: {\r\n\t\tcheckoutStep: '^vcCheckoutWizardStep'\r\n\t},\r\n\tbindings: {\r\n\t\tshipment: '=',\r\n\t\tgetAvailShippingMethods: '&',\r\n\t\tonSelectShippingMethod: '&'\r\n\t},\r\n\tcontroller: [function () {\r\n\r\n\t\tvar ctrl = this;\r\n\t\t\r\n\t\tctrl.availShippingMethods = [];\r\n\t\tctrl.selectedMethod = {};\r\n\t\tthis.$onInit = function () {\r\n\t\t\tctrl.checkoutStep.addComponent(this);\r\n\t\t\tctrl.loading = true;\r\n\t\t\tctrl.getAvailShippingMethods(ctrl.shipment).then(function (availMethods) {\r\n\t\t\t\tctrl.availShippingMethods = availMethods;\r\n\t\t\t\t_.each(ctrl.availShippingMethods, function (x) {\r\n\t\t\t\t\tx.id = getMethodId(x);\r\n\t\t\t\t});\r\n\t\t\t\tctrl.selectedMethod = _.find(ctrl.availShippingMethods, function (x) { return ctrl.shipment.shipmentMethodCode == x.shipmentMethodCode && ctrl.shipment.shipmentMethodOption == x.optionName });\r\n\t\t\t\tctrl.loading = false;\r\n\t\t\t});\r\n\t\t};\t\t\r\n\t\t\r\n\t\tthis.$onDestroy = function () {\r\n\t\t\tctrl.checkoutStep.removeComponent(this);\r\n\t\t};\r\n\t\t\t\r\n\t\tfunction getMethodId(method) {\r\n\t\t\tvar retVal = method.shipmentMethodCode;\r\n\t\t\tif (method.optionName) {\r\n\t\t\t\tretVal += ':' + method.optionName;\r\n\t\t\t}\r\n\t\t\treturn retVal;\r\n\t\t}\r\n\r\n\t\tctrl.selectMethod = function (method) {\r\n\t\t\tctrl.selectedMethod = method;\r\n\t\t\tctrl.onSelectShippingMethod({ shippingMethod: method });\r\n\t\t};\r\n\t\r\n\t\tctrl.validate = function () {\r\n\t\t\tctrl.form.$setSubmitted();\r\n\t\t\treturn !ctrl.form.$invalid;\r\n\t\t}\r\n\t}]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcCheckoutWizardStep', {\r\n    templateUrl: \"themes/assets/js/checkout/checkout-wizard-step.tpl.html\",\r\n    transclude: true,\r\n    require: {\r\n        wizard: '^vcCheckoutWizard'\r\n    },\r\n    bindings: {\r\n        name: '@',\r\n        title: '@',\r\n        stepDisabled: '=?',\r\n        onNextStep: '&?',\r\n        canEnter: '=?',\r\n        final: '<?'\r\n    },\r\n    controller: [function () {\r\n        var ctrl = this;\r\n        ctrl.components = [];\r\n        ctrl.canEnter = true;\r\n\r\n        this.$onInit = function () {\r\n            ctrl.wizard.addStep(this);\r\n        };\r\n\r\n        ctrl.addComponent = function (component) {\r\n            ctrl.components.push(component);\r\n        };\r\n        ctrl.removeComponent = function (component) {\r\n            ctrl.components = _.without(ctrl.components, component);\r\n        };\r\n        ctrl.validate = function () {\r\n            return _.every(ctrl.components, function (x) { return typeof x.validate !== \"function\" || x.validate(); });\r\n        }\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('vcCheckoutWizard', {\r\n\ttransclude: true,\r\n\ttemplateUrl: 'themes/assets/js/checkout/checkout-wizard.tpl.html',\r\n\tbindings: {\r\n\t\twizardModel: '=',\r\n\t\tloading: '=',\r\n\t\tonFinish: '&?',\r\n\t\tonInitialized: '&?'\r\n\t},\r\n\tcontroller: ['$scope', function ($scope) {\r\n\t\tvar ctrl = this;\r\n        ctrl.wizardModel = ctrl;\r\n\t\tctrl.steps = [];\t\r\n\t\tctrl.goToStep = function (step) {\r\n\t\t\tif (angular.isString(step))\r\n\t\t\t{\r\n\t\t\t\tstep = _.find(ctrl.steps, function (x) { return x.name == step; });\r\n\t\t\t}\r\n            if (step && ctrl.currentStep != step && step.canEnter) {\r\n                step.isActive = true;\r\n                if (ctrl.currentStep) {\r\n                    ctrl.currentStep.isActive = false;\r\n                }\r\n                ctrl.currentStep = step;\r\n                if (step.final && ctrl.onFinish) {\r\n                    ctrl.onFinish();\r\n                }\r\n            }\r\n        };\r\n\r\n\t\tctrl.nextStep = function () {\r\n\t\t\tif (!ctrl.currentStep.validate || ctrl.currentStep.validate()) {\r\n\t\t\t\tif (ctrl.currentStep.nextStep) {\r\n\t\t\t\t\tif (ctrl.currentStep.onNextStep) {\r\n\t\t\t\t\t\t//evaluate onNextStep function\r\n\t\t\t\t\t\tvar promise = ctrl.currentStep.onNextStep();\r\n\t\t\t\t\t\t//For promise function need to delay going to next step\r\n\t\t\t\t\t\tif (promise && angular.isFunction(promise.then)) {\r\n\t\t\t\t\t\t\tpromise.then(function () {\r\n\t\t\t\t\t\t\t\tctrl.goToStep(ctrl.currentStep.nextStep);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tctrl.goToStep(ctrl.currentStep.nextStep);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tctrl.goToStep(ctrl.currentStep.nextStep);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tctrl.prevStep = function () {\r\n\t\t\tctrl.goToStep(ctrl.currentStep.prevStep);\r\n\t\t};\r\n\r\n\t\tfunction rebuildStepsLinkedList(steps) {\r\n\t\t\tvar nextStep = undefined;\r\n\t\t\tfor (var i = steps.length; i-- > 0;) {\r\n\t\t\t\tsteps[i].prevStep = undefined;\r\n\t\t\t\tsteps[i].nextStep = undefined;\r\n\t\t\t\tif (nextStep && !steps[i].disabled) {\r\n\t\t\t\t\tnextStep.prevStep = steps[i]\r\n\t\t\t\t};\t\t\t\t\r\n\t\t\t\tif (!steps[i].disabled) {\r\n\t\t\t\t\tsteps[i].nextStep = nextStep;\r\n\t\t\t\t\tnextStep = steps[i];\r\n\t\t\t\t}\r\n\t\t\t}\t\t\r\n\t\t};\r\n\t\t\r\n\t\tctrl.addStep = function (step) {\r\n\t\t\tctrl.steps.push(step);\r\n\t\t\t$scope.$watch(function () { return step.disabled; }, function () {\r\n\t\t\t\trebuildStepsLinkedList(ctrl.steps);\t\t\t\r\n\t\t\t});\r\n\t\t\trebuildStepsLinkedList(ctrl.steps);\r\n\t\t\tif(!ctrl.currentStep)\r\n\t\t\t{\r\n\t\t\t\tctrl.goToStep(step);\r\n\t\t\t}\r\n\t\t\tif (step.final && ctrl.onInitialized)\r\n\t\t\t{\r\n\t\t\t\tctrl.onInitialized();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t}]\r\n});\r\n","//Call this to register our module to main application\r\nvar moduleName = \"storefront.checkout\";\r\n\r\nif (storefrontAppDependencies != undefined) {\r\n    storefrontAppDependencies.push(moduleName);\r\n}\r\nangular.module(moduleName, ['credit-cards', 'angular.filter'])\r\n    .controller('checkoutController', ['$rootScope', '$scope', '$window', 'cartService', 'commonService', 'dialogService', 'orderService',\r\n        function ($rootScope, $scope, $window, cartService, commonService, dialogService, orderService) {\r\n            $scope.checkout = {\r\n                wizard: {},\r\n                order: {},\r\n                deliveryAddress: {},\r\n                paymentMethod: {},\r\n                shipmentMethod: {},\r\n                deliveryMethod: {},\r\n                shipment: {},\r\n                payment: {},\r\n                coupon: {},\r\n                availCountries: [],               \r\n                loading: false,\r\n                isValid: false,\r\n                newAddress: {}\r\n            };\r\n\r\n            $scope.getInvoicePdf = function () {\r\n                var url = $window.BASE_URL + 'storefrontapi/orders/' + $scope.checkout.order.number + '/invoice';\r\n                $window.open(url, '_blank');\r\n            }\r\n\r\n            $scope.changeShippingMethod = function () {\r\n                $scope.getAvailShippingMethods($scope.checkout.shipment).then(function (response) {\r\n                    var dialogInstance = dialogService.showDialog({ availShippingMethods: response, checkout: $scope.checkout }, 'universalDialogController', 'storefront.select-shipment-method-dialog.tpl');\r\n                    dialogInstance.result.then(function (shipmentMethod) {\r\n                        $scope.selectShippingMethod(shipmentMethod);\r\n                    });\r\n                });\r\n            };\r\n\r\n            $scope.changePaymentMethod = function () {\r\n                $scope.getAvailPaymentMethods().then(function (response) {\r\n                    var dialogInstance = dialogService.showDialog({ availPaymentMethods: response, checkout: $scope.checkout }, 'universalDialogController', 'storefront.select-payment-method-dialog.tpl');\r\n                    dialogInstance.result.then(function (paymentMethod) {\r\n                        $scope.selectPaymentMethod(paymentMethod);\r\n                    });\r\n                });\r\n            };\r\n\r\n            $scope.changePickupAddress = function () {\r\n                var dialogInstance = dialogService.showDialog({}, 'universalDialogController', 'storefront.select-fulfillment-center-dialog.tpl');\r\n                dialogInstance.result.then(function(fulfillmentCenter) {\r\n                    $scope.checkout.deliveryMethod.fulfillmentCenter = fulfillmentCenter;\r\n                    $scope.checkout.shipment.deliveryAddress = fulfillmentCenter.address;\r\n                    $scope.updateShipment($scope.checkout.shipment);\r\n                });\r\n            };\r\n\r\n            $scope.changeShippingAddress = function () {\r\n                var dialogData =\r\n                    {                     \r\n                        checkout: $scope.checkout,\r\n                        addresses: $scope.checkout.cart.customer.addresses\r\n                    };\r\n\r\n                var dialogInstance = dialogService.showDialog(dialogData, 'universalDialogController', 'storefront.select-address-dialog.tpl');\r\n                dialogInstance.result.then(function (address) {\r\n                    if (address == $scope.checkout.newAddress) {\r\n                        dialogInstance = dialogService.showDialog(dialogData, 'universalDialogController', 'storefront.new-address-dialog.tpl');\r\n                        dialogInstance.result.then(function (address) {\r\n                            if (!$scope.checkout.cart.customer.addresses) {\r\n                                $scope.checkout.cart.customer.addresses = [];\r\n                            }\r\n                            $scope.checkout.cart.customer.addresses.push(address);\r\n                            $scope.checkout.shipment.deliveryAddress = address;\r\n                        });\r\n                    }\r\n                    else {\r\n                        $scope.checkout.shipment.deliveryAddress = address;\r\n                    }\r\n                    $scope.updateShipment($scope.checkout.shipment);\r\n                });\r\n            };\r\n\r\n            $scope.evalAvailability = function (deliveryMethod) {\r\n                _.each($scope.checkout.cart.items, function (x) {\r\n                    x.availability = {\r\n                        deliveryMethod: deliveryMethod,\r\n                        availDate: Date.now()\r\n                    };\r\n                });\r\n            };\r\n\r\n            $scope.changeItemQty = function (lineItem) {\r\n                return wrapLoading(function () {\r\n                    return cartService.changeLineItemsQuantity({ lineItemId: lineItem.id, Quantity: lineItem.quantity }).then($scope.reloadCart);\r\n                });\r\n            };\r\n\r\n            $scope.removeItem = function (lineItem) {\r\n                return wrapLoading(function () {\r\n                    return cartService.removeLineItem(lineItem.id).then($scope.reloadCart);\r\n                });\r\n            };\r\n            $scope.validateCheckout = function (checkout) {\r\n                checkout.isValid = checkout.payment && checkout.payment.paymentGatewayCode;\r\n                if (checkout.isValid && !checkout.billingAddressEqualsShipping) {\r\n                    checkout.isValid = angular.isObject(checkout.payment.billingAddress);\r\n                }\r\n                if (checkout.isValid && checkout.cart && checkout.deliveryMethod.type == 'shipping') {\r\n                    checkout.isValid = angular.isObject(checkout.shipment)\r\n                        && checkout.shipment.shipmentMethodCode\r\n                        && angular.isObject(checkout.shipment.deliveryAddress);\r\n                }\r\n            };\r\n\r\n            $scope.reloadCart = function () {\r\n                return cartService.getCart().then(function (response) {\r\n                    var cart = response.data;\r\n\r\n                    $scope.checkout.cart = cart;\r\n                    if (cart.payments.length) {\r\n                        $scope.checkout.payment = cart.payments[0];\r\n                        $scope.checkout.paymentMethod.code = $scope.checkout.payment.paymentGatewayCode;\r\n                        $scope.getAvailPaymentMethods().then(function (response) {\r\n                            _.each(cart.payments, function (x) {\r\n                                var paymentMethod = _.find(response, function (pm) { return pm.code == x.paymentGatewayCode; });\r\n                                if (paymentMethod) {\r\n                                    angular.extend(x, paymentMethod);\r\n                                    $scope.checkout.paymentMethod = paymentMethod;\r\n                                }\r\n                            });\r\n                        });\r\n                    }\r\n                    if (cart.shipments.length) {\r\n                        $scope.checkout.shipment = cart.shipments[0];\r\n                        //Load shipment method for cart shipment\r\n                        $scope.getAvailShippingMethods($scope.checkout.shipment).then(function (response) {\r\n                            var shipmentMethod = _.find(response, function (sm) { return sm.shipmentMethodCode == $scope.checkout.shipment.shipmentMethodCode && sm.optionName == $scope.checkout.shipment.shipmentMethodOption; });\r\n                            if (shipmentMethod) {\r\n                                $scope.checkout.shipment.shipmentMethod = shipmentMethod;\r\n                            }\r\n                        });\r\n                    }\r\n                    else {\r\n                        //Set default shipping address\r\n                        if ($scope.checkout.cart.customer.addresses) {\r\n                            $scope.checkout.shipment.deliveryAddress = $scope.checkout.cart.customer.addresses[0];\r\n                        }\r\n                    }\r\n                    $scope.checkout.billingAddressEqualsShipping = cart.hasPhysicalProducts && !angular.isObject($scope.checkout.payment.billingAddress);\r\n\r\n                    $scope.checkout.canCartBeRecurring = $scope.customer.isRegisteredUser && _.all(cart.items, function (x) { return !x.isReccuring });\r\n                    $scope.checkout.paymentPlan = cart.paymentPlan && _.findWhere($scope.checkout.availablePaymentPlans, { intervalCount: cart.paymentPlan.intervalCount, interval: cart.paymentPlan.interval }) ||\r\n                        _.findWhere($scope.checkout.availablePaymentPlans, { intervalCount: 1, interval: 'months' });\r\n\r\n                    $scope.validateCheckout($scope.checkout);\r\n                    return cart;\r\n                });\r\n            };\r\n\r\n            $scope.selectPaymentMethod = function (paymentMethod) {\r\n                angular.extend($scope.checkout.payment, paymentMethod);\r\n                $scope.checkout.payment.paymentGatewayCode = paymentMethod.code;\r\n                $scope.checkout.payment.amount = angular.copy($scope.checkout.cart.total);\r\n                $scope.checkout.payment.amount.amount += paymentMethod.totalWithTax.amount;\r\n\r\n                updatePayment($scope.checkout.payment);\r\n            };\r\n\r\n            function getAvailCountries() {\r\n                //Load avail countries\r\n                return commonService.getCountries().then(function (response) {\r\n                    return response.data;\r\n                });\r\n            };\r\n\r\n            $scope.checkout.getCountryRegions = $scope.getCountryRegions = function (country) {\r\n                return commonService.getCountryRegions(country.code3).then(function (response) {\r\n                    return response.data;\r\n                });\r\n            };\r\n\r\n            $scope.getAvailShippingMethods = function (shipment) {\r\n                return wrapLoading(function () {\r\n                    return cartService.getAvailableShippingMethods(shipment.id).then(function (response) {\r\n                        return response.data;\r\n                    });\r\n                });\r\n            }\r\n\r\n            $scope.getAvailPaymentMethods = function () {\r\n                return wrapLoading(function () {\r\n                    return cartService.getAvailablePaymentMethods().then(function (response) {\r\n                        return response.data;\r\n                    });\r\n                });\r\n            };\r\n\r\n            $scope.selectShippingMethod = function (shippingMethod) {\r\n                if (shippingMethod) {\r\n                    $scope.checkout.shipment.shipmentMethodCode = shippingMethod.shipmentMethodCode;\r\n                    $scope.checkout.shipment.shipmentMethodOption = shippingMethod.optionName;\r\n                }\r\n                else {\r\n                    $scope.checkout.shipment.shipmentMethodCode = undefined;\r\n                    $scope.checkout.shipment.shipmentMethodOption = undefined;\r\n                }\r\n                $scope.updateShipment($scope.checkout.shipment);\r\n            };\r\n\r\n            $scope.updateShipment = function (shipment) {\r\n                if (shipment.deliveryAddress) {\r\n                    var deliveryAddress = $scope.checkout.shipment.deliveryAddress;\r\n                    deliveryAddress.type = 'Shipping';\r\n                    //WORKAROUND: For pickup address FirstName and LastName can't set and need use some to avoid required violation\r\n                    deliveryAddress.firstName = deliveryAddress.firstName ? deliveryAddress.firstName : 'Fulfillment';\r\n                    deliveryAddress.lastName = deliveryAddress.lastName ? deliveryAddress.lastName : 'center';\r\n                };\r\n                //Does not pass validation errors to API\r\n                shipment.validationErrors = undefined;\r\n                return wrapLoading(function () {\r\n                    return cartService.addOrUpdateShipment(shipment).then($scope.reloadCart);\r\n                });\r\n            };\r\n\r\n            $scope.createOrder = function () {\r\n                wrapLoading(function() {\r\n                    return cartService.createOrder($scope.checkout.paymentMethod.card).then(function(response) {\r\n\r\n                        var orderProcessingResult = response.data.orderProcessingResult;\r\n                        var paymentMethod = response.data.paymentMethod;\r\n\r\n                        return orderService.getOrder(response.data.order.number).then(function(response) {\r\n                            var order = response.data;\r\n                            $scope.checkout.order = order;\r\n                            handlePostPaymentResult(order, orderProcessingResult, paymentMethod);\r\n                        });\r\n                    });\r\n\r\n                });\r\n            };\r\n\r\n            $scope.savePaymentPlan = function () {\r\n                wrapLoading(function () {\r\n                    return cartService.addOrUpdatePaymentPlan($scope.checkout.paymentPlan).then(function () {\r\n                        $scope.checkout.cart.paymentPlan = $scope.checkout.paymentPlan;\r\n                    });\r\n                });\r\n            };\r\n\r\n            $scope.isRecurringChanged = function (isRecurring) {\r\n                if ($scope.checkout.paymentPlan) {\r\n                    if (isRecurring) {\r\n                        $scope.savePaymentPlan();\r\n                    } else {\r\n                        wrapLoading(function () {\r\n                            return cartService.removePaymentPlan().then(function () {\r\n                                $scope.checkout.cart.paymentPlan = undefined;\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n\r\n            function updatePayment(payment) {\r\n                if ($scope.checkout.billingAddressEqualsShipping) {\r\n                    payment.billingAddress = undefined;\r\n                }\r\n\r\n                if (payment.billingAddress) {\r\n                    payment.billingAddress.type = 'Billing';\r\n                }\r\n                return wrapLoading(function () {\r\n                    return cartService.addOrUpdatePayment(payment).then($scope.reloadCart);\r\n                });\r\n            }\r\n\r\n            function handlePostPaymentResult(order, orderProcessingResult, paymentMethod) {\r\n                if (!orderProcessingResult.isSuccess) {\r\n                    $scope.checkout.loading = false;\r\n                    $rootScope.$broadcast('storefrontError', {\r\n                        type: 'error',\r\n                        title: ['Error in new order processing: ', orderProcessingResult.error, 'New Payment status: ' + orderProcessingResult.newPaymentStatus].join(' '),\r\n                        message: orderProcessingResult.error,\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                if (paymentMethod.paymentMethodType && paymentMethod.paymentMethodType.toLowerCase() == 'preparedform' && orderProcessingResult.htmlForm) {\r\n                    $scope.outerRedirect($scope.baseUrl + 'cart/checkout/paymentform?orderNumber=' + order.number);\r\n                } else if (paymentMethod.paymentMethodType && paymentMethod.paymentMethodType.toLowerCase() == 'redirection' && orderProcessingResult.redirectUrl) {\r\n                    $window.location.href = orderProcessingResult.redirectUrl;\r\n                } else {\r\n                    if (!$scope.customer.isRegisteredUser) {\r\n                        $scope.checkout.wizard.nextStep();\r\n                        // $scope.outerRedirect($scope.baseUrl + 'cart/thanks/' + order.number);\r\n                    } else {\r\n                        $scope.checkout.wizard.nextStep();\r\n                        // $scope.outerRedirect($scope.baseUrl + 'account#/orders/' + order.number);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function wrapLoading(func) {\r\n                $scope.checkout.loading = true;\r\n                return func().then(function (result) {\r\n                    $scope.checkout.loading = false;\r\n                    return result;\r\n                },\r\n                    function () {\r\n                        $scope.checkout.loading = false;\r\n                    });\r\n            }\r\n\r\n            $scope.initialize = function () {\r\n\r\n                $scope.reloadCart().then(function (cart) {\r\n                    $scope.checkout.wizard.goToStep(cart.hasPhysicalProducts ? 'shipping-address' : 'payment-method');\r\n                });\r\n            };\r\n\r\n            getAvailCountries().then(function (countries) {\r\n                $scope.checkout.availCountries = countries;\r\n            });\r\n\r\n        }]);\r\n","angular.module('storefrontApp')\r\n\t.component('addToListButton', {\r\n\t\ttemplateUrl: 'themes/assets/js/lists/add-to-list-button.tpl.html',\r\n\t\tbindings: {\r\n\t\t\tselectedVariation: '<'\r\n\t\t},\r\n        controller: ['accountApi', 'dialogService', 'listsApi', 'customerService', function (accountApi, dialogService, listsApi, customerService) {\r\n\t\t\tvar $ctrl = this;\r\n\t\t\t$ctrl.$onInit = function () {\r\n\t\t\t\tcompareProductInLists();\r\n\t\t\t}\r\n\r\n\t\t\tfunction compareProductInLists() {\r\n\t\t\t\t$ctrl.buttonInvalid = true;\r\n                listsApi.searchLists({\r\n\t\t\t\t\tpageSize: 10000,\r\n\t\t\t\t\ttype: $ctrl.type\r\n\t\t\t\t}).then(function (response) {\r\n\t\t\t\t\t$ctrl.lists = response.data.results;\r\n\r\n\t\t\t\t\tif ($ctrl.lists) {\r\n\t\t\t\t\t\tvar nameLists = _.pluck($ctrl.lists, 'name');\r\n\t\t\t\t\t\tlistsApi.getListsWithProduct($ctrl.selectedVariation.id, nameLists, $ctrl.type).then(function(containsResponse) {\r\n\t\t\t\t\t\t\tvar containsLists = containsResponse.data;\r\n\t\t\t\t\t\t\tif (containsLists) {\r\n\t\t\t\t\t\t\t\t_.each($ctrl.lists, function(list) {\r\n\t\t\t\t\t\t\t\t\tlist.contains = _.contains(containsLists, list.name);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tcustomerService.getCurrentCustomer().then(function(response) {\r\n\t\t\t\t\t$ctrl.customer = response.data;\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction toListsDialogDataModel(product, quantity) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tproduct: product,\r\n\t\t\t\t\tquantity: quantity,\r\n\t\t\t\t\tupdated: false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$ctrl.addProductToWishlist = function () {\r\n\t\t\t\tvar dialogData = toListsDialogDataModel($ctrl.selectedVariation, 1);\r\n\t\t\t\tdialogService.showDialog(dialogData, 'recentlyAddedListItemDialogController', 'storefront.lists-added-list-item-dialog.tpl');\r\n            }\r\n\r\n            $ctrl.signInToProceed = function() {\r\n                dialogService.showDialog({ title: 'Add product to list...' }, 'universalDialogController', 'storefront.sign-in-to-proceed.tpl');\r\n            }\r\n\r\n\t\t}]\r\n\t})\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('recentlyAddedListItemDialogController', ['$scope', '$window', '$uibModalInstance', 'dialogData', 'listsApi', '$translate', 'defaultLists', '$q', 'loadingIndicatorService', function ($scope, $window, $uibModalInstance, dialogData, listsApi, $translate, defaultLists, $q, loader ) {\r\n    $scope.availableLists = [];\r\n    $scope.selectedList = {};\r\n    $scope.dialogData = dialogData;\r\n    $scope.inProgress = false;\r\n    $scope.itemAdded = false;\r\n    $scope.type = dialogData.listType;\r\n\r\n    $scope.addProductToList = function () {\r\n        $scope.inProgress = true;\r\n        listsApi.addLineItem(dialogData.product.id, $scope.selectedList.name, $scope.selectedList.type).then(function (response) {\r\n            if (response.data) {\r\n                $scope.inProgress = false;\r\n                $scope.itemAdded = true;\r\n            }\r\n        });\r\n    };\r\n    $scope.selectList = function (list) {\r\n        $scope.selectedList = list;\r\n    };\r\n\r\n    $scope.close = function () {\r\n        $uibModalInstance.close();\r\n    };\r\n\r\n    $scope.redirect = function (url) {\r\n        $window.location = url;\r\n    };\r\n\r\n    $scope._searchLists = function () {\r\n        loader.wrapLoading(function () {\r\n            return listsApi.searchLists({\r\n                pageSize: 1000,\r\n                type: $scope.type\r\n            }).then(function (response) {\r\n                $scope.lists = response.data.results;\r\n                if ($scope.lists) {\r\n                    var nameLists = _.pluck($scope.lists, 'name');\r\n                    listsApi.getListsWithProduct(dialogData.product.id, nameLists, $scope.type).then(function(containsResponse) {\r\n                        var containsLists = containsResponse.data;\r\n                        if ($scope.lists && containsLists) {\r\n                            _.each($scope.lists, function(list) {\r\n                                list.contains = _.contains(containsLists, list.name);\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    $scope.initialize = function () {\r\n        $scope.predefinedLists = defaultLists.default_lists;\r\n        $scope.type = defaultLists.default_list_type;\r\n\r\n        var promises = [];\r\n        _.each($scope.predefinedLists, function (list) {\r\n            promises.push(createList(list.name, list.type));\r\n        });\r\n\r\n        $q.all(promises).then(function () {\r\n            $scope._searchLists();\r\n        });\r\n    };\r\n\r\n    function createList(listName, type) {\r\n        return listsApi.createList(listName, type);\r\n    }\r\n\r\n    $scope.initialize();\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('recentlyCreateNewListDialogController', ['$rootScope', '$scope', '$window', '$uibModalInstance', 'customerService', 'dialogData', 'listsApi', '$localStorage', 'loadingIndicatorService', '$translate', 'confirmService', function ($rootScope, $scope, $window, $uibModalInstance, customerService, dialogData, listsApi, $localStorage, loader, $translate, confirmService) {\r\n\r\n    $scope.dialogData = dialogData.lists;\r\n    $scope.predefinedLists = dialogData.lists;\r\n    $scope.userName = dialogData.userName;\r\n    $scope.inProgress = false;\r\n    $scope.data = $scope.listName;\r\n    $scope.selectedTab = dialogData.selectedTab;\r\n    $scope.type = dialogData.type;\r\n\r\n    $scope.createList = function () {\r\n        listsApi.createList($scope.dialogData.listName, $scope.type).then(function(result) {\r\n            $uibModalInstance.close(result.data);\r\n        });\r\n    };\r\n\r\n    $scope.selectedList = function (listName, type) {\r\n        var items = listsApi.getWishlist(listName, type).items;\r\n        $scope.selectedList.items = items;\r\n    };\r\n\r\n    $scope.submitSettings = function () {\r\n        var showDialog = function (text) {\r\n            confirmService.confirm(text).then(function (confirmed) {\r\n                if (confirmed) {\r\n                    var listIds = [];\r\n                    _.each(dialogData.lists, function (list) {\r\n                        if (list.delete)\r\n                            listIds.push(list.id);\r\n                    });\r\n\r\n                    listsApi.deleteListsByIds(listIds).then(function (result) {\r\n                        $uibModalInstance.close();\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        showDialog(\"Are you sure you wish to delete this list?\");\r\n    };\r\n\r\n    $scope.close = function () {\r\n        $uibModalInstance.dismiss('cancel');\r\n    };\r\n\r\n    function inititlize() {\r\n        _.each($scope.dialogData, function(list) {\r\n            var foundList = _.find(dialogData.predefinedLists, function (predefinedList) { return predefinedList.name === list.name });\r\n            if (foundList) {\r\n                list.disabled = true;\r\n            }\r\n        });\r\n    }\r\n\r\n    inititlize();\r\n\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.service('listsApi', ['$http', function ($http) {\r\n    return {\r\n        getWishlist: function (listName, type) {\r\n            return $http.get('storefrontapi/lists/' + listName + '/' + type + '?t=' + new Date().getTime());\r\n        },\r\n        getListsWithProduct: function (productId, listNames, type) {\r\n            return $http.post('storefrontapi/lists/getlistswithproduct', { productId: productId, listNames: listNames, type: type });\r\n        },\r\n        addLineItem: function (productId, listName, type) {\r\n            return $http.post('storefrontapi/lists/items', { productId: productId, listName: listName, type: type });\r\n        },\r\n        removeLineItem: function (lineItemId, listName, type) {\r\n            return $http.delete('storefrontapi/lists/' + listName + '/' + type + '/items/' + lineItemId);\r\n        },\r\n        searchLists: function (searchCriteria) {\r\n            return $http.post('storefrontapi/lists/search', searchCriteria);\r\n        },\r\n        createList: function(listName, type) {\r\n            return $http.post('storefrontapi/lists/' + listName + '/' + type + '/create');\r\n        },\r\n        deleteListsByIds: function(listIds) {\r\n            return $http.delete('storefrontapi/lists/deletelistsbyids?listIds=' + listIds.join('&listIds='));\r\n        },\r\n        mergeWithCurrentCart: function(listName, type) {\r\n            return $http.post('storefrontapi/lists/' + listName + '/' + type + '/mergewithcurrentcart');\r\n        }\r\n    }\r\n}]);","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('priceController', ['$scope', '$window', 'pricingService', 'loadingIndicatorService', function ($scope, $window, pricingService, loader) {\r\n    $scope.loader = loader;\r\n    loader.wrapLoading(function() {\r\n        return pricingService.getActualProductPrices($window.products).then(function(response) {\r\n            var prices = response.data;\r\n            $scope.prices = _.object(_.map(prices, function(price) {\r\n                return [price.productId, price];\r\n            }));\r\n            $scope.prices.length = response.data.length;\r\n        });\r\n    });\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('purchaseController', ['$scope', '$localStorage', 'storefrontApp.mainContext', function ($scope, $localStorage, mainContext) {\r\n\r\n    $scope.loadPaymentPlan = function(availablePaymentPlans, objectType, objectId) {\r\n        $scope.availablePaymentPlans = availablePaymentPlans;\r\n        $scope.paymentPlan = (($localStorage['paymentPlans'] || { })[objectType] || { })[objectId];\r\n        $scope.paymentPlanType = $scope.paymentPlan ? 'auto-reorder' : 'one-time';\r\n        $scope.paymentPlan = ($scope.paymentPlan ? _.findWhere(availablePaymentPlans, { intervalCount: $scope.paymentPlan.intervalCount, interval: $scope.paymentPlan.interval }) : undefined) ||\r\n            _.findWhere($scope.availablePaymentPlans, { intervalCount: 1, interval: 'months' });\r\n    };\r\n\r\n    $scope.updatePaymentPlan = function(objectType, objectId, paymentPlanType, paymentPlan) {\r\n        if (!$localStorage['paymentPlans']) {\r\n            $localStorage['paymentPlans'] = { };\r\n        }\r\n        if (!$localStorage['paymentPlans'][objectType]) {\r\n            $localStorage['paymentPlans'][objectType] = { };\r\n        }\r\n        $scope.paymentPlanType = paymentPlanType;\r\n        if (paymentPlanType === 'auto-reorder') {\r\n            $localStorage['paymentPlans'][objectType][objectId] = paymentPlan;\r\n            $scope.paymentPlan = paymentPlan;\r\n        } else {\r\n            $localStorage['paymentPlans'][objectType][objectId] = undefined;\r\n            $scope.paymentPlan = undefined;\r\n        }\r\n    };\r\n\r\n    $scope.shipmentType = $localStorage['shipmentType'] || 'shipping';\r\n    $scope.shipmentAddress = $localStorage['shipmentAddress'];\r\n    $scope.shipmentFulfillmentCenter = $localStorage['shipmentFulfillmentCenter'];\r\n    if ($scope.shipmentFulfillmentCenter) {\r\n        $scope.shipmentFulfillmentCenterAddress = $scope.shipmentFulfillmentCenter.address;\r\n    }\r\n\r\n    $scope.$watch(\r\n        function () { \r\n            var mc = mainContext;\r\n            return mainContext.customer; \r\n        },\r\n        function (customer) {\r\n            if (customer) {\r\n                if (!$scope.shipmentAddress && customer.defaultShippingAddress) {\r\n                    $scope.shipmentAddress = { postalCode: customer.defaultShippingAddress.postalCode };\r\n                }\r\n            }\r\n        }\r\n    );\r\n\r\n    $scope.updateShipmentType = function(shipmentType, shipmentTypeInfo) {\r\n        $localStorage['shipmentType'] = shipmentType;\r\n        $scope.shipmentType = shipmentType;\r\n        if (shipmentType === 'shipping') {\r\n            $localStorage['shipmentAddress'] = shipmentTypeInfo;\r\n            $scope.shipmentAddress = shipmentTypeInfo;\r\n        } else {\r\n            $localStorage['shipmentFulfillmentCenter'] = shipmentTypeInfo;\r\n            $scope.shipmentFulfillmentCenter = shipmentTypeInfo;\r\n            $scope.shipmentFulfillmentCenterAddress = fulfillmentCenterService.address;\r\n        }\r\n    };\r\n}]);\r\n","//https://stackoverflow.com/questions/45102658/confirm-password-validation-angularjs-material-design\r\nvar storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.directive('compareTo', function () {\r\n    return {\r\n        require: \"ngModel\",\r\n        scope: {\r\n            compareTolValue: \"=compareTo\"\r\n        },\r\n        link: function (scope, element, attributes, ngModel) {\r\n\r\n            ngModel.$validators.compareTo = function (modelValue) {\r\n\r\n                return modelValue == scope.compareTolValue;\r\n            };\r\n\r\n            scope.$watch(\"compareTolValue\", function () {\r\n                ngModel.$validate();\r\n            });\r\n        }\r\n    };\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.directive('vcContentPlace', ['$compile', 'marketingService', function ($compile, marketingService) {\r\n    return {\r\n        restrict: 'E',\r\n        link: function (scope, element, attrs) {\r\n            marketingService.getDynamicContent(attrs.id).then(function (response) {\r\n                element.html($compile(response.data)(scope));\r\n            });\r\n        },\r\n        replace: true\r\n    }\r\n}]);\r\n\r\nstorefrontApp.directive('vcEnterSource', ['$timeout', function ($timeout) {\r\n    return {\r\n        restrict: \"A\",\r\n        controller: function() { },\r\n        link: function (scope, element, attrs, ctrl) {\r\n            var onKeyPress = function (event) {\r\n                if (event.keyCode === 13) { // Enter\r\n                    ctrl.element[0].click();\r\n                }\r\n            };\r\n            element.on('keypress', onKeyPress);\r\n            scope.$on('$destroy', function () {\r\n                element.off('keypress', onKeyPress);\r\n            });\r\n        }\r\n    };\r\n}]);\r\n\r\nstorefrontApp.directive('vcEnterTarget', [function () {\r\n    return {\r\n        restrict: \"A\",\r\n        require: \"^vcEnterSource\",\r\n        link: function (scope, element, attrs, ctrl) {\r\n            ctrl.element = element;\r\n        }\r\n    };\r\n}]);\r\n\r\nstorefrontApp.directive('fallbackSrc', function () {\r\n    return {\r\n        link: function (scope, element, attrs) {\r\n            element.on('error', errorHandler);\r\n\r\n            scope.$on('$destroy', function() {\r\n                element.off('error', errorHandler);\r\n            });\r\n\r\n            function errorHandler(event) {\r\n                if (element.attr('src') !== attrs.fallbackSrc) {\r\n                    element.attr('src', attrs.fallbackSrc);\r\n                }\r\n                else {\r\n                    element.off(event);\r\n                }\r\n            };\r\n        }\r\n    }\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.config(['$provide', function ($provide) {\r\n    $provide.decorator('uibDropdownService', ['$delegate', function($delegate) {\r\n        var service = $delegate;\r\n        var close = service.close;\r\n        service.close = function (dropdownScope, element, appendTo) {\r\n            dropdownScope.focusToggleElement = function() {};\r\n            close(dropdownScope, element, appendTo);\r\n        }\r\n        return $delegate;\r\n    }]);\r\n\r\n    $provide.decorator('uibDropdownDirective', ['$delegate', function ($delegate) {\r\n        var directive = $delegate[0];\r\n        var compile = directive.compile;\r\n        directive.compile = function () {\r\n            var link = compile.apply(this, arguments);\r\n            return function (scope, element, attrs, dropdownCtrl) {\r\n                if (attrs.autoClose === 'mouseleave') {\r\n                    dropdownCtrl.toggle(false);\r\n                }\r\n\r\n                var closeDropdown = function () {\r\n                    scope.$apply(function () {\r\n                        if (attrs.autoClose === 'mouseleave') {\r\n                            dropdownCtrl.toggle(false);\r\n                        }\r\n                    });\r\n                };\r\n\r\n                element.on('mouseleave', closeDropdown);\r\n\r\n                link.apply(this, arguments);\r\n\r\n                scope.$on('$destroy', function () {\r\n                    element.off('mouseleave', closeDropdown);\r\n                });\r\n            };\r\n        };\r\n        return $delegate;\r\n    }]);\r\n\r\n    $provide.decorator('uibDropdownToggleDirective', ['$delegate', function ($delegate) {\r\n        var directive = $delegate[0];\r\n        directive.controller = function () { };\r\n        $delegate[0] = directive;\r\n        return $delegate;\r\n    }]);\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.directive('vcDropdownClose', function () {\r\n    return {\r\n        require: ['?^uibDropdown'],\r\n        link: function (scope, element, attrs, ctrls) {\r\n            var dropdownCtrl = ctrls[0];\r\n            if (!dropdownCtrl) {\r\n                return;\r\n            }\r\n\r\n            var closeDropdown = function () {\r\n                if (!element.hasClass('disabled') && !attrs.disabled) {\r\n                    scope.$apply(function () {\r\n                        dropdownCtrl.toggle(false);\r\n                    });\r\n                }\r\n            };\r\n\r\n            element.on('click', closeDropdown);\r\n\r\n            scope.$on('$destroy', function () {\r\n                element.off('click', closeDropdown);\r\n            });\r\n        }\r\n    };\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.directive('vcDropdownTrigger', function () {\r\n    return {\r\n        require: ['?^uibDropdown', '?uibDropdownToggle'],\r\n        link: function (scope, element, attrs, ctrls) {\r\n            if (attrs.vcDropdownTrigger === 'mouseenter') {\r\n                var dropdownCtrl = ctrls[0];\r\n                var dropdownToggleCtrl = ctrls[1];\r\n                if (!(dropdownCtrl && dropdownToggleCtrl)) {\r\n                    return;\r\n                }\r\n\r\n                element.addClass('dropdown-trigger-mouseenter');\r\n\r\n                var openDropdown = function() {\r\n                    if (!element.hasClass('disabled') && !attrs.disabled) {\r\n                        scope.$apply(function() {\r\n                            dropdownCtrl.toggle(true);\r\n                        });\r\n                    }\r\n                };\r\n\r\n                element.on('mouseenter', openDropdown);\r\n\r\n                scope.$on('$destroy', function() {\r\n                    element.off('mouseenter', openDropdown);\r\n                });\r\n            }\r\n        }\r\n    };\r\n});\r\n","angular.module('storefrontApp')\r\n.directive('vcFlyingPlaceholder', function() {\r\n    return {\r\n        controller: ['$scope', function vcFlyingPlaceholderController($scope) {\r\n            //console.log($scope);\r\n            \r\n        }],\r\n        scope: {\r\n            elementName: \"@name\",\r\n            elementModel: \"@ngModel\" \r\n        },\r\n        require: 'ngModel',\r\n        templateUrl: '',\r\n        link: function(scope, element, attr, ngModel) {\r\n            //console.log(scope);\r\n            //console.log(element);\r\n            var labelContent = '<label class=\"vc-flying-placeholder-class\" for=\"' + scope.elementName + '\">' + attr.vcFlyingPlaceholder + '</label>';\r\n            element.after(labelContent);\r\n            var parentElement = element.parent();\r\n            parentElement.addClass(\"vc-flying-placeholder-group-class\");\r\n            \r\n            scope.$watch(function() {\r\n                if (ngModel.$modelValue) {\r\n                    parentElement.addClass(\"keyuped\");\r\n                }\r\n                else {\r\n                    parentElement.removeClass(\"keyuped\");\r\n                }\r\n            });\r\n        }\r\n    };\r\n  });","var storefrontApp = angular.module('storefrontApp');\r\n\r\n// based on https://github.com/angular/angular.js/blob/master/src/ng/directive/ngInclude.js\r\nstorefrontApp.config(['$provide', function ($provide) {\r\n    $provide.decorator('ngIncludeDirective', ['$delegate', function ($delegate) {\r\n        var includeFillContentDirective = $delegate[1];\r\n        var link = includeFillContentDirective.link;\r\n        includeFillContentDirective.link = function (scope, $element, $attr, ctrl) {\r\n            if (!Object.keys($attr).includes('raw')) {\r\n                link(scope, $element, $attr, ctrl);\r\n            } else {\r\n                $element.text(ctrl.template);\r\n            }\r\n        };\r\n        includeFillContentDirective.compile = function () {\r\n            return includeFillContentDirective.link;\r\n        };\r\n        $delegate[1] = includeFillContentDirective;\r\n        return $delegate;\r\n    }]);\r\n}]);\r\n","angular.module('storefrontApp')\r\n    .directive('vaPermission', ['storefrontApp.mainContext', function (mainContext) {\r\n    return {\r\n        link: function (scope, element, attrs) {\r\n            if (attrs.vaPermission) {\r\n                var permissionValue = attrs.vaPermission.trim();\r\n\r\n                function checkPermission(user, permission) {\r\n                    var result = angular.isDefined(user);\r\n                    if (result) {\r\n                        //first check admin permission\r\n                        result = user.isAdministrator;\r\n                        if (!result && permission) {\r\n                            permission = permission.trim();\r\n                            //check global permissions\r\n                            result = $.inArray(permission, user.permissions) > -1;\r\n                        }\r\n                    }\r\n                    return result;\r\n                };\r\n\r\n                function toggleVisibilityBasedOnPermission(user) {\r\n                    var hasPermission = checkPermission(user, permissionValue);\r\n                    if (hasPermission)\r\n                        angular.element(element).show();\r\n                    else\r\n                        angular.element(element).hide();\r\n                }\r\n\r\n                toggleVisibilityBasedOnPermission(mainContext.customer);\r\n\r\n                \r\n                scope.$watch(function () { return mainContext.customer; }, function (value) {\r\n                    if (value) {\r\n                        toggleVisibilityBasedOnPermission(value);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    };\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.directive('vcQuerySource', ['$parse', '$location', '$httpParamSerializer', 'searchQueryService', function ($parse, $location, $httpParamSerializer, searchQueryService) {\r\n    return {\r\n        restrict: \"A\",\r\n        compile: function (tElem, tAttr) {\r\n            if (!tAttr.href) {\r\n                return function (scope, element, attrs) {\r\n                    // If the linked element is not an anchor tag anymore, do nothing\r\n                    if (element[0].nodeName.toLowerCase() !== 'a') return;\r\n\r\n                    // get query from current url, replace query parts with specified parts and set href\r\n                    var setUrl = function (querySource, switchable) {\r\n                        switchable = switchable == 'true';\r\n                        var state = searchQueryService.deserialize(searchQueryService.get(), {});\r\n                        var result = searchQueryService.merge(state, querySource, switchable);\r\n                        var params = searchQueryService.serialize(result, {});\r\n                        var url = new URL($location.absUrl());\r\n                        url.search = $httpParamSerializer(params);\r\n                        element.attr(\"href\", url.href);\r\n                    };\r\n                    scope.$watch(function () {\r\n                        return $parse(attrs.vcQuerySource)(scope);\r\n                    }, function (value) {\r\n                        setUrl(value, attrs.switchable);\r\n                    }, true);\r\n                    scope.$watch(function () {\r\n                        return attrs.switchable;\r\n                    }, function (value) {\r\n                        setUrl($parse(attrs.vcQuerySource)(scope), value);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.directive('vcQueryTarget', ['$parse', '$location', 'searchQueryService', function ($parse, $location, searchQueryService) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function (scope, element, attrs) {\r\n            var vcQueryTarget = $parse(attrs.vcQueryTarget);\r\n            // get requested keys and set ng-model value to value of ?key1=value1&key2=value2\r\n            var state = searchQueryService.deserialize(searchQueryService.get(), vcQueryTarget(scope));\r\n            vcQueryTarget.assign(scope, state);\r\n        }\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.directive('vcScope', ['$animate', '$compile', function ($animate) {\r\n    return {\r\n        multiElement: true,\r\n        transclude: 'element',\r\n        priority: 600,\r\n        terminal: true,\r\n        restrict: 'A',\r\n        $$tlb: true,\r\n        link: function ($scope, $element, $attr, ctrl, $transclude) {\r\n            $transclude(function (clone) {\r\n                $element.after(clone);\r\n            });\r\n        }\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.component('filterByFulfillmentCenterWidget', {\r\n    templateUrl: \"themes/assets/js/inventory/filter-by-fulfillment-center-widget.tpl.html\",\r\n    bindings: {\r\n    }, \r\n    controller: ['$scope', 'inventoryApi', 'dialogService', 'baseUrl', '$localStorage', function ($scope, inventoryApi, dialogService, baseUrl, $localStorage) {\r\n        var ctrl = this;\r\n\r\n        ctrl.baseUrl = baseUrl;\r\n        this.$onInit = function () {\r\n            ctrl.fulfillmentCenter = $localStorage['fulfillmentCenter'];\r\n        };\r\n\r\n        ctrl.selectFulfillmentCenter = function () {\r\n            var dialogInstance = dialogService.showDialog({ isFilter: true }, 'universalDialogController', 'storefront.select-fulfillment-center-dialog.tpl');\r\n            dialogInstance.result.then(function (result) {\r\n                ctrl.fulfillmentCenter = result;\r\n                $localStorage['fulfillmentCenter'] = result;\r\n             });\r\n        };\r\n    }]\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('inventoryController', ['$scope', 'inventoryApi', function ($scope, inventoryApi) {\r\n    $inventory = this;\r\n    $scope.fulfillmentCenters = [];\r\n   \r\n    $scope.searchFulfillmentCenters = function (searchPhrase) {\r\n        inventoryApi.searchFulfillmentCenters({ searchPhrase: searchPhrase }).then(function(response) {\r\n             $scope.fulfillmentCenters = response.data.results;\r\n         });       \r\n    };\r\n   \r\n}]);\r\n\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.service('inventoryApi', ['$http', function ($http) {\r\n    return {       \r\n        searchFulfillmentCenters: function (criteria) {\r\n            return $http.post('storefrontapi/fulfillmentcenters/search', criteria);\r\n        },\r\n      \r\n    }\r\n}]);\r\n","angular.module('storefrontApp')\r\n    .component('addToCompareCheckbox', {\r\n        templateUrl: 'themes/assets/js/product-compare/add-to-compare-checkbox.tpl.html',\r\n        bindings: {\r\n            productId: '<',\r\n            buttonType: '<',\r\n            customClass: '<',\r\n            buttonWidth: '<'\r\n        },\r\n        controller: ['$rootScope', '$scope', 'catalogService', 'dialogService', 'compareProductService', function($rootScope, $scope, catalogService, dialogService, compareProductService) {\r\n            var $ctrl = this;\r\n            $ctrl.containProduct = false;\r\n\r\n            $ctrl.$onInit = function () {\r\n                $ctrl.containProduct = compareProductService.isInProductCompareList($ctrl.productId);\r\n            }\r\n\r\n            $ctrl.addProductToCompareList = function (event) {\r\n                event.preventDefault();\r\n                catalogService.getProduct($ctrl.productId).then(function(response) {\r\n                    var product = response.data[0];\r\n                    event.preventDefault();\r\n                    var isInProductList = compareProductService.isInProductCompareList($ctrl.productId);\r\n                    if (!isInProductList) {\r\n                        var count = compareProductService.getProductsCount();\r\n                        if (count < 5) {\r\n                        $ctrl.containProduct = true;\r\n                        compareProductService.addProduct($ctrl.productId);\r\n                        $rootScope.$broadcast('productCompareListChanged');\r\n                        }\r\n                    }\r\n                    else {\r\n                        $ctrl.containProduct = false;\r\n                        compareProductService.removeProduct($ctrl.productId);\r\n                        $rootScope.$broadcast('productCompareListChanged');\r\n                    }\r\n                })\r\n            };\r\n        }]\r\n    })\r\n\r\n","angular.module('storefrontApp')\r\n    .component('productCompareListBar', {\r\n        templateUrl: \"themes/assets/js/product-compare/product-compare-list-bar.tpl.html\",\r\n        controller: ['compareProductService', 'catalogService', '$scope', '$rootScope', '$location',\r\n            function(compareProductService, catalogService, $scope, $rootScope, $location) {\r\n                var $ctrl = this;\r\n                $ctrl.showedBody = true;\r\n                $ctrl.products = [];\r\n                $ctrl.showBodyText = \"Hide\";\r\n                $ctrl.showBodyIcon = \"fa fa-angle-down\";\r\n                function canShowBar() {\r\n                    var path = $location.absUrl();\r\n                    if (path.indexOf(\"/compare\") !== -1) {\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                }\r\n\r\n                $ctrl.showBar = canShowBar();\r\n\r\n                function initialize() {\r\n                    if (!$ctrl.showBar) return;\r\n                    var productsIds = compareProductService.getProductsIds();\r\n                    if (!_.isEmpty(productsIds)) {\r\n                        catalogService.getProducts(productsIds).then(function(response) {\r\n                            $ctrl.products = response.data;\r\n                        });\r\n                    };\r\n                }\r\n\r\n                $ctrl.$onInit = function() {\r\n                    $ctrl.itemsCount = compareProductService.getProductsCount();\r\n                    initialize();\r\n                }\r\n\r\n                $scope.$on('productCompareListChanged', function(event, data) {\r\n                    $ctrl.itemsCount = compareProductService.getProductsCount();\r\n                    initialize();\r\n                });\r\n\r\n                $ctrl.clearCompareList = function () {\r\n                    compareProductService.clearCompareList();\r\n                    $ctrl.products = [];\r\n                    $rootScope.$broadcast('productCompareListChanged');\r\n                }\r\n\r\n                $ctrl.showBody = function () {\r\n                    $ctrl.showedBody = !$ctrl.showedBody;\r\n                    if ($ctrl.showedBody) {\r\n                        $ctrl.showBodyText = \"Hide\";\r\n                        $ctrl.showBodyIcon = \"fa fa-angle-down\";\r\n                    }\r\n                    else {\r\n                        $ctrl.showBodyText = \"Show\";\r\n                        $ctrl.showBodyIcon = \"fa fa-angle-up\";\r\n                    }\r\n                }\r\n            \r\n                $ctrl.removeProduct = function (product) {\r\n                    compareProductService.removeProduct(product.id)\r\n                    $ctrl.products = _.without($ctrl.products, product);\r\n                    $rootScope.$broadcast('productCompareListChanged');\r\n                }\r\n            }]\r\n    });\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('productCompareListController', ['$rootScope', '$scope', '$localStorage', '$window', 'catalogService', 'dialogService', 'compareProductService',\r\nfunction ($rootScope, $scope, $localStorage, $window, catalogService, dialogService, compareProductService) {\r\n    var $ctrl = this;\r\n    $ctrl.containProduct = false;\r\n    $scope.properties = [];\r\n    $scope.products = [];\r\n\r\n    function initialize() {\r\n        $scope.loaded = false;\r\n        $ctrl.loading = true;\r\n        var productsIds = compareProductService.getProductsIds();\r\n        if (_.isEmpty(productsIds)) {\r\n            $scope.loaded = true;\r\n            $ctrl.loading = false;\r\n            return;\r\n        }\r\n        catalogService.getProducts(productsIds).then(function(response) {\r\n            if (_.indexOf(productsIds, '&') != -1) {\r\n                $scope.products = response.data;\r\n                _.each($scope.products, function(product) {\r\n                    modifyProperty(product);\r\n                })\r\n            }\r\n            else {\r\n                var product = response.data[0];\r\n                modifyProperty(product);\r\n                $scope.products.push(product);\r\n            }\r\n            $scope.getProductProperties();\r\n            $scope.loaded = true;\r\n            $ctrl.loading = false;\r\n        })\r\n    };\r\n\r\n    $scope.addProductToCompareList = function (productId, event) {\r\n        event.preventDefault();\r\n        var isInProductList = compareProductService.isInProductCompareList(productId);\r\n        if (!isInProductList) {\r\n            $ctrl.containProduct = true;\r\n            compareProductService.addProduct(productId);\r\n            $rootScope.$broadcast('productCompareListChanged');\r\n        }\r\n    }\r\n\r\n    $scope.getProductProperties = function () {\r\n        if (_.isEmpty($scope.products))\r\n            return [];\r\n        var grouped = {};\r\n        var properties = _.flatten(_.map($scope.products, function(product) { return product.properties; }));\r\n        var propertyDisplayNames = _.uniq(_.map(properties, function(property) { return property.displayName; }));\r\n        _.each(propertyDisplayNames, function(displayName) {\r\n            grouped[displayName] = [];\r\n            var props = _.where(properties, { displayName: displayName });\r\n            _.each($scope.products, function(product) {\r\n                var productProperty = _.find(props, function(prop) { return prop.productId === product.id });\r\n                if (productProperty) {\r\n                    grouped[displayName].push(productProperty);\r\n                } else {\r\n                    grouped[displayName].push({ valueType: 'ShortText', value: '-' });\r\n                }\r\n            });\r\n        });\r\n        $scope.properties = grouped;\r\n    }\r\n\r\n    function modifyProperty(product) {\r\n        _.each(product.properties, function(property) {\r\n            property.productId = product.id;\r\n            if (property.valueType.toLowerCase() === 'number') {\r\n                property.value = formatNumber(property.value);\r\n            }\r\n        })\r\n        return product;\r\n    }\r\n\r\n    $scope.hasValues = function (properties, onlyDifferences) {\r\n        var uniqueValues = _.uniq(_.map(properties, function (p) { return p.value }));\r\n        if (onlyDifferences && properties.length > 1 && uniqueValues.length == 1) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    $scope.clearCompareList = function () {\r\n        compareProductService.clearCompareList();\r\n        $scope.products = [];\r\n        $rootScope.$broadcast('productCompareListChanged');\r\n        $scope.properties = [];\r\n    }\r\n\r\n    $scope.removeProduct = function (product) {\r\n        compareProductService.removeProduct(product.id)\r\n        $scope.products = _.without($scope.products, product);\r\n        $rootScope.$broadcast('productCompareListChanged');\r\n        $scope.getProductProperties();\r\n    }\r\n\r\n    function formatNumber(number) {\r\n        var float = parseFloat(number);\r\n        return !isNaN(float) ? float : number;\r\n    }\r\n    initialize();\r\n}]);\r\n\r\nstorefrontApp.controller('productCompareListDialogController', ['$scope', '$window', 'dialogData', '$uibModalInstance',\r\nfunction ($scope, $window, dialogData, $uibModalInstance) {\r\n    $scope.dialogData = dialogData;\r\n\r\n    $scope.close = function () {\r\n        $uibModalInstance.close();\r\n    }\r\n\r\n    $scope.redirect = function (url) {\r\n        $window.location = url;\r\n    }    \r\n}]);","storefrontApp.service('availabilityService', ['$http', '$q', 'apiBaseUrl', function ($http, $q, apiBaseUrl) {\r\n    return {\r\n        getProductsAvailability: function (ids) {\r\n            // return $http.post(apiBaseUrl + 'api/availabilty/product', ids);\r\n            // mock\r\n            var deferredData = $q.defer();\r\n            deferredData.resolve({\r\n                data: ids.map(function(id) {\r\n                    return { productId: id, expectedArrival: Date.now(), availableSince: Date.now() };\r\n                })\r\n            });\r\n            return deferredData.promise;\r\n        }\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.service('loadingIndicatorService', function() {\r\n    var retVal = {\r\n        isLoading: false,\r\n        wrapLoading: function(func) {\r\n            retVal.isLoading = true;\r\n            return func().then(\r\n                function(result) {\r\n                    retVal.isLoading = false;\r\n                    return result;\r\n                },\r\n                function() { retVal.isLoading = false; });\r\n        }\r\n    }\r\n    return retVal;\r\n});\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.service('searchQueryService', ['$location', function ($location) {\r\n    return {\r\n        // emulate html5 mode because of bug in Microsoft Edge\r\n        get: function () {\r\n            var result = {};\r\n            var url = new URL($location.absUrl());\r\n            var entries = url.searchParams.entries();\r\n            var pair = entries.next();\r\n            while (!pair.done) {\r\n                result[pair.value[0]] = pair.value[1];\r\n                pair = entries.next();\r\n            }\r\n            return result;\r\n        },\r\n\r\n        // Deserializes search query strings like 'key=value1[,value2]' or 'key=key1:value1[,value2[;key2:value3[,value4]]]'\r\n        deserialize: function (searchQuery, defaults) {\r\n            var deserializeValues = function (string) {\r\n                return string.split(',');\r\n            };\r\n            var deserializePairs = function (string) {\r\n                return _.object(string.split(';').map(function (pairString) {\r\n                    return _.reduce(pairString.split(':'), function (key, value) {\r\n                        return [key, deserializeValues(value)];\r\n                    });\r\n                }));\r\n            };\r\n            searchQuery = searchQuery || {};\r\n            defaults = defaults || {};\r\n            var result = {};\r\n            _.each(Object.keys(searchQuery), (function (key) {\r\n                var string = searchQuery[key];\r\n                if (string) {\r\n                    var deserialize = string.includes(':') ? deserializePairs : deserializeValues;\r\n                    result[key] = deserialize(string);\r\n                }\r\n            }));\r\n            result = _.defaults(result, defaults);\r\n            return result;\r\n        },\r\n\r\n        merge: function (searchQuery, changes, switchable) {\r\n            if (!switchable) {\r\n                return _.extend(searchQuery, changes);\r\n            } else {\r\n                var mergeValues = function (searchQueryValues, changeValues) {\r\n                    var checkedValues = _.difference((searchQueryValues || []).concat(changeValues || []), _.intersection(searchQueryValues, changeValues));\r\n                    return changeValues !== null && checkedValues.length ? checkedValues : null;\r\n                };\r\n                var mergePairs = function (searchQueryPairs, changePairs) {\r\n                    return _.object(_.compact(_.union(Object.keys(searchQueryPairs), Object.keys(changePairs)).map(function (key) {\r\n                        var mergedValues = mergeValues(searchQueryPairs[key], changePairs[key]);\r\n                        return mergedValues !== null ? [key, mergedValues] : null;\r\n                    })));\r\n                };\r\n                return _.object(_.compact(_.union(Object.keys(searchQuery), Object.keys(changes)).map(function (key) {\r\n                    var searchQueryValues = searchQuery[key];\r\n                    var changeValues = changes[key];\r\n                    if (changeValues !== null) {\r\n                        if (searchQueryValues && changeValues && angular.isArray(searchQueryValues) !== angular.isArray(changeValues)) {\r\n                            throw 'Type of ' + key + ' in search query is' + typeof (searchQueryValues[key]) + ' while in changes is' + typeof (changeValues[key]);\r\n                        }\r\n                        if (angular.isArray(changeValues) || angular.isArray(searchQueryValues)) {\r\n                            var mergedValues = mergeValues(searchQueryValues, changeValues);\r\n                            return mergedValues !== null ? [key, mergedValues] : null;\r\n                        } else {\r\n                            var mergedPairs = mergePairs(searchQueryValues || [], changeValues || []);\r\n                            return !_.isEmpty(mergedPairs) ? [key, mergedPairs] : null;\r\n                        }\r\n                    } else {\r\n                        return null;\r\n                    }\r\n                })));\r\n            }\r\n        },\r\n\r\n        // Serializes search query objects like { view: ['list'], terms: { Color: [\"Black, \"Red\"], Brand: [\"VirtoCommerce\", \"Microsoft\"] } }  to string \r\n        serialize: function (searchQuery, defaults) {\r\n            var serializeValues = function (values) {\r\n                return values.join(',');\r\n            };\r\n            var serializePairs = function (pairs) {\r\n                return _.map(Object.keys(pairs), function (key) {\r\n                    return [key, angular.isArray(pairs[key]) ? serializeValues(pairs[key]) : pairs[key]].join(':');\r\n                }).join(';');\r\n            };\r\n            searchQuery = searchQuery || {};\r\n            defaults = defaults || {};\r\n            var result = _.defaults(searchQuery, defaults);\r\n            return _.mapObject(result, function (values, key) {\r\n                return values !== null ? !angular.isArray(values) ? serializePairs(values) : serializeValues(values) : null;\r\n            });\r\n        }\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.component('vcShipmentType', {\r\n    templateUrl: \"themes/assets/js/components/purchase/shipmentType.tpl.html\",\r\n    bindings: {\r\n        ctrl: '=',\r\n        shipmentType: '<',\r\n        shipmentAddress: '<',\r\n        shipmentFulfillmentCenter: '<',\r\n        onFulfillmentCenterSelection: '&',\r\n        onChange: '&'\r\n    },\r\n    transclude: true,\r\n    controllerAs: '$ctrl',\r\n    controller: ['$scope', '$localStorage', 'storefrontApp.mainContext', 'dialogService', function($scope, $localStorage, mainContext, dialogService) {\r\n        var $ctrl = this;\r\n        $ctrl.ctrl = $ctrl;\r\n\r\n        $ctrl.selectFulfillmentCenter = function () {\r\n            var modalInstance = dialogService.showDialog({ searchPhrase: $ctrl.shipmentFulfillmentCenter ? $ctrl.shipmentFulfillmentCenter.postalCode : null }, 'universalDialogController', 'storefront.select-fulfillment-center-dialog.tpl');\r\n            modalInstance.result.then(function(fulfillmentCenter) {\r\n                $ctrl.shipmentFulfillmentCenter = fulfillmentCenter;\r\n                if ($ctrl.onFulfillmentCenterSelection) {\r\n                    $ctrl.onFulfillmentCenterSelection();\r\n                }\r\n            });\r\n        };\r\n        $ctrl.change = function () {\r\n            if ($ctrl.shipmentType === 'shipping' && $ctrl.shipmentAddress || $ctrl.shipmentType === 'pickup' && $ctrl.shipmentFulfillmentCenter) {\r\n                $ctrl.onChange({ shipmentType: $ctrl.shipmentType, shipmentTypeInfo: $ctrl.shipmentType === 'shipping' ? $ctrl.shipmentAddress : $ctrl.shipmentFulfillmentCenter });\r\n            }\r\n        }\r\n    }]\r\n});\r\n","angular.module('storefrontApp')\r\n.controller('universalDialogController', ['$scope', '$uibModalInstance', 'dialogData', function ($scope, $uibModalInstance, dialogData) {\r\n    angular.extend($scope, dialogData);\r\n\r\n    $scope.close = function (result) {\r\n        if (result) {\r\n            $uibModalInstance.close(result);\r\n        } else {\r\n            $uibModalInstance.dismiss('cancel');\r\n        }\r\n    }\r\n\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('cartController', ['$rootScope', '$scope', '$timeout', 'cartService', 'catalogService', 'availabilityService', 'loadingIndicatorService', function ($rootScope, $scope, $timeout, cartService, catalogService, availabilityService, loader) {\r\n    var timer;\r\n\r\n    $scope.loader = loader;\r\n    $scope.coupon = {};\r\n\r\n    var reloadCart = $scope.reloadCart = function() {\r\n        loader.wrapLoading(function() {\r\n            return cartService.getCart().then(function(response) {\r\n                var cart = response.data;\r\n                cart.hasValidationErrors = _.some(cart.validationErrors) || _.some(cart.items, function(item) { return _.some(item.validationErrors) });\r\n                $scope.cart = cart;\r\n\r\n                var coupon = cart.coupon || $scope.coupon;\r\n                coupon.loader = $scope.coupon.loader;\r\n                $scope.coupon = coupon;\r\n                if ($scope.coupon.code && !$scope.coupon.appliedSuccessfully) {\r\n                    $scope.coupon.errorCode = 'InvalidCouponCode';\r\n                }\r\n\r\n                return availabilityService.getProductsAvailability(_.pluck(cart.items, 'productId')).then(function(response) {\r\n                    $scope.availability = _.object(_.pluck(response.data, 'productId'), response.data);\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    initialize();\r\n\r\n    $scope.setCartForm = function (form) {\r\n        $scope.formCart = form;\r\n    }\r\n\r\n    $scope.changeLineItemQuantity = function (lineItemId, quantity) {\r\n        var lineItem = _.find($scope.cart.items, function (i) { return i.id == lineItemId });\r\n        if (!lineItem || quantity < 1 || $scope.cartIsUpdating || $scope.loader.isLoading || $scope.formCart.$invalid) {\r\n            return;\r\n        }\r\n        var initialQuantity = lineItem.quantity;\r\n        lineItem.quantity = quantity;\r\n        $timeout.cancel(timer);\r\n        timer = $timeout(function () {\r\n            $scope.cartIsUpdating = true;\r\n            cartService.changeLineItemQuantity(lineItemId, quantity).then(function (response) {\r\n                reloadCart();\r\n                $rootScope.$broadcast('cartItemsChanged');\r\n            }, function (response) {\r\n                lineItem.quantity = initialQuantity;\r\n                $scope.cartIsUpdating = false;\r\n            });\r\n        }, 300);\r\n    }\r\n\r\n    $scope.changeLineItemPrice = function (lineItemId, newPrice) {\r\n    \tvar lineItem = _.find($scope.cart.items, function (i) { return i.id == lineItemId });\r\n        if (!lineItem || $scope.cartIsUpdating || $scope.loader.isLoading) {\r\n    \t\treturn;\r\n    \t}\r\n    \t$scope.cartIsUpdating = true;\r\n    \tcartService.changeLineItemPrice(lineItemId, newPrice).then(function (response) {\r\n    \t\treloadCart();\r\n    \t\t$rootScope.$broadcast('cartItemsChanged');\r\n    \t}, function (response) {\r\n    \t\t$scope.cart.items = initialItems;\r\n    \t\t$scope.cartIsUpdating = false;\r\n    \t});\r\n    };\r\n    $scope.removeLineItem = function (lineItemId) {\r\n        var lineItem = _.find($scope.cart.items, function (i) { return i.id == lineItemId });\r\n        if (!lineItem || $scope.cartIsUpdating || $scope.loader.isLoading) {\r\n            return;\r\n        }\r\n        $scope.cartIsUpdating = true;\r\n        var initialItems = angular.copy($scope.cart.items);\r\n        $scope.recentCartItemModalVisible = false;\r\n        $scope.cart.items = _.without($scope.cart.items, lineItem);\r\n        cartService.removeLineItem(lineItemId).then(function (response) {\r\n            reloadCart();\r\n            $rootScope.$broadcast('cartItemsChanged');\r\n        }, function (response) {\r\n            $scope.cart.items = initialItems;\r\n            $scope.cartIsUpdating = false;\r\n        });\r\n    }\r\n\r\n    $scope.clearCart = function() {\r\n        loader.wrapLoading(function() {\r\n            return cartService.clearCart().then(function() {\r\n                reloadCart();\r\n                $rootScope.$broadcast('cartItemsChanged');\r\n            });\r\n        });\r\n    };\r\n\r\n    $scope.submitCart = function () {\r\n        $scope.formCart.$setSubmitted();\r\n        if ($scope.formCart.$invalid) {\r\n            return;\r\n        }\r\n        if ($scope.cart.hasPhysicalProducts) {\r\n            $scope.outerRedirect($scope.baseUrl + 'cart/checkout');\r\n        } else {\r\n            $scope.outerRedirect($scope.baseUrl + 'cart/checkout');\r\n        }\r\n    }\r\n\r\n    $scope.searchProduct = function () {\r\n        $scope.productSearchResult = null;\r\n        if ($scope.productSkuOrName) {\r\n            $timeout.cancel(timer);\r\n            timer = $timeout(function () {\r\n                $scope.productSearchProcessing = true;\r\n                var criteria = {\r\n                    keyword: $scope.productSkuOrName,\r\n                    start: 0,\r\n                    pageSize: 5\r\n                }\r\n                catalogService.search(criteria).then(function (response) {\r\n                    $scope.productSearchProcessing = false;\r\n                    $scope.productSearchResult = response.data.products;\r\n                }, function (response) {\r\n                    $scope.productSearchProcessing = false;\r\n                });\r\n            }, 300);\r\n        }\r\n    }\r\n\r\n    $scope.selectSearchedProduct = function (product) {\r\n        $scope.productSearchResult = null;\r\n        $scope.selectedSearchedProduct = product;\r\n        $scope.productSkuOrName = product.name;\r\n    }\r\n\r\n    $scope.addProductToCart = function (product, quantity) {\r\n        $scope.cartIsUpdating = true;\r\n        cartService.addLineItem(product.id, quantity).then(function (response) {\r\n            reloadCart();\r\n            $scope.productSkuOrName = null;\r\n            $scope.selectedSearchedProduct = null;\r\n            $rootScope.$broadcast('cartItemsChanged');\r\n        });\r\n    }\r\n    \r\n    $scope.applyCoupon = function (coupon) {\r\n        coupon.loader.wrapLoading(function() {\r\n            return cartService.addCoupon(coupon.code).then(function() {\r\n                reloadCart();\r\n            });\r\n        });\r\n    }\r\n\r\n    $scope.removeCoupon = function (coupon) {\r\n        coupon.loader.wrapLoading(function() {\r\n            return cartService.removeCoupon().then(function() {\r\n                $scope.coupon = { loader: $scope.coupon.loader };\r\n                reloadCart();\r\n            });\r\n        });\r\n    }\r\n\r\n    function initialize() {\r\n        reloadCart();\r\n    }\r\n}]);\r\n\r\nstorefrontApp.controller('cartBarController', ['$scope', 'cartService', function ($scope, cartService) {\r\n    getCartItemsCount();\r\n\r\n    $scope.$on('cartItemsChanged', function (event, data) {\r\n        getCartItemsCount();\r\n    });\r\n\r\n    function getCartItemsCount() {\r\n        cartService.getCartItemsCount().then(function (response) {\r\n            $scope.cartItemsCount = response.data;\r\n        });\r\n    }\r\n}]);\r\n\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('collectionController', ['$scope', '$location',  function ($scope, $location) {\r\n    $scope.currentFulfillmentCenter = { id: null };\r\n    var $ctrl = this;\r\n    $ctrl.init = function() {\r\n        $ctrl.sortModes = {\r\n            'priority-descending;name-ascending': 'collections.sorting.featured',\r\n            // 'best-selling': 'collections.sorting.best_selling',\r\n            'name-ascending': 'collections.sorting.az',\r\n            'name-descending': 'collections.sorting.za',\r\n            'price-ascending': 'collections.sorting.price_ascending',\r\n            'price-descending': 'collections.sorting.price_descending',\r\n            'createddate-descending': 'collections.sorting.date_descending',\r\n            'createddate-ascending': 'collections.sorting.date_ascending'\r\n        };\r\n        $ctrl.viewQuery = { view: ['grid'] };\r\n        $ctrl.keywordQuery = { keyword: [] };\r\n    }\r\n\r\n    $ctrl.generatePageSizes = function (capacity, steps) {\r\n        $ctrl.pageSizeQuery = { page_size: [capacity] };\r\n        // for example            start: 16 stop: 16 * 3 + 1 = 49 step: 16\r\n        $ctrl.pageSizes = _.range(capacity, capacity * steps + 1, capacity);\r\n    }\r\n\r\n\r\n    $ctrl.init();\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.filter('imgurl', function () {\r\n    return function (input, type) {\r\n        if (!type)\r\n            return input;\r\n\r\n        var extention = '.' + input.split('.').pop();\r\n        var suffix = \"_\" + type;\r\n        var result = input.replace(extention, suffix+extention);\r\n        return result;\r\n    };\r\n});","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('mainController', ['$rootScope', '$scope', '$location', '$window', 'accountApi', 'storefrontApp.mainContext', 'loadingIndicatorService',\r\n    function ($rootScope, $scope, $location, $window, accountApi, mainContext, loader) {\r\n        var $ctrl = this;\r\n        $ctrl.loader = loader;\r\n\r\n        //Base store url populated in layout and can be used for construction url inside controller\r\n        $scope.baseUrl = {};\r\n\r\n        $rootScope.$on('$locationChangeSuccess', function () {\r\n            var path = $location.path();\r\n            if (path) {\r\n                $scope.currentPath = path.replace('/', '');\r\n            }\r\n        });\r\n\r\n        $rootScope.$on('storefrontError', function (event, data) {\r\n            $rootScope.storefrontNotification = data;\r\n            $rootScope.storefrontNotification.detailsVisible = false;\r\n        });\r\n\r\n        $rootScope.toggleNotificationDetails = function () {\r\n            $rootScope.storefrontNotification.detailsVisible = !$rootScope.storefrontNotification.detailsVisible;\r\n        }\r\n\r\n        $rootScope.closeNotification = function () {\r\n            $rootScope.storefrontNotification = null;\r\n        }\r\n\r\n        //For outside app redirect (To reload the page after changing the URL, use the lower-level API)\r\n        $scope.outerRedirect = function (absUrl) {\r\n            $window.location.href = absUrl;\r\n        };\r\n\r\n        //change in the current URL or change the current URL in the browser (for app route)\r\n        $scope.innerRedirect = function (path) {\r\n            $location.path(path);\r\n            $scope.currentPath = $location.$$path.replace('/', '');\r\n        };\r\n\r\n        $scope.stringifyAddress = function (address) {\r\n            var stringifiedAddress = address.firstName + ' ' + address.lastName + ', ';\r\n            stringifiedAddress += address.organization ? address.organization + ', ' : '';\r\n            stringifiedAddress += address.countryName + ', ';\r\n            stringifiedAddress += address.regionName ? address.regionName + ', ' : '';\r\n            stringifiedAddress += address.city + ' ';\r\n            stringifiedAddress += address.line1 + ', ';\r\n            stringifiedAddress += address.line2 ? address.line2 : '';\r\n            stringifiedAddress += address.postalCode;\r\n            return stringifiedAddress;\r\n        }\r\n\r\n        $scope.getObjectSize = function (obj) {\r\n            var size = 0, key;\r\n            for (key in obj) {\r\n                if (obj.hasOwnProperty(key)) {\r\n                    size++;\r\n                }\r\n            }\r\n            return size;\r\n        }\r\n\r\n        mainContext.loadCustomer = $scope.loadCustomer = function () {\r\n            return loader.wrapLoading(function() {\r\n                return accountApi.getCurrentUser().then(function (response) {\r\n                    var addressId = 1;\r\n                    _.each(response.data.addresses, function (address) {\r\n                        address.id = addressId;\r\n                        addressId++;\r\n                    });\r\n                    response.data.isContact = response.data.memberType === 'Contact';\r\n                    mainContext.customer = $scope.customer = response.data;\r\n                    return response.data;\r\n                });\r\n                \r\n            });\r\n        };\r\n\r\n       $scope.loadCustomer();\r\n    }])\r\n\r\n    .factory('storefrontApp.mainContext', function () {\r\n        return {};\r\n    });\r\n","var storefrontApp = angular.module('storefrontApp');\r\nstorefrontApp.controller('orderController', ['$scope', '$window', 'orderService', function ($scope, $window, orderService) {\r\n    getOrder($window.orderNumber);\r\n\r\n    function getOrder(orderNumber) {\r\n        orderService.getOrder(orderNumber).then(function (response) {\r\n            if (response && response.data) {\r\n                $scope.order = response.data;\r\n            }\r\n        });\r\n    }\r\n}]);","if (Prism.languages.markup) {\r\n    Prism.languages.insertBefore('markup', 'tag', {\r\n        'script': {\r\n            pattern: /(<script[\\s\\S]*?type=\"text\\/ng-template\"[\\s\\S]*?>)[\\s\\S]*?(?=<\\/script>)/i,\r\n            lookbehind: true,\r\n            inside: Prism.languages.html,\r\n            alias: 'language-html'\r\n        }\r\n    });\r\n}\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('productController', ['$rootScope', '$scope', '$window', '$timeout', 'dialogService', 'catalogService', 'cartService', 'quoteRequestService', 'availabilityService',\r\n    function ($rootScope, $scope, $window, $timeout, dialogService, catalogService, cartService, quoteRequestService, availabilityService) {\r\n        //TODO: prevent add to cart not selected variation\r\n        // display validator please select property\r\n        // display price range\r\n\r\n        $scope.allVariations = [];\r\n        $scope.allVariationsMap = {}\r\n        $scope.allVariationPropsMap = {};\r\n        $scope.allVariationPropsMapCount = null;\r\n        $scope.filterableVariationPropsMap = { };\r\n        $scope.selectedVariation = {};\r\n        $scope.productPrice = null;\r\n        $scope.productPriceLoaded = false;\r\n\r\n        $scope.addProductToCart = function (product, quantity) {\r\n            var dialogData = toDialogDataModel(product, quantity);\r\n            dialogService.showDialog(dialogData, 'recentlyAddedCartItemDialogController', 'storefront.recently-added-cart-item-dialog.tpl');\r\n            cartService.addLineItem(product.id, quantity).then(function (response) {\r\n                $rootScope.$broadcast('cartItemsChanged');\r\n            });\r\n        }\r\n\r\n        // TODO: Replace mock with real function\r\n        $scope.addProductsToCartMock = function () {\r\n            var rejection = {\r\n                data: {\r\n                    message: \"The 1 product(s) below was not added to cart:\",\r\n                    modelState: {\r\n                        \"Test\": \"Test\"\r\n                    }\r\n                }\r\n            };\r\n            var items = [\r\n                {\r\n                    id: \"9cbd8f316e254a679ba34a900fccb076\",\r\n                    name: \"3DR Solo Quadcopter (No Gimbal)\",\r\n                    imageUrl: \"//localhost/admin/assets/catalog/1428965138000_1133723.jpg\",\r\n                    price: {\r\n                        actualPrice: {\r\n                            formattedAmount: \"$896.39\"\r\n                        },\r\n                        actualPriceWithTax: {\r\n                            formattedAmount: \"$1,075.67\"\r\n                        },\r\n                        listPrice: {\r\n                            formattedAmount: \"$995.99\"\r\n                        },\r\n                        listPriceWithTax: {\r\n                            formattedAmount: \"$1,195.19\"\r\n                        },\r\n                        extendedPrice: {\r\n                            formattedAmount: \"$1,792.78\"\r\n                        },\r\n                        extendedPriceWithTax: {\r\n                            formattedAmount: \"$2,151.34\"\r\n                        }\r\n                    },\r\n                    quantity: 2,\r\n                    url: \"~/camcorders/aerial-imaging-drones/3dr-solo-quadcopter-no-gimbal\"\r\n                },\r\n                {\r\n                    id: \"ad4ae79ffdbc4c97959139a0c387c72e\",\r\n                    name: \"Samsung Galaxy Note 4 SM-N910C 32GB\",\r\n                    imageUrl: \"//localhost/admin/assets/catalog/1416164841000_1097106.jpg\",\r\n                    price: {\r\n                        actualPrice: {\r\n                            formattedAmount: \"$530.99\"\r\n                        },\r\n                        actualPriceWithTax: {\r\n                            formattedAmount: \"$637.19\"\r\n                        },\r\n                        listPrice: {\r\n                            formattedAmount: \"$589.99\"\r\n                        },\r\n                        listPriceWithTax: {\r\n                            formattedAmount: \"$707.99\"\r\n                        },\r\n                        extendedPrice: {\r\n                            formattedAmount: \"$1,592.97\"\r\n                        },\r\n                        extendedPriceWithTax: {\r\n                            formattedAmount: \"$1,911.57\"\r\n                        }\r\n                    },\r\n                    quantity: 5,\r\n                    url: \"~/cell-phones/samsung-galaxy-note-4-sm-n910c-32gb\"\r\n                }\r\n            ];\r\n            var dialogData = toDialogDataModelMock(items, rejection);\r\n            dialogService.showDialog(dialogData, 'recentlyAddedCartItemDialogController', 'storefront.recently-added-cart-item-dialog.tpl');\r\n        }\r\n\r\n        $scope.addProductToCartById = function (productId, quantity, event) {\r\n            event.preventDefault();\r\n            catalogService.getProduct([productId]).then(function (response) {\r\n                if (response.data && response.data.length) {\r\n                    var product = response.data[0];\r\n                    $scope.addProductToCart(product, quantity);\r\n                }\r\n            });\r\n        }\r\n\r\n        $scope.addProductToActualQuoteRequest = function (product, quantity) {\r\n            var dialogData = toDialogDataModel(product, quantity);\r\n            dialogService.showDialog(dialogData, 'recentlyAddedActualQuoteRequestItemDialogController', 'storefront.recently-added-actual-quote-request-item-dialog.tpl');\r\n            quoteRequestService.addProductToQuoteRequest(product.id, quantity).then(function (response) {\r\n                $rootScope.$broadcast('actualQuoteRequestItemsChanged');\r\n            });\r\n        }\r\n\r\n        function toDialogDataModel(product, quantity) {\r\n            return { items: [angular.extend({ }, product, { quantity: quantity })] };\r\n            //     return {\r\n            //         id: product.id,\r\n            //         name: product.name,\r\n            //         imageUrl: product.primaryImage ? product.primaryImage.url : null,\r\n            //         listPrice: product.price.listPrice,\r\n            //listPriceWithTax: product.price.listPriceWithTax,\r\n            //         placedPrice: product.price.actualPrice,\r\n            //         placedPriceWithTax: product.price.actualPriceWithTax,\r\n            //         quantity: quantity,\r\n            //         updated: false\r\n            //     }\r\n        }\r\n\r\n        function toDialogDataModelMock(items, rejection) {\r\n            var dialogDataModel = {};\r\n            if (rejection) {\r\n                dialogDataModel.errorMessage = rejection.data.message;\r\n                dialogDataModel.errors = rejection.data.modelState;\r\n            }\r\n            dialogDataModel.items = items;\r\n            return dialogDataModel;\r\n        }\r\n\r\n        function initialize(filters) {\r\n            var product = $window.product;\r\n            if (!product || !product.id) {\r\n                return;\r\n            }\r\n            catalogService.getProduct([product.id]).then(function (response) {\r\n\t\t\t\tvar product = response.data[0];\r\n                //Current product is also a variation (titular)\r\n                var allVariations = [product].concat(product.variations || []);\r\n                var filteredVariations = allVariations;\r\n                $scope.allVariations.length = 0;\r\n                if (filters) {\r\n                    var variationPropsKeys = Object.keys(filters.terms || {});\r\n                    filteredVariations = _.filter(allVariations, function(variation) {\r\n                        return _.all(variation.variationProperties, function(property) {\r\n                            return !variationPropsKeys.includes(property.displayName) || filters.terms[property.displayName].includes(property.value);\r\n                        });\r\n                    });\r\n                }\r\n                Array.prototype.push.apply($scope.allVariations, filteredVariations);\r\n                angular.copy(_.object(filteredVariations.map(function (variation) { return [variation.id, variation]; })), $scope.allVariationsMap);\r\n                angular.copy(getFlatternDistinctPropertiesMap(allVariations), $scope.allVariationPropsMap);\r\n                angular.copy(_.pick($scope.allVariationPropsMap, function (value, key, object) { return value.length > 1; }), $scope.filterableVariationPropsMap);\r\n                $scope.allVariationPropsMapCount = _.keys($scope.allVariationPropsMap).length;\r\n                //Auto select initial product as default variation  (its possible because all our products is variations)\r\n                //var propertyMap = getVariationPropertyMap(product);\r\n                //_.each(_.keys(propertyMap), function (x) {\r\n                //    $scope.checkProperty(propertyMap[x][0])\r\n                //});\r\n                $scope.selectedVariation = product;\r\n\r\n                return availabilityService.getProductsAvailability([product.id]).then(function(response) {\r\n                    $scope.availability = _.object(_.pluck(response.data, 'productId'), response.data);\r\n                });\r\n            });\r\n        };\r\n\r\n        function getFlatternDistinctPropertiesMap(variations) {\r\n            var retVal = {};\r\n            _.each(variations, function (variation) {\r\n                var propertyMap = getVariationPropertyMap(variation);\r\n                //merge\r\n                _.each(_.keys(propertyMap), function (x) {\r\n                    retVal[x] = _.uniq(_.union(retVal[x], propertyMap[x]), \"value\");\r\n                });\r\n            });\r\n            return retVal;\r\n        };\r\n\r\n        function getVariationPropertyMap(variation) {\r\n            return _.groupBy(variation.variationProperties, function (x) { return x.displayName });\r\n        }\r\n\r\n        function getSelectedPropsMap(variationPropsMap) {\r\n            var retVal = {};\r\n            _.each(_.keys(variationPropsMap), function (x) {\r\n                var property = _.find(variationPropsMap[x], function (y) {\r\n                    return y.selected;\r\n                });\r\n                if (property) {\r\n                    retVal[x] = [property];\r\n                }\r\n            });\r\n            return retVal;\r\n        }\r\n\r\n        function comparePropertyMaps(propMap1, propMap2) {\r\n            return _.every(_.keys(propMap1), function (x) {\r\n                var retVal = propMap2.hasOwnProperty(x);\r\n                if (retVal) {\r\n                    retVal = propMap1[x][0].value == propMap2[x][0].value;\r\n                }\r\n                return retVal;\r\n            });\r\n        };\r\n\r\n        //function findVariationBySelectedProps(variations, selectedPropMap) {\r\n        //    return _.find(variations, function (x) {\r\n        //        return comparePropertyMaps(getVariationPropertyMap(x), selectedPropMap);\r\n        //    });\r\n        //}\r\n\r\n        ////Method called from View when user clicks one property value\r\n        //$scope.checkProperty = function (property) {\r\n        //    //Select appropriate property and unselect previous selection\r\n        //    _.each($scope.allVariationPropsMap[property.displayName], function (x) {\r\n        //        x.selected = x != property ? false : !x.selected;\r\n        //    });\r\n\r\n        //    //try to find the best variation match for selected properties\r\n        //    $scope.selectedVariation = findVariationBySelectedProps(allVariations, getSelectedPropsMap($scope.allVariationPropsMap));\r\n        //};\r\n\r\n        $scope.sendToEmail = function (storeId, productId, productUrl, language) {\r\n            dialogService.showDialog({ storeId: storeId, productId: productId, productUrl: productUrl, language: language }, 'recentlyAddedCartItemDialogController', 'storefront.send-product-to-email.tpl');\r\n        };\r\n\r\n        $scope.$watch('filters', initialize);\r\n    }]);\r\n\r\nstorefrontApp.controller('recentlyAddedCartItemDialogController', ['$scope', '$window', '$uibModalInstance', 'mailingService', 'dialogData', function ($scope, $window, $uibModalInstance, mailingService, dialogData) {\r\n    $scope.dialogData = dialogData;\r\n\r\n    $scope.close = function() {\r\n        $uibModalInstance.dismiss('cancel');\r\n    }\r\n\r\n    $scope.redirect = function (url) {\r\n        $window.location.href = url;\r\n    }\r\n    $scope.send = function(email) {\r\n        mailingService.sendProduct(dialogData.productId, { email: email, storeId: dialogData.storeId, productUrl: dialogData.productUrl, language: dialogData.language });\r\n        $uibModalInstance.close();\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('quoteRequestController', ['$rootScope', '$scope', '$window', '$location', 'quoteRequestService', 'commonService',\r\n    function ($rootScope, $scope, $window, $location, quoteRequestService, commonService) {\r\n    initialize();\r\n\r\n    $scope.setQuoteRequestForm = function (form) {\r\n        $scope.formQuoteRequest = form;\r\n    }\r\n\r\n    $scope.displayForStatuses = function (statuses) {\r\n        return _.contains(statuses, $scope.quoteRequest.status);\r\n    }\r\n\r\n    $scope.addTierPrice = function (quoteItem) {\r\n        quoteItem.proposalPrices.push({\r\n            id: quoteItem.proposalPrices.length + 1,\r\n            price: quoteItem.salePrice,\r\n            quantity: 1\r\n        });\r\n    }\r\n\r\n    $scope.changeTierPriceQuantity = function (tierPrice, quantity) {\r\n        if (quantity < 1 || quantity.isNaN) {\r\n            return;\r\n        }\r\n        tierPrice.quantity = quantity;\r\n    }\r\n\r\n    $scope.removeTierPrice = function (quoteItem, tierPrice) {\r\n        quoteItem.proposalPrices = _.without(quoteItem.proposalPrices, tierPrice);\r\n    }\r\n\r\n    $scope.removeProductFromQuoteRequest = function (quoteItem) {\r\n        var initialQuoteItems = angular.copy($scope.quoteRequest.items);\r\n        $scope.quoteRequest.items = _.without($scope.quoteRequest.items, quoteItem);\r\n        quoteRequestService.removeProductFromQuoteRequest($scope.quoteRequest.id, quoteItem.id).then(function (response) {\r\n            getQuoteRequest($scope.quoteRequest.id);\r\n            $rootScope.$broadcast('actualQuoteRequestItemsChanged');\r\n        }, function (response) {\r\n            $scope.quoteRequest.items = initialQuoteItems;\r\n        });\r\n    }\r\n\r\n    $scope.setCountry = function (addressType, countryName) {\r\n        var country = _.find($scope.countries, function (c) { return c.name == countryName });\r\n        if (!country) {\r\n            return;\r\n        }\r\n        if (addressType == 'Billing') {\r\n            $scope.billingCountry = country;\r\n            $scope.billingCountryRegions = [];\r\n            $scope.quoteRequest.billingAddress.countryCode = country.code3 || country.code2;\r\n            $scope.quoteRequest.billingAddress.regionId = null;\r\n            $scope.quoteRequest.billingAddress.regionName = null;\r\n        }\r\n        if (addressType == 'Shipping') {\r\n            $scope.shippingCountry = country;\r\n            $scope.shippingCountryRegions = [];\r\n            $scope.quoteRequest.shippingAddress.countryCode = country.code3 || country.code2;\r\n            $scope.quoteRequest.shippingAddress.regionId = null;\r\n            $scope.quoteRequest.shippingAddress.regionName = null;\r\n        }\r\n        if (country.code3) {\r\n            getCountryRegions(addressType, country.code3);\r\n        }\r\n    }\r\n\r\n    $scope.setCountryRegion = function (addressType) {\r\n        if (addressType == 'Billing') {\r\n            var countryRegion = _.find($scope.billingCountryRegions, function (r) { return r.name == $scope.quoteRequest.billingAddress.regionName });\r\n            if (!countryRegion) {\r\n                return;\r\n            }\r\n            $scope.quoteRequest.billingAddress.regionId = countryRegion.code;\r\n        }\r\n        if (addressType == 'Shipping') {\r\n            var countryRegion = _.find($scope.shippingCountryRegions, function (r) { return r.name == $scope.quoteRequest.shippingAddress.regionName });\r\n            if (!countryRegion) {\r\n                return;\r\n            }\r\n            $scope.quoteRequest.shippingAddress.regionId = countryRegion.code;\r\n        }\r\n    }\r\n\r\n    $scope.selectCustomerAddress = function (addressType) {\r\n        if (addressType === 'Billing') {\r\n            var billingAddress = _.find($scope.customer.addresses, function (a) { return a.id === $scope.quoteRequest.billingAddress.id });\r\n            if (billingAddress) {\r\n                billingAddress.type = 'Billing';\r\n                if (billingAddress.countryCode) {\r\n                    getCountryRegions('Billing', billingAddress.countryCode);\r\n                }\r\n                $scope.quoteRequest.billingAddress = angular.copy(billingAddress);\r\n            }\r\n        }\r\n        if (addressType === 'Shipping') {\r\n            var shippingAddress = _.find($scope.customer.addresses, function (a) { return a.id === $scope.quoteRequest.shippingAddress.id });\r\n            if (shippingAddress) {\r\n                shippingAddress.type = 'Shipping';\r\n                if (shippingAddress.countryCode) {\r\n                    getCountryRegions('Shipping', shippingAddress.countryCode);\r\n                }\r\n                $scope.quoteRequest.shippingAddress = angular.copy(shippingAddress);\r\n            }\r\n        }\r\n    }\r\n\r\n    $scope.stringifyAddress = function (address) {\r\n        if (!address) {\r\n            return;\r\n        }\r\n        var stringifiedAddress = address.firstName + ' ' + address.lastName + ', ';\r\n        stringifiedAddress += address.organization ? address.organization + ', ' : '';\r\n        stringifiedAddress += address.countryName + ', ';\r\n        stringifiedAddress += address.regionName ? address.regionName + ', ' : '';\r\n        stringifiedAddress += address.city + ' ';\r\n        stringifiedAddress += address.line1 + ', ';\r\n        stringifiedAddress += address.line2 ? address.line2 : '';\r\n        stringifiedAddress += address.postalCode;\r\n        return stringifiedAddress;\r\n    }\r\n\r\n    $scope.submitQuoteRequest = function () {\r\n        $scope.formQuoteRequest.$setSubmitted();\r\n        if ($scope.formQuoteRequest.$invalid) {\r\n            return;\r\n        }\r\n        $scope.quoteRequest.billingAddress.email = $scope.quoteRequest.email;\r\n        if ($scope.quoteRequest.shippingAddress) {\r\n            $scope.quoteRequest.shippingAddress.email = $scope.quoteRequest.email;\r\n        }\r\n        quoteRequestService.submitQuoteRequest($scope.quoteRequest.id, toFormModel($scope.quoteRequest)).then(function (response) {\r\n            if ($scope.customer.isRegisteredUser) {\r\n                $scope.outerRedirect($scope.baseUrl + 'account/quoterequests');\r\n            } else {\r\n                $scope.outerRedirect($scope.baseUrl + 'account/login');\r\n            }\r\n        });\r\n    }\r\n\r\n    $scope.rejectQuoteRequest = function () {\r\n        quoteRequestService.rejectQuoteRequest($scope.quoteRequest.id).then(function (response) {\r\n            quoteRequestService.getQuoteRequest($scope.quoteRequest.id).then(function (response) {\r\n                $scope.quoteRequest = response.data;\r\n            });\r\n        });\r\n    }\r\n\r\n    $scope.selectTierPrice = function () {\r\n        quoteRequestService.getTotals($scope.quoteRequest.id, toFormModel($scope.quoteRequest)).then(function (response) {\r\n            $scope.quoteRequest.totals = response.data;\r\n        });\r\n    }\r\n\r\n    $scope.confirmQuoteRequest = function () {\r\n        quoteRequestService.confirmQuoteRequest($scope.quoteRequest.id, toFormModel($scope.quoteRequest)).then(function (response) {\r\n            $scope.outerRedirect($scope.baseUrl + 'cart/checkout/#/shipping-address');\r\n        });\r\n    }\r\n\r\n    $scope.setRequestShippingQuote = function () {\r\n        if (!$scope.quoteRequest.requestShippingQuote) {\r\n            $scope.quoteRequest.shippingAddress = null;\r\n        }\r\n    }\r\n\r\n    $scope.setShippingAddressEqualsBilling = function () {\r\n        if ($scope.quoteRequest.shippingAddressEqualsBilling) {\r\n            $scope.quoteRequest.shippingAddress = angular.copy($scope.quoteRequest.billingAddress);\r\n            $scope.quoteRequest.shippingAddress.type = 'Shipping';\r\n            if ($scope.quoteRequest.shippingAddress.countryCode) {\r\n                $scope.shippingCountry = $scope.billingCountry;\r\n                getCountryRegions('Shipping', $scope.quoteRequest.shippingAddress.countryCode);\r\n            }\r\n        }\r\n    }\r\n\r\n    $scope.tierPricesUnique = function (quoteItem) {\r\n        var quantities = _.map(quoteItem.proposalPrices, function (p) { return p.quantity });\r\n        return _.uniq(quantities).length == quoteItem.proposalPrices.length;\r\n    }\r\n\r\n    function initialize() {\r\n        var quoteRequestNumber = $location.url().replace('/', '') || $window.currentQuoteRequestNumber;\r\n        $scope.billingCountry = null;\r\n        $scope.shippingCountry = null;\r\n        getCountries();\r\n        if (quoteRequestNumber) {\r\n            getQuoteRequest(quoteRequestNumber);\r\n        } else {\r\n            $scope.quoteRequest = { itemsCount: 0 };\r\n        }\r\n    }\r\n\r\n    function getQuoteRequest(number) {\r\n        quoteRequestService.getQuoteRequest(number).then(function (response) {\r\n            var quoteRequest = response.data;\r\n            if (!quoteRequest.billingAddress) {\r\n                if ($scope.customer.addresses.length) {\r\n                    quoteRequest.billingAddress = angular.copy($scope.customer.addresses[0]);\r\n                    quoteRequest.billingAddress.type = 'Billing';\r\n                    if (quoteRequest.billingAddress.countryCode) {\r\n                        getCountryRegions('Billing', quoteRequest.billingAddress.countryCode);\r\n                    }\r\n                } else {\r\n                    quoteRequest.billingAddress = {\r\n                        firstName: $scope.customer.firstName,\r\n                        lastName: $scope.customer.lastName\r\n                    };\r\n                }\r\n            }\r\n            _.each(quoteRequest.items, function (quoteItem) {\r\n                var i = 1;\r\n                _.each(quoteItem.proposalPrices, function (tierPrice) {\r\n                    tierPrice.id = i;\r\n                    if (quoteItem.selectedTierPrice.quantity == tierPrice.quantity) {\r\n                        quoteItem.selectedTierPrice = tierPrice;\r\n                    }\r\n                    i++;\r\n                });\r\n            });\r\n            quoteRequest.requestShippingQuote = true;\r\n            $scope.quoteRequest = quoteRequest;\r\n        });\r\n    }\r\n\r\n    function getCountries() {\r\n        commonService.getCountries().then(function (response) {\r\n            $scope.countries = response.data;\r\n        });\r\n    }\r\n\r\n    function getCountryRegions(addressType, countryCode) {\r\n        commonService.getCountryRegions(countryCode).then(function (response) {\r\n            var countryRegions = response.data;\r\n            if (addressType == 'Billing') {\r\n                $scope.billingCountryRegions = countryRegions || [];\r\n            }\r\n            if (addressType == 'Shipping') {\r\n                $scope.shippingCountryRegions = countryRegions || [];\r\n            }\r\n        });\r\n    }\r\n\r\n    function toFormModel(quoteRequest) {\r\n        var quoteRequestFormModel = {\r\n            id: quoteRequest.id,\r\n            tag: quoteRequest.tag,\r\n            status: quoteRequest.status,\r\n            comment: quoteRequest.comment,\r\n            billingAddress: quoteRequest.billingAddress,\r\n            shippingAddress: quoteRequest.shippingAddress,\r\n            items: []\r\n        };\r\n        _.each(quoteRequest.items, function (quoteItem) {\r\n            var quoteItemFormModel = {\r\n                id: quoteItem.id,\r\n                comment: quoteItem.comment,\r\n                selectedTierPrice: {\r\n                    price: quoteItem.selectedTierPrice.price.amount,\r\n                    quantity: quoteItem.selectedTierPrice.quantity\r\n                },\r\n                proposalPrices: []\r\n            };\r\n            _.each(quoteItem.proposalPrices, function (tierPrice) {\r\n                quoteItemFormModel.proposalPrices.push({\r\n                    price: tierPrice.price.amount,\r\n                    quantity: tierPrice.quantity\r\n                });\r\n            });\r\n            quoteRequestFormModel.items.push(quoteItemFormModel);\r\n        });\r\n\r\n        return quoteRequestFormModel;\r\n    }\r\n}]);\r\n\r\nstorefrontApp.controller('actualQuoteRequestBarController', ['$scope', 'quoteRequestService', function ($scope, quoteRequestService) {\r\n    getCurrentQuoteRequest();\r\n\r\n    $scope.$on('actualQuoteRequestItemsChanged', function (event, data) {\r\n        getCurrentQuoteRequest();\r\n    });\r\n\r\n    function getCurrentQuoteRequest() {\r\n        quoteRequestService.getCurrentQuoteRequest().then(function (response) {\r\n            $scope.actualQuoteRequest = response.data;\r\n        });\r\n    }\r\n}]);\r\n\r\nstorefrontApp.controller('recentlyAddedActualQuoteRequestItemDialogController', ['$scope', '$window', '$uibModalInstance', 'dialogData',\r\n    function ($scope, $window, $uibModalInstance, dialogData) {\r\n\r\n    $scope.$on('actualQuoteRequestItemsChanged', function (event, data) {\r\n        dialogData.updated = true;\r\n    });\r\n\r\n    $scope.dialogData = dialogData;\r\n\r\n    $scope.close = function () {\r\n        $uibModalInstance.close();\r\n    }\r\n\r\n    $scope.redirect = function (url) {\r\n        $window.location = url;\r\n    }\r\n}]);\r\n","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.controller('recommendationsController', ['$scope', '$timeout', 'recommendationService', function ($scope, $timeout, recommendationService) {\r\n   \r\n    $scope.isBlockVisible = false;\r\n    $scope.productListRecommendationsLoaded = false;\r\n    $scope.productListRecommendations = [];\r\n   \r\n    $scope.getRecommendations = function (evalContext) {\r\n     \r\n        if (_.isString(evalContext.productIds)) {\r\n            if (evalContext.productIds.match(\",\")) {\r\n                var values = evalContext.productIds.split(',');\r\n                evalContext.productIds = values;\r\n            }\r\n            else {\r\n                evalContext.productIds = [evalContext.productIds];\r\n            }\r\n        }\r\n        recommendationService.getRecommendedProducts(evalContext).then(function (response) {\r\n            var products = response.data;\r\n            if (products.length) {\r\n                for (var i = 0; i < products.length; i++) {\r\n                    $scope.productListRecommendations.push(products[i]);\r\n                }\r\n\r\n                $scope.isBlockVisible = products.length > 0;\r\n            }\r\n\r\n            $scope.productListRecommendationsLoaded = true;            \r\n        });\r\n    }\r\n    $scope.startRecordInteraction = function () {\r\n        //Necessary condition for ensure what angularjs rendering process finished\r\n        $timeout(function () {\r\n           window.startRecordInteraction();\r\n        });\r\n    }\r\n}]);","var storefrontApp = angular.module('storefrontApp');\r\n\r\nstorefrontApp.service('dialogService', ['$uibModal', function ($uibModal) {\r\n    return {\r\n        showDialog: function (dialogData, controller, templateUrl) {\r\n            var modalInstance = $uibModal.open({\r\n                controller: controller,\r\n                templateUrl: templateUrl,\r\n                resolve: {\r\n                    dialogData: function () {\r\n                        return dialogData;\r\n                    }\r\n                }\r\n            });\r\n            return modalInstance;\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('mailingService', ['$http', 'apiBaseUrl', function ($http, apiBaseUrl) {\r\n    return {\r\n        sendProduct: function(id, data) {\r\n            return $http.post(apiBaseUrl + 'api/b2b/send/product/' + id, data);\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('feedbackService', ['$http', function ($http) {\r\n    return {\r\n        postFeedback: function (data) {\r\n            return $http.post('storefrontapi/feedback', { model: data });\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('marketingService', ['$http', function ($http) {\r\n    return {\r\n        getDynamicContent: function (placeName) {\r\n            return $http.get('storefrontapi/marketing/dynamiccontent/' + placeName + '?t=' + new Date().getTime());\r\n        },\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('pricingService', ['$http', function ($http) {\r\n\treturn {\r\n\t\tgetActualProductPrices: function (products) {\r\n\t\t    return $http.post('storefrontapi/pricing/actualprices', products);\r\n\t\t}\r\n\t}\r\n}]);\r\n\r\nstorefrontApp.service('catalogService', ['$http', function ($http) {\r\n    return {\r\n        getProduct: function (productIds) {\r\n            return $http.get('storefrontapi/products?productIds=' + productIds + '&t=' + new Date().getTime());\r\n        },\r\n        getProducts: function(productIds) {\r\n            return $http.get('storefrontapi/products?' + productIds + '&t=' + new Date().getTime());\r\n        },\r\n        search: function (criteria) {\r\n            return $http.post('storefrontapi/catalog/search', criteria);\r\n        },\r\n        searchCategories: function (criteria) {\r\n            return $http.post('storefrontapi/categories/search', criteria);\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('cartService', ['$http', function ($http) {\r\n    return {\r\n        getCart: function () {\r\n            return $http.get('storefrontapi/cart?t=' + new Date().getTime());\r\n        },\r\n        getCartItemsCount: function () {\r\n            return $http.get('storefrontapi/cart/itemscount?t=' + new Date().getTime());\r\n        },\r\n        addLineItem: function (productId, quantity) {\r\n            return $http.post('storefrontapi/cart/items', { id: productId, quantity: quantity });\r\n        },\r\n        changeLineItemQuantity: function (lineItemId, quantity) {\r\n            return $http.put('storefrontapi/cart/items', { lineItemId: lineItemId, quantity: quantity });\r\n        },\r\n        changeLineItemsQuantity: function(items) {\r\n            return $http.put('storefrontapi/cart/items', items);\r\n        },\r\n        removeLineItem: function (lineItemId) {\r\n            return $http.delete('storefrontapi/cart/items?lineItemId=' + lineItemId);\r\n        },\r\n        changeLineItemPrice: function (lineItemId, newPrice) {\r\n        \treturn $http.put('storefrontapi/cart/items/price', { lineItemId: lineItemId, newPrice: newPrice});\r\n        },\r\n        clearCart: function () {\r\n            return $http.post('storefrontapi/cart/clear');\r\n        },     \r\n        addCoupon: function (couponCode) {\r\n            return $http.post('storefrontapi/cart/coupons/' + couponCode);\r\n        },\r\n        removeCoupon: function () {\r\n            return $http.delete('storefrontapi/cart/coupons');\r\n        },\r\n        addOrUpdateShipment: function (shipment) {\r\n            return $http.post('storefrontapi/cart/shipments', shipment);\r\n        },\r\n        addOrUpdatePayment: function (payment) {\r\n            return $http.post('storefrontapi/cart/payments', payment );\r\n        },\r\n        getAvailableShippingMethods: function (shipmentId) {\r\n            return $http.get('storefrontapi/cart/shipments/' + shipmentId + '/shippingmethods?t=' + new Date().getTime());\r\n        },\r\n        getAvailablePaymentMethods: function () {\r\n            return $http.get('storefrontapi/cart/paymentmethods?t=' + new Date().getTime());\r\n        },\r\n        addOrUpdatePaymentPlan: function (plan) {\r\n            return $http.post('storefrontapi/cart/paymentPlan', plan);\r\n        },\r\n        removePaymentPlan: function () {\r\n            return $http.delete('storefrontapi/cart/paymentPlan');\r\n        },\r\n        createOrder: function (bankCardInfo) {\r\n            return $http.post('storefrontapi/cart/createorder', { bankCardInfo: bankCardInfo });\r\n        }\r\n    }\r\n}]);\r\n\r\n\r\n\r\nstorefrontApp.service('quoteRequestService', ['$http', function ($http) {\r\n    return {\r\n        getCurrentQuoteRequest: function () {\r\n            return $http.get('storefrontapi/quoterequest/current?t=' + new Date().getTime());\r\n        },\r\n        getQuoteRequest: function (number) {\r\n            return $http.get('storefrontapi/quoterequests/' + number + '?t=' + new Date().getTime());\r\n        },\r\n        getQuoteRequestItemsCount: function (number) {\r\n            return $http.get('storefrontapi/quoterequests/' + number + '/itemscount?t=' + new Date().getTime());\r\n        },\r\n        addProductToQuoteRequest: function (productId, quantity) {\r\n            return $http.post('storefrontapi/quoterequests/current/items', { productId: productId, quantity: quantity });\r\n        },\r\n        removeProductFromQuoteRequest: function (quoteRequestNumber, quoteItemId) {\r\n            return $http.delete('storefrontapi/quoterequests/' + quoteRequestNumber + '/items/' + quoteItemId);\r\n        },\r\n        submitQuoteRequest: function (quoteRequestNumber, quoteRequest) {\r\n            return $http.post('storefrontapi/quoterequests/' + quoteRequestNumber + '/submit', { quoteForm: quoteRequest });\r\n        },\r\n        rejectQuoteRequest: function (quoteRequestNumber) {\r\n            return $http.post('storefrontapi/quoterequests/' + quoteRequestNumber + '/reject');\r\n        },\r\n        updateQuoteRequest: function (quoteRequestNumber, quoteRequest) {\r\n            return $http.put('storefrontapi/quoterequests/' + quoteRequestNumber + '/update', { quoteRequest: quoteRequest });\r\n        },\r\n        getTotals: function (quoteRequestNumber, quoteRequest) {\r\n            return $http.post('storefrontapi/quoterequests/' + quoteRequestNumber + '/totals', { quoteRequest: quoteRequest });\r\n        },\r\n        confirmQuoteRequest: function (quoteRequestNumber, quoteRequest) {\r\n            return $http.post('storefrontapi/quoterequests/' + quoteRequestNumber + '/confirm', { quoteRequest: quoteRequest });\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('recommendationService', ['$http', function ($http) {\r\n    return {\r\n        getRecommendedProducts: function (requestData) {\r\n            return $http.post('storefrontapi/recommendations', requestData );\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('orderService', ['$http', function ($http) {\r\n    return {\r\n        getOrder: function (orderNumber) {\r\n            return $http.get('storefrontapi/orders/' + orderNumber + '?t=' + new Date().getTime());\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('compareProductService', ['$http', '$localStorage', function($http, $localStorage) {\r\n    return {\r\n        isInProductCompareList: function(productId) {\r\n            var containProduct;\r\n            if (!_.some($localStorage['productCompareListIds'], function(id) { return id === productId })) {\r\n                containProduct = false;\r\n            }\r\n            else\r\n                containProduct = true\r\n            return containProduct;\r\n        },\r\n        addProduct: function(productId) {\r\n            if (!$localStorage['productCompareListIds']) {\r\n                $localStorage['productCompareListIds'] = [];\r\n            }\r\n            $localStorage['productCompareListIds'].push(productId);\r\n            _.uniq($localStorage['productCompareListIds']);\r\n        },\r\n        getProductsIds: function() {\r\n            if (!$localStorage['productCompareListIds']) {\r\n                $localStorage['productCompareListIds'] = [];\r\n                return;\r\n            }\r\n            var ids = [];\r\n            for (i = 0; i < $localStorage['productCompareListIds'].length; i++) {\r\n                ids.push('productIds=' + $localStorage['productCompareListIds'][i]);\r\n            }\r\n            return ids.join(\"&\");\r\n        },\r\n        getProductsCount: function() {\r\n            var count = $localStorage['productCompareListIds'] ? $localStorage['productCompareListIds'].length : 0;\r\n            return count;\r\n        },\r\n        clearCompareList: function() {\r\n            $localStorage['productCompareListIds'] = [];\r\n        },\r\n        removeProduct: function(productId) {\r\n            $localStorage['productCompareListIds'] = _.without($localStorage['productCompareListIds'], productId);\r\n        }\r\n    }\r\n}]);\r\n\r\n\r\nstorefrontApp.service('commonService', ['$http', function ($http) {\r\n    return {\r\n        getCountries: function () {\r\n            return $http.get('storefrontapi/countries?t=' + new Date().getTime());\r\n        },\r\n        getCountryRegions: function (countryCode) {\r\n            return $http.get('storefrontapi/countries/' + countryCode + '/regions?t=' + new Date().getTime());\r\n        }\r\n    }\r\n}]);\r\n\r\nstorefrontApp.service('customerService', ['$http', function ($http) {\r\n    return {\r\n        getCurrentCustomer: function () {\r\n            return $http.get('storefrontapi/account?t=' + new Date().getTime());\r\n        }\r\n    }\r\n}]);\r\n","(function () {\r\n    window.Toc.helpers.findOrFilter = function($el, selector) {\r\n        var $descendants = $el.find(selector);\r\n        return $el.filter(selector).add($descendants).filter(':not([data-toc-skip])').filter(function () {\r\n            return !$(this).parents(\"[data-toc-skip]\").length;\r\n        });\r\n    };\r\n\r\n    // from https://github.com/afeld/bootstrap-toc/pull/37\r\n    window.Toc.helpers.generateEmptyNavEl = function() {\r\n        var $li = $('<li></li>');\r\n        return $li;\r\n    };\r\n\r\n    window.Toc.helpers.getHeadings = function($scope, depth, topLevel) {\r\n        var selector = '';\r\n        for (var i = topLevel; i < topLevel + depth; i++) {\r\n            selector += 'h' + i;\r\n            if (i < topLevel + depth - 1)\r\n                selector += ',';\r\n        }\r\n        return this.findOrFilter($scope, selector);\r\n    };\r\n\r\n    window.Toc.helpers.populateNav = function($topContext, depth, topLevel, $headings) {\r\n        var $contexts = new Array(depth);\r\n        var helpers = this;\r\n\r\n        $contexts[0] = $topContext;\r\n        $topContext.lastNav = null;\r\n\r\n        $headings.each(function(i, el) {\r\n            var $newNav = helpers.generateNavItem(el);\r\n            var navLevel = helpers.getNavLevel(el);\r\n            var relLevel = navLevel - topLevel;\r\n            var j;\r\n\r\n            for (j = relLevel + 1; j < $contexts.length; j++) {\r\n                $contexts[j] = null;\r\n            }\r\n\r\n            if (!$contexts[relLevel]) {\r\n                for (j = 0; j < relLevel; j++) {\r\n                    if (!$contexts[j + 1]) {\r\n                        if (!$contexts[j].lastNav) {\r\n                            var $emptyNav = helpers.generateEmptyNavEl();\r\n                            $contexts[j].append($emptyNav);\r\n                            $contexts[j].lastNav = $emptyNav;\r\n                        }\r\n                        $contexts[j + 1] = helpers.createChildNavList($contexts[j].lastNav);\r\n                        $contexts[j + 1].lastNav = null;\r\n                    }\r\n                }\r\n            }\r\n\r\n            $contexts[relLevel].append($newNav);\r\n            $contexts[relLevel].lastNav = $newNav;\r\n        });\r\n    };\r\n\r\n    window.Toc.helpers.parseOps = function(arg) {\r\n        var opts;\r\n        if (arg.jquery) {\r\n            opts = {\r\n                $nav: arg\r\n            };\r\n        } else {\r\n            opts = arg;\r\n        }\r\n        opts.$scope = opts.$scope || $(document.body);\r\n        opts.depth = opts.depth || opts.$nav.attr('data-toc-depth') || 2;\r\n        return opts;\r\n    };\r\n\r\n    window.Toc.init = function(opts) {\r\n        opts = this.helpers.parseOps(opts);\r\n\r\n        // ensure that the data attribute is in place for styling\r\n        opts.$nav.attr('data-toggle', 'toc');\r\n\r\n        var $topContext = this.helpers.createChildNavList(opts.$nav);\r\n        var topLevel = this.helpers.getTopLevel(opts.$scope);\r\n        var $headings = this.helpers.getHeadings(opts.$scope, opts.depth, topLevel);\r\n        this.helpers.populateNav($topContext, opts.depth, topLevel, $headings);\r\n    };\r\n})();\r\n"]}